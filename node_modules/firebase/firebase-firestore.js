!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Ty){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l,e=t(Ty),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(Ee=l=l||{})[Ee.DEBUG=0]="DEBUG",Ee[Ee.VERBOSE=1]="VERBOSE",Ee[Ee.INFO=2]="INFO",Ee[Ee.WARN=3]="WARN",Ee[Ee.ERROR=4]="ERROR",Ee[Ee.SILENT=5]="SILENT";function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=c[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},a=l.INFO,c=((Te={})[l.DEBUG]="log",Te[l.VERBOSE]="log",Te[l.INFO]="info",Te[l.WARN]="warn",Te[l.ERROR]="error",Te),h=(Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),f.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?u[t]:t},Object.defineProperty(f.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),f.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},f.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},f.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},f.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},f.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},f);function f(t){this.name=t,this._logLevel=a,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,g="FirebaseError",m=(n(w,d=Error),w);function w(t,e,n){e=d.call(this,e)||this;return e.code=t,e.customData=n,e.name=g,Object.setPrototypeOf(e,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D={},S=N||self;function O(){}function x(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function k(t){var e=x(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),R=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:V).apply(null,arguments)}function M(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now;function F(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++R))},j.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var W,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var J=S.navigator;if(J){J=J.userAgent;if(J){W=J;break t}}W=""}function $(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e,n={};for(e in t)n[e]=t[e];return n}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<tt.length;i++)e=tt[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function nt(t){return nt[" "](t),t}nt[" "]=O;var rt,it=Y(W,"Opera"),ot=Y(W,"Trident")||Y(W,"MSIE"),st=Y(W,"Edge"),ut=st||ot,at=Y(W,"Gecko")&&!(Y(W.toLowerCase(),"webkit")&&!Y(W,"Edge"))&&!(Y(W,"Trident")||Y(W,"MSIE"))&&!Y(W,"Edge"),ct=Y(W.toLowerCase(),"webkit")&&!Y(W,"Edge");function ht(){var t=S.document;return t?t.documentMode:void 0}t:{var ft="",lt=(lt=W,at?/rv:([^\);]+)(\)|;)/.exec(lt):st?/Edge\/([\d\.]+)/.exec(lt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lt):ct?/WebKit\/(\S+)/.exec(lt):it?/(?:Version)[ \/]?(\S+)/.exec(lt):void 0);if(lt&&(ft=lt?lt[1]:""),ot){lt=ht();if(null!=lt&&lt>parseFloat(ft)){rt=String(lt);break t}}rt=ft}var pt={};function dt(u){return t=u,e=function(){for(var t=0,e=Q(String(rt)).split("."),n=Q(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=pt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var yt=S.document&&ot?ht()||(parseInt(rt,10)||void 0):void 0,vt=!ot||9<=Number(yt),gt=ot&&!dt("9"),mt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",O,e),S.removeEventListener("test",O,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function bt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},F(bt,wt);var It={2:"touch",3:"pen",4:"mouse"};bt.prototype.b=function(){bt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Tt,this.Y=this.Z=!1}function At(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Nt(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(At(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Nt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new _t(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),xt={};function kt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=qt(r);return e&&e[Et]?e.wa(n,r,P(i)?!!i.capture:!!i,o):Pt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=qt(n),t&&t[Et]?t.va(e,n,P(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!vt)return null;var u,a,c=Ut(t);if(c||(t[Ot]=c=new Nt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Vt,r=a=vt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)mt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Et]?Dt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(Dt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):At(t)))}function Rt(t){return t in xt?xt[t]:xt[t]="on"+t}function Ct(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Lt(t),n.call(r,e)}function Vt(t,e){if(t.Y)return!0;if(vt)return Ct(t,new bt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ct(t,e=new bt(e,this))}function Ut(t){return(t=t[Ot])instanceof Nt?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function qt(e){return"function"==x(e)?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function Ft(){j.call(this),this.c=new Nt(this),(this.J=this).C=null}function jt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new wt(e,t):e instanceof wt?e.target=e.target||t:(s=e,et(e=new wt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Bt(o,r,!0,e)&&s;if(s=Bt(o=e.a=t,r,!0,e)&&s,s=Bt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Bt(o=e.a=n[i],r,!1,e)&&s}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Dt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}F(Ft,j),Ft.prototype[Et]=!0,(A=Ft.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=qt(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=St(s=e.a[n],r,i,o))&&(At(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ut(e))&&(n=e.a[n.toString()],e=-1,n&&(e=St(n,r,i,o)),(r=-1<e?n[e]:null)&&Lt(r))}(this,t,e,n,r)},A.G=function(){if(Ft.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)At(n[r]);delete e.a[t],e.b--}}this.C=null},A.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Gt=S.JSON.stringify;function zt(){this.b=this.a=null}var Kt,Ht=(Wt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Wt(function(){return new Qt},function(t){t.reset()},100));function Wt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Qt(){this.next=this.b=this.a=null}function Yt(t,e){var n;Kt||(n=S.Promise.resolve(void 0),Kt=function(){n.then($t)}),Xt||(Kt(),Xt=!0),Jt.add(t,e)}zt.prototype.add=function(t,e){var n=Ht.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Qt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Xt=!(Qt.prototype.reset=function(){this.next=this.b=this.a=null}),Jt=new zt;function $t(){for(var t,e;n=e=void 0,n=null,(e=Jt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){S.setTimeout(function(){throw t},0)}(t)}var n=Ht;n.g(t),n.b<n.f&&(n.b++,t.next=n.a,n.a=t)}Xt=!1}function Zt(t,e){Ft.call(this),this.b=t||1,this.a=e||S,this.f=U(this.Xa,this),this.g=q()}function te(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ee(t,e,n){if("function"==x(t))n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}F(Zt,Ft),(A=Zt.prototype).aa=!1,A.M=null,A.Xa=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),jt(this,"tick"),this.aa&&(te(this),this.start())))},A.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},A.G=function(){Zt.X.G.call(this),te(this),delete this.a};var ne,re,ie,oe=(T(re=ue,ie=ne=j),re.prototype=null===ie?Object.create(ie):(se.prototype=ie.prototype,new se),ue.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ee(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ue.prototype.G=function(){ne.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ue);function se(){this.constructor=re}function ue(t,e,n){var r=ne.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function ae(t){j.call(this),this.b=t,this.a={}}F(ae,j);var ce=[];function he(t,e,n,r){Array.isArray(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){$(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function le(){this.a=!0}function pe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Gt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ae.prototype.G=function(){ae.X.G.call(this),fe(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.info=function(){};var de=null;function ye(){return de=de||new Ft}function ve(t){wt.call(this,"serverreachability",t)}function ge(t){var e=ye();jt(e,new ve(e))}function me(t){wt.call(this,"statevent",t)}function we(t){var e=ye();jt(e,new me(e))}function be(t){wt.call(this,"timingevent",t)}function Ie(t,e){if("function"!=x(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}F(ve,wt),F(me,wt),F(be,wt);var Ee={NO_ERROR:0,Ya:1,fb:2,eb:3,ab:4,cb:5,gb:6,Da:7,TIMEOUT:8,jb:9},Te={$a:"complete",nb:"success",Ea:"error",Da:"abort",lb:"ready",mb:"readystatechange",TIMEOUT:"timeout",hb:"incrementaldata",kb:"progress",bb:"downloadprogress",ob:"uploadprogress"};function _e(){}function Ae(t){var e;return(e=t.a)||(e=t.a={}),e}function Ne(){}_e.prototype.a=null;var De,N={OPEN:"a",Za:"b",Ea:"c",ib:"d"};function Se(){wt.call(this,"d")}function Oe(){wt.call(this,"c")}function xe(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ae(this),this.P=Pe,t=ut?125:void 0,this.R=new Zt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}F(Se,wt),F(Oe,wt),F(xe,_e),De=new xe;var Pe=45e3,Le={},Re={};function Ce(t,e,n){t.H=1,t.i=nn(Xe(e)),t.j=n,t.I=!0,Ve(t,null)}function Ve(t,e){t.u=q(),Me(t),t.l=Xe(t.i);var s,u,a,c,h,f,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.D=0,t.a=cr(t.g,t.g.C?e:null),0<t.O&&(t.F=new oe(U(t.Ca,t,t.a),t.O)),he(t.J,t.a,"readystatechange",t.Va),e=t.B?Z(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ge(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.S,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Ue(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var u=(u=n,o=i=void 0,i=(r=t).D,-1==(o=u.indexOf("\n",i))?Re:(i=Number(u.substring(i,o)),isNaN(i)?Le:(o+=1)+i>u.length?Re:(u=u.substr(o,i),r.D=o+i,u)));if(u==Re){4==e&&(t.h=4,we(14),s=!1),pe(t.c,t.f,null,"[Incomplete Response]");break}if(u==Le){t.h=4,we(15),pe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}pe(t.c,t.f,u,null),Ge(t,u)}4==e&&0==n.length&&(t.h=1,we(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),er(e),e.F=!0,we(11))):(pe(t.c,t.f,n,"[Invalid Chunked Response]"),Be(t),je(t))}function Me(t){t.T=q()+t.P,qe(t,t.P)}function qe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ie(U(t.Ta,t),e)}function Fe(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function je(t){0==t.g.v||t.A||ir(t.g,t)}function Be(t){Fe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,te(t.R),fe(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ge(t,e){try{var n,r,i,o,s,u=t.g;if(0!=u.v&&(u.a==t||Tn(u.b,t)))if(u.I=t.N,!t.C&&Tn(u.b,t)&&3==u.v){try{var a=u.ka.a.parse(e)}catch(t){a=null}if(Array.isArray(a)&&3==a.length){var c=a;if(0==c[0]){t:if(!u.j){if(u.a){if(!(u.a.u+3e3<t.u))break t;rr(u),Hn(u)}tr(u),we(18)}}else u.oa=c[1],0<u.oa-u.P&&c[2]<37500&&u.H&&0==u.o&&!u.m&&(u.m=Ie(U(u.Qa,u),6e3));if(En(u.b)<=1&&u.ea){try{u.ea()}catch(t){}u.ea=void 0}}else sr(u,11)}else if(!t.C&&u.a!=t||rr(u),!H(e))for(e=a=u.ka.a.parse(e),a=0;a<e.length;a++){c=e[a],u.P=c[0],c=c[1],2==u.v?"c"==c[0]?(u.J=c[1],u.ga=c[2],null!=(r=c[3])&&(u.ha=r,u.c.info("VER="+u.ha)),null!=(o=c[4])&&(u.pa=o,u.c.info("SVER="+u.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,u.D=n,u.c.info("backChannelRequestTimeoutMs_="+n)),n=u,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(Y(r,"spdy")||Y(r,"quic")||Y(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(_n(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,en(n.B,n.A,s))),u.v=3,u.f&&u.f.ta(),u.U&&(u.N=q()-t.u,u.c.info("Handshake RTT: "+u.N+"ms")),i=t,(n=u).la=ar(n,n.C?n.ga:null,n.fa),i.C?(An(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Fe(o),Me(o)),n.a=i):Zn(n),0<u.g.length&&Yn(u)):"stop"!=c[0]&&"close"!=c[0]||sr(u,7):3==u.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?sr(u,7):Kn(u):"noop"!=c[0]&&u.f&&u.f.sa(c),u.o=0)}ge(4)}catch(t){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=ke.prototype).setTimeout=function(t){this.P=t},A.Va=function(t){t=t.target;var e=this.F;e&&3==jn(t)?e.f():this.Ca(t)},A.Ca=function(t){try{if(t==this.a)t:{var e=jn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!ut&&!this.a.$())){this.A||4!=e||7==n||ge(8==n||r<=0?3:2),Fe(this);var i=this.a.W();this.N=i;n=this.a.$();if(this.b=200==i,r=this.c,u=this.m,a=this.l,c=this.f,h=this.S,f=e,l=i,r.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+h+"]: "+u+"\n"+a+"\n"+f+" "+l}),this.b){if(this.U&&!this.C){e:{if(this.a){var o=this.a;if((o=o.a?o.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(o)){var s=o;break e}}s=null}if(!s){this.b=!1,this.h=3,we(12),Be(this),je(this);break t}pe(this.c,this.f,s,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ge(this,s)}this.I?(Ue(this,e,n),ut&&this.b&&3==e&&(he(this.J,this.R,"tick",this.Ua),this.R.start())):(pe(this.c,this.f,n,null),Ge(this,n)),4==e&&Be(this),this.b&&!this.A&&(4==e?ir(this.g,this):(this.b=!1,Me(this)))}else 400==i&&0<n.indexOf("Unknown SID")?(this.h=3,we(12)):(this.h=0,we(13)),Be(this),je(this)}}}catch(t){}var u,a,c,h,f,l},A.Ua=function(){var t,e;this.a&&(t=jn(this.a),e=this.a.$(),this.D<e.length&&(Fe(this),Ue(this,t,e),this.b&&4!=t&&Me(this)))},A.cancel=function(){this.A=!0,Be(this)},A.Ta=function(){this.o=null;var t,e,n=q();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ge(3),we(17)),Be(this),this.h=2,je(this)):qe(this,this.T-n)},(A=Ke.prototype).K=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.L=function(){return He(this),this.a.concat()},A.get=function(t,e){return We(this.b,t)?this.b[t]:e},A.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,$e(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b,(n=new ln).c=e.c,e.a&&(n.a=new Ke(e.a),n.b=e.b),tn(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=rn(n[2]||""),$e(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Xe(t){return new Ye(t)}function Je(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(pn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),vn(this,n,t))},r)),r.f=i):(n||(e=on(e,hn)),t.b=new ln(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,un,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,fn)),t.join("")};var un=/[#\/\?@]/g,an=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,fn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(n){n.a||(n.a=new Ke,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){pn(t),e=gn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function yn(t,e){return pn(t),e=gn(t,e),We(t.a.b,e)}function vn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),K(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function mn(t,e){this.b=t,this.a=e}function wn(t){this.g=t||bn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().pb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(A=ln.prototype).add=function(t,e){pn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(n,r){pn(this),this.a.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},A.L=function(){pn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.K=function(t){pn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=z(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},A.set=function(t,e){return pn(this),this.c=null,yn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var bn=10;function In(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=_(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Dn(){}function Sn(){this.a=new Dn}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wn.prototype.cancel=function(){var e,t;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=_(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Dn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var xn=S.JSON.parse;function kn(t){Ft.call(this),this.headers=new Ke,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Pn,this.D=this.F=!1}F(kn,Ft);var Pn="",Ln=/^https?$/i,Rn=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Un(t),qn(t)}function Un(t){t.u||(t.u=!0,jt(t,"complete"),jt(t,"error"))}function Mn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=jn(t)||2!=t.W()))if(t.l&&4==jn(t))ee(t.za,0,t);else if(jt(t,"readystatechange"),4==jn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Qe)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Ln.test(i?i.toLowerCase():"")),e=n),e)jt(t,"complete"),jt(t,"success");else{t.h=6;try{var u=2<jn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.W()+"]",Un(t)}}finally{qn(t)}}}function qn(t,e){if(t.a){Fn(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||jt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Fn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function jn(t){return t.a?t.a.readyState:0}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",$(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zn(t){this.pa=0,this.g=[],this.c=new le,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Ma=this.R=0,this.Ja=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Fa=Gn("baseRetryDelayMs",5e3,t),this.Pa=Gn("retryDelaySeedMs",1e4,t),this.Ka=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.La=t&&t.h||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(t&&t.concurrentRequestLimit),this.ka=new Sn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.g&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ia=t&&t.f||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Kn(t){var e,n;Wn(t),3==t.v&&(e=t.R++,en(n=Xe(t.B),"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),Jn(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=nn(Xe(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.i.toString(),"")),!n&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=cr(e.g,null),e.a.ba(e.i)),e.u=q(),Me(e)),ur(t)}function Hn(t){t.a&&(er(t),t.a.cancel(),t.a=null)}function Wn(t){Hn(t),t.j&&(S.clearTimeout(t.j),t.j=null),rr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function Qn(t,e){t.g.push(new mn(t.Ma++,e)),3==t.v&&Yn(t)}function Yn(t){In(t.b)||t.h||(t.h=!0,Yt(t.Ba,t),t.u=0)}function Xn(t,e){var n=e?e.f:t.R++,r=Xe(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),Jn(t,r),t.i&&t.l&&Bn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),_n(t.b,n),Ce(n,r,e)}function Jn(t,n){t.f&&ze({},function(t,e){en(n,e,t)})}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?U(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{ze(t,function(t,e){var n=t;P(t)&&(n=Gt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Zn(t){t.a||t.j||(t.T=1,Yt(t.Aa,t),t.o=0)}function tr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Ie(U(t.Aa,t),or(t,t.o)),t.o++,1)}function er(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function nr(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),Jn(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&Bn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Xe(e)),n.j=null,n.I=!0,Ve(n,t)}function rr(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function ir(t,e){var n,r=null;if(t.a==e){rr(t),er(t),t.a=null;var i=2}else{if(!Tn(t.b,e))return;r=e.s,An(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,jt(i=ye(),new be(i)),Yn(t)):Zn(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(En(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ja?0:t.Ka)))return t.h=Ie(U(t.Ba,t,e),or(t,t.u)),t.u++,1}}(t,e)||2==i&&tr(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:sr(t,5);break;case 4:sr(t,10);break;case 3:sr(t,6);break;default:sr(t,2)}}function or(t,e){var n=t.Fa+Math.floor(Math.random()*t.Pa);return t.f||(n*=2),n*e}function sr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=U(t.Wa,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||Je(r,"https"),nn(r)),n=r.toString(),r=o,o=new le,S.Image?((i=new Image).onload=M(On,o,i,"TestLoadImage: loaded",!0,r),i.onerror=M(On,o,i,"TestLoadImage: error",!1,r),i.onabort=M(On,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=M(On,o,i,"TestLoadImage: timeout",!1,r),S.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):we(2),t.v=0,t.f&&t.f.ra(e),ur(t),Wn(t)}function ur(t){t.v=0,t.I=-1,t.f&&(0==Nn(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function ar(t,e,n){var r,i,o,s,u,a=(s=n)instanceof Ye?Xe(s):new Ye(s,void 0);return""!=a.c?(e&&$e(a,e+"."+a.c),Ze(a,a.h)):(u=S.location,r=u.protocol,i=e?e+"."+u.hostname:u.hostname,o=+u.port,s=n,u=new Ye(null,void 0),r&&Je(u,r),i&&$e(u,i),o&&Ze(u,o),s&&(u.g=s),a=u),t.V&&$(t.V,function(t,e){en(a,e,t)}),e=t.A,n=t.na,e&&n&&en(a,e,n),en(a,"VER",t.ha),Jn(t,a),a}function cr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.La)).F=t.C,e}function hr(){}function fr(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function lr(t,e){Ft.call(this),this.a=new zn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new yr(this)}function pr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function dr(){Oe.call(this),this.status=1}function yr(t){this.a=t}(A=kn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ae(this.H):Ae(De),this.a.onreadystatechange=U(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Vn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&ze(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=S.FormData&&t instanceof S.FormData,0<=B(Rn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Fn(this),0<this.o&&((this.D=(i=this.a,ot&&dt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=U(this.xa,this)):this.m=ee(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vn(this,t)}},A.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,jt(this,"timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,jt(this,"complete"),jt(this,"abort"),qn(this))},A.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),kn.X.G.call(this)},A.za=function(){this.j||(this.A||this.l||this.g?Mn(this):this.Sa())},A.Sa=function(){Mn(this)},A.W=function(){try{return 2<jn(this)?this.a.status:-1}catch(t){return-1}},A.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},A.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},A.ua=function(){return this.h},A.Oa=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=zn.prototype).ha=8,A.v=1,A.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?et(r=Z(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),en(i=Xe(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&Bn(i,this.i,r),_n(this.b,n),this.Ga&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Ce(n,i,null)):Ce(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||In(this.b)||Xn(this))},A.Aa=function(){var t;this.j=null,nr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ie(U(this.Ra,this),t))},A.Ra=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,we(10),Hn(this),nr(this))},A.Qa=function(){null!=this.m&&(this.m=null,Hn(this),tr(this),we(19))},A.Wa=function(t){t?(this.c.info("Successfully pinged google.com"),we(2)):(this.c.info("Failed to ping google.com"),we(1))},(A=hr.prototype).ta=function(){},A.sa=function(){},A.ra=function(){},A.qa=function(){},A.Ha=function(){},fr.prototype.a=function(t,e){return new lr(t,e)},F(lr,Ft),lr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;we(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ar(t,null,t.fa),Yn(t)},lr.prototype.close=function(){Kn(this.a)},lr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.l?((e={}).__data__=Gt(t),Qn(this.a,e)):Qn(this.a,t)},lr.prototype.G=function(){this.a.f=null,delete this.f,Kn(this.a),delete this.a,lr.X.G.call(this)},F(pr,Se),F(dr,Oe),F(yr,hr),yr.prototype.ta=function(){jt(this.a,"a")},yr.prototype.sa=function(t){jt(this.a,new pr(t))},yr.prototype.ra=function(t){jt(this.a,new dr)},yr.prototype.qa=function(){jt(this.a,"b")},fr.prototype.createWebChannel=fr.prototype.a,lr.prototype.send=lr.prototype.h,lr.prototype.open=lr.prototype.g,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(Ne.EventType=N).OPEN="a",N.CLOSE="b",N.ERROR="c",N.MESSAGE="d",Ft.prototype.listen=Ft.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Oa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Na,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var vr=Ee,gr=Te,mr=Ne,wr=kn,br=(Ir.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ir.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ir.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ir);function Ir(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Er,Tr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_r=(n(Nr,Er=Error),Nr),Ar=new h("@firebase/firestore");function Nr(t,e){var n=this;return(n=Er.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Dr(){return Ar.logLevel}function Sr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=l.DEBUG&&(e=n.map(kr),Ar.debug.apply(Ar,i(["Firestore (8.0.1): "+t],e)))}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=l.ERROR&&(e=n.map(kr),Ar.error.apply(Ar,i(["Firestore (8.0.1): "+t],e)))}function xr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=l.WARN&&(e=n.map(kr),Ar.warn.apply(Ar,i(["Firestore (8.0.1): "+t],e)))}function kr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Pr(t){void 0===t&&(t="Unexpected state");t="FIRESTORE (8.0.1) INTERNAL ASSERTION FAILED: "+t;throw Or(t),new Error(t)}function Lr(t){t||Pr()}var Rr=(Cr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Cr);function Cr(){}function Vr(t,e){return t<e?-1:e<t?1:0}function Ur(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Mr(t){return t+"\0"}var qr=(Fr.fromBase64String=function(t){return new Fr(atob(t))},Fr.fromUint8Array=function(t){return new Fr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Fr.prototype.toBase64=function(){return t=this.i,btoa(t);var t},Fr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},Fr.prototype.o=function(){return 2*this.i.length},Fr.prototype.u=function(t){return Vr(this.i,t.i)},Fr.prototype.isEqual=function(t){return this.i===t.i},Fr);function Fr(t){this.i=t}qr.h=new qr("");var jr=(Br.fromBase64String=function(t){try{return new Br(qr.fromBase64String(t))}catch(t){throw new _r(Tr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Br.fromUint8Array=function(t){return new Br(qr.fromUint8Array(t))},Br.prototype.toBase64=function(){return this.l.toBase64()},Br.prototype.toUint8Array=function(){return this.l.toUint8Array()},Br.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Br.prototype.isEqual=function(t){return this.l.isEqual(t.l)},Br);function Br(t){this.l=t}function Gr(){if("undefined"==typeof Uint8Array)throw new _r(Tr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function zr(){if("undefined"==typeof atob)throw new _r(Tr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Kr,Hr=(n(Xr,Kr=jr),Xr.fromBase64String=function(t){zr();try{return new Xr(qr.fromBase64String(t))}catch(t){throw new _r(Tr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Xr.fromUint8Array=function(t){return Gr(),new Xr(qr.fromUint8Array(t))},Xr.prototype.toBase64=function(){return zr(),Kr.prototype.toBase64.call(this)},Xr.prototype.toUint8Array=function(){return Gr(),Kr.prototype.toUint8Array.call(this)},Xr.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Xr),Wr=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},Qr=(Object.defineProperty(Yr.prototype,"I",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Yr.prototype.isEqual=function(t){return t instanceof Yr&&t.projectId===this.projectId&&t.database===this.database},Yr.prototype.u=function(t){return Vr(this.projectId,t.projectId)||Vr(this.database,t.database)},Yr);function Yr(t,e){this.projectId=t,this.database=e||"(default)"}function Xr(){return null!==Kr&&Kr.apply(this,arguments)||this}function Jr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function $r(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ti,ei,ni=(yi.prototype.get=function(t){var e=this.m(t),e=this.R[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.A(o,t))return i}},yi.prototype.has=function(t){return void 0!==this.get(t)},yi.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},yi.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},yi.prototype.forEach=function(s){$r(this.R,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},yi.prototype.P=function(){return Zr(this.R)},yi),ri=(di.now=function(){return di.fromMillis(Date.now())},di.fromDate=function(t){return di.fromMillis(t.getTime())},di.fromMillis=function(t){var e=Math.floor(t/1e3);return new di(e,1e6*(t-1e3*e))},di.prototype.toDate=function(){return new Date(this.toMillis())},di.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},di.prototype.g=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},di.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},di.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},di.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},di.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},di),ii=(pi.V=function(t){return new pi(t)},pi.min=function(){return new pi(new ri(0,0))},pi.prototype.u=function(t){return this.timestamp.g(t.timestamp)},pi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},pi.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},pi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},pi.prototype.v=function(){return this.timestamp},pi),Ee=(Object.defineProperty(li.prototype,"length",{get:function(){return this.S},enumerable:!1,configurable:!0}),li.prototype.isEqual=function(t){return 0===li.D(this,t)},li.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof li?t.forEach(function(t){e.push(t)}):e.push(t),this.C(e)},li.prototype.limit=function(){return this.offset+this.length},li.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},li.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},li.prototype.O=function(){return this.segments[this.offset]},li.prototype.k=function(){return this.get(this.length-1)},li.prototype.get=function(t){return this.segments[this.offset+t]},li.prototype.P=function(){return 0===this.length},li.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},li.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},li.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},li.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},li.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},li),oi=(n(fi,ei=Ee),fi.prototype.C=function(t,e,n){return new fi(t,e,n)},fi.prototype.B=function(){return this.L().join("/")},fi.prototype.toString=function(){return this.B()},fi.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new _r(Tr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new fi(n)},fi.U=function(){return new fi([])},fi),si=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ui=(n(hi,ti=Ee),hi.prototype.C=function(t,e,n){return new hi(t,e,n)},hi.K=function(t){return si.test(t)},hi.prototype.B=function(){return this.L().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),hi.K(t)||(t="`"+t+"`"),t}).join(".")},hi.prototype.toString=function(){return this.B()},hi.prototype.W=function(){return 1===this.length&&"__name__"===this.get(0)},hi.j=function(){return new hi(["__name__"])},hi.G=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new _r(Tr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new _r(Tr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _r(Tr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new _r(Tr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new hi(e)},hi.U=function(){return new hi([])},hi),ai=(ci.H=function(t){return new ci(oi.q(t))},ci.Y=function(t){return new ci(oi.q(t).N(5))},ci.prototype.J=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ci.prototype.isEqual=function(t){return null!==t&&0===oi.D(this.path,t.path)},ci.prototype.toString=function(){return this.path.toString()},ci.D=function(t,e){return oi.D(t.path,e.path)},ci.X=function(t){return t.length%2==0},ci.Z=function(t){return new ci(new oi(t.slice()))},ci);function ci(t){this.path=t}function hi(){return null!==ti&&ti.apply(this,arguments)||this}function fi(){return null!==ei&&ei.apply(this,arguments)||this}function li(t,e,n){void 0===e?e=0:e>t.length&&Pr(),void 0===n?n=t.length-e:n>t.length-e&&Pr(),this.segments=t,this.offset=e,this.S=n}function pi(t){this.timestamp=t}function di(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new _r(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new _r(Tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _r(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new _r(Tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function yi(t,e){this.m=t,this.A=e,this.R={}}function vi(t){return null==t}function gi(t){return 0===t&&1/t==-1/0}function mi(t){return"number"==typeof t&&Number.isInteger(t)&&!gi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var wi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.tt=null};function bi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new wi(t,e,n,r,i,o,s)}function Ii(t){var e=t;return null===e.tt&&(t=e.path.B(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.B()+t.op.toString()+Io(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.B()+t.dir}).join(","),vi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ta(e.startAt)),e.endAt&&(t+="|ub:",t+=ta(e.endAt)),e.tt=t),e.tt}function Ei(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!go(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!na(t.startAt,e.startAt)&&na(t.endAt,e.endAt)}function Ti(t){return ai.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}function _i(t){this.count=t}var Ai,Ni=(Di.prototype.st=function(t){return new Di(this.target,this.targetId,this.et,t,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Di.prototype.it=function(t,e){return new Di(this.target,this.targetId,this.et,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Di.prototype.rt=function(t){return new Di(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,t,this.resumeToken)},Di);function Di(t,e,n,r,i,o,s){void 0===i&&(i=ii.min()),void 0===o&&(o=ii.min()),void 0===s&&(s=qr.h),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Si(t){switch(t){case Tr.OK:return Pr(),0;case Tr.CANCELLED:case Tr.UNKNOWN:case Tr.DEADLINE_EXCEEDED:case Tr.RESOURCE_EXHAUSTED:case Tr.INTERNAL:case Tr.UNAVAILABLE:case Tr.UNAUTHENTICATED:return;case Tr.INVALID_ARGUMENT:case Tr.NOT_FOUND:case Tr.ALREADY_EXISTS:case Tr.PERMISSION_DENIED:case Tr.FAILED_PRECONDITION:case Tr.ABORTED:case Tr.OUT_OF_RANGE:case Tr.UNIMPLEMENTED:case Tr.DATA_LOSS:return 1;default:return Pr(),0}}function Oi(t){if(void 0===t)return Or("GRPC error has no .code"),Tr.UNKNOWN;switch(t){case Ai.OK:return Tr.OK;case Ai.CANCELLED:return Tr.CANCELLED;case Ai.UNKNOWN:return Tr.UNKNOWN;case Ai.DEADLINE_EXCEEDED:return Tr.DEADLINE_EXCEEDED;case Ai.RESOURCE_EXHAUSTED:return Tr.RESOURCE_EXHAUSTED;case Ai.INTERNAL:return Tr.INTERNAL;case Ai.UNAVAILABLE:return Tr.UNAVAILABLE;case Ai.UNAUTHENTICATED:return Tr.UNAUTHENTICATED;case Ai.INVALID_ARGUMENT:return Tr.INVALID_ARGUMENT;case Ai.NOT_FOUND:return Tr.NOT_FOUND;case Ai.ALREADY_EXISTS:return Tr.ALREADY_EXISTS;case Ai.PERMISSION_DENIED:return Tr.PERMISSION_DENIED;case Ai.FAILED_PRECONDITION:return Tr.FAILED_PRECONDITION;case Ai.ABORTED:return Tr.ABORTED;case Ai.OUT_OF_RANGE:return Tr.OUT_OF_RANGE;case Ai.UNIMPLEMENTED:return Tr.UNIMPLEMENTED;case Ai.DATA_LOSS:return Tr.DATA_LOSS;default:return Pr()}}(Te=Ai=Ai||{})[Te.OK=0]="OK",Te[Te.CANCELLED=1]="CANCELLED",Te[Te.UNKNOWN=2]="UNKNOWN",Te[Te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Te[Te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Te[Te.NOT_FOUND=5]="NOT_FOUND",Te[Te.ALREADY_EXISTS=6]="ALREADY_EXISTS",Te[Te.PERMISSION_DENIED=7]="PERMISSION_DENIED",Te[Te.UNAUTHENTICATED=16]="UNAUTHENTICATED",Te[Te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Te[Te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Te[Te.ABORTED=10]="ABORTED",Te[Te.OUT_OF_RANGE=11]="OUT_OF_RANGE",Te[Te.UNIMPLEMENTED=12]="UNIMPLEMENTED",Te[Te.INTERNAL=13]="INTERNAL",Te[Te.UNAVAILABLE=14]="UNAVAILABLE",Te[Te.DATA_LOSS=15]="DATA_LOSS";var xi=(Ci.prototype.ot=function(t,e){return new Ci(this.D,this.root.ot(t,e,this.D).copy(null,null,Pi.at,null,null))},Ci.prototype.remove=function(t){return new Ci(this.D,this.root.remove(t,this.D).copy(null,null,Pi.at,null,null))},Ci.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ci.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ci.prototype.P=function(){return this.root.P()},Object.defineProperty(Ci.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Ci.prototype.ct=function(){return this.root.ct()},Ci.prototype.ut=function(){return this.root.ut()},Ci.prototype.ht=function(t){return this.root.ht(t)},Ci.prototype.forEach=function(n){this.ht(function(t,e){return n(t,e),!1})},Ci.prototype.toString=function(){var n=[];return this.ht(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ci.prototype.lt=function(t){return this.root.lt(t)},Ci.prototype._t=function(){return new ki(this.root,null,this.D,!1)},Ci.prototype.ft=function(t){return new ki(this.root,t,this.D,!1)},Ci.prototype.dt=function(){return new ki(this.root,null,this.D,!0)},Ci.prototype.wt=function(t){return new ki(this.root,t,this.D,!0)},Ci),ki=(Ri.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},Ri.prototype.At=function(){return 0<this.Tt.length},Ri.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},Ri),Pi=(Li.prototype.copy=function(t,e,n,r,i){return new Li(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Li.prototype.P=function(){return!1},Li.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},Li.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},Li.prototype.min=function(){return this.left.P()?this:this.left.min()},Li.prototype.ct=function(){return this.min().key},Li.prototype.ut=function(){return this.right.P()?this.key:this.right.ut()},Li.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},Li.prototype.gt=function(){if(this.left.P())return Li.EMPTY;var t=this;return t.left.yt()||t.left.left.yt()||(t=t.Vt()),(t=t.copy(null,null,null,t.left.gt(),null)).Pt()},Li.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.P()||r.left.yt()||r.left.left.yt()||(r=r.Vt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.yt()&&(r=r.bt()),r.right.P()||r.right.yt()||r.right.left.yt()||(r=r.vt()),0===e(t,r.key)){if(r.right.P())return Li.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.gt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Li.prototype.yt=function(){return this.color},Li.prototype.Pt=function(){var t=this;return t.right.yt()&&!t.left.yt()&&(t=t.St()),t.left.yt()&&t.left.left.yt()&&(t=t.bt()),t.left.yt()&&t.right.yt()&&(t=t.Dt()),t},Li.prototype.Vt=function(){var t=this.Dt();return t.right.left.yt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},Li.prototype.vt=function(){var t=this.Dt();return t.left.left.yt()&&(t=(t=t.bt()).Dt()),t},Li.prototype.St=function(){var t=this.copy(null,null,Li.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Li.prototype.bt=function(){var t=this.copy(null,null,Li.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Li.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Li.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},Li.prototype.Nt=function(){if(this.yt()&&this.left.yt())throw Pr();if(this.right.yt())throw Pr();var t=this.left.Nt();if(t!==this.right.Nt())throw Pr();return t+(this.yt()?0:1)},Li);function Li(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Li.RED,this.left=null!=r?r:Li.EMPTY,this.right=null!=i?i:Li.EMPTY,this.size=this.left.size+1+this.right.size}function Ri(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}function Ci(t,e){this.D=t,this.root=e||Pi.EMPTY}function Vi(){this.size=0}Pi.EMPTY=null,Pi.RED=!0,Pi.at=!1,Pi.EMPTY=(Object.defineProperty(Vi.prototype,"key",{get:function(){throw Pr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vi.prototype,"value",{get:function(){throw Pr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vi.prototype,"color",{get:function(){throw Pr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vi.prototype,"left",{get:function(){throw Pr()},enumerable:!1,configurable:!0}),Object.defineProperty(Vi.prototype,"right",{get:function(){throw Pr()},enumerable:!1,configurable:!0}),Vi.prototype.copy=function(t,e,n,r,i){return this},Vi.prototype.ot=function(t,e,n){return new Pi(t,e)},Vi.prototype.remove=function(t,e){return this},Vi.prototype.P=function(){return!0},Vi.prototype.ht=function(t){return!1},Vi.prototype.lt=function(t){return!1},Vi.prototype.ct=function(){return null},Vi.prototype.ut=function(){return null},Vi.prototype.yt=function(){return!1},Vi.prototype.Ct=function(){return!0},Vi.prototype.Nt=function(){return 0},new Vi);var Ui=(ji.prototype.has=function(t){return null!==this.data.get(t)},ji.prototype.first=function(){return this.data.ct()},ji.prototype.last=function(){return this.data.ut()},Object.defineProperty(ji.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),ji.prototype.indexOf=function(t){return this.data.indexOf(t)},ji.prototype.forEach=function(n){this.data.ht(function(t,e){return n(t),!1})},ji.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(0<=this.D(r.key,t[1]))return;e(r.key)}},ji.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},ji.prototype.Ot=function(t){t=this.data.ft(t);return t.At()?t.It().key:null},ji.prototype._t=function(){return new Mi(this.data._t())},ji.prototype.ft=function(t){return new Mi(this.data.ft(t))},ji.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},ji.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},ji.prototype.P=function(){return this.data.P()},ji.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ji.prototype.isEqual=function(t){if(!(t instanceof ji))return!1;if(this.size!==t.size)return!1;for(var e=this.data._t(),n=t.data._t();e.At();){var r=e.It().key,i=n.It().key;if(0!==this.D(r,i))return!1}return!0},ji.prototype.L=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ji.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ji.prototype.copy=function(t){var e=new ji(this.D);return e.data=t,e},ji),Mi=(Fi.prototype.It=function(){return this.Mt.It().key},Fi.prototype.At=function(){return this.Mt.At()},Fi),qi=new xi(ai.D);function Fi(t){this.Mt=t}function ji(t){this.D=t,this.data=new xi(this.D)}var Bi=new xi(ai.D);var Gi=new xi(ai.D),zi=new Ui(ai.D);function Ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zi,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Hi=new Ui(Vr);var Wi=(co.Bt=function(t){return new co(t.D)},co.prototype.has=function(t){return null!=this.$t.get(t)},co.prototype.get=function(t){return this.$t.get(t)},co.prototype.first=function(){return this.Lt.ct()},co.prototype.last=function(){return this.Lt.ut()},co.prototype.P=function(){return this.Lt.P()},co.prototype.indexOf=function(t){t=this.$t.get(t);return t?this.Lt.indexOf(t):-1},Object.defineProperty(co.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),co.prototype.forEach=function(n){this.Lt.ht(function(t,e){return n(t),!1})},co.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},co.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},co.prototype.isEqual=function(t){if(!(t instanceof co))return!1;if(this.size!==t.size)return!1;for(var e=this.Lt._t(),n=t.Lt._t();e.At();){var r=e.It().key,i=n.It().key;if(!r.isEqual(i))return!1}return!0},co.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},co.prototype.copy=function(t,e){var n=new co;return n.D=this.D,n.$t=t,n.Lt=e,n},co),Qi=(ao.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);!n||0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):Pr()},ao.prototype.Ut=function(){var n=[];return this.qt.ht(function(t,e){n.push(e)}),n},ao),Yi=(uo.Gt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new uo(t,e,Wi.Bt(e),i,n,r,!0,!1)},Object.defineProperty(uo.prototype,"hasPendingWrites",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),uo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Tu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},uo),Xi=(so.Xt=function(t,e){var n=new Map;return n.set(t,Ji.Zt(t,e)),new so(ii.min(),n,Hi,qi,Ki())},so),Ji=(oo.Zt=function(t,e){return new oo(qr.h,e,Ki(),Ki(),Ki())},oo),$i=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Zi=function(t,e){this.targetId=t,this.oe=e},to=function(t,e,n,r){void 0===n&&(n=qr.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},eo=(Object.defineProperty(io.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),io.prototype.de=function(t){0<t.o()&&(this.le=!0,this.ue=t)},io.prototype.we=function(){var n=Ki(),r=Ki(),i=Ki();return this.ce.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Pr()}}),new Ji(this.ue,this.he,n,r,i)},io.prototype.Ee=function(){this.le=!1,this.ce=fo()},io.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},io.prototype.Ie=function(t){this.le=!0,this.ce=this.ce.remove(t)},io.prototype.me=function(){this.ae+=1},io.prototype.Ae=function(){--this.ae},io.prototype.Re=function(){this.le=!0,this.he=!0},io),no=(ro.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof iu?this.ve(r,t.re):t.re instanceof ou&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Se(s,t.key,t.re)}},ro.prototype.De=function(n){var r=this;this.Ce(n,function(t){var e=r.Ne(t);switch(n.state){case 0:r.xe(t)&&e.de(n.resumeToken);break;case 1:e.Ae(),e._e||e.Ee(),e.de(n.resumeToken);break;case 2:e.Ae(),e._e||r.removeTarget(t);break;case 3:r.xe(t)&&(e.Re(),e.de(n.resumeToken));break;case 4:r.xe(t)&&(r.Fe(t),e.de(n.resumeToken));break;default:Pr()}})},ro.prototype.Ce=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.ge.forEach(function(t,e){r.xe(e)&&n(e)})},ro.prototype.Oe=function(t){var e=t.targetId,n=t.oe.count,t=this.ke(e);t&&(Ti(t=t.target)?0===n?(t=new ai(t.path),this.Se(e,t,new ou(t,ii.min()))):Lr(1===n):this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e)))},ro.prototype.$e=function(r){var i=this,o=new Map;this.ge.forEach(function(t,e){var n=i.ke(e);n&&(t.te&&Ti(n.target)&&(n=new ai(n.target.path),null!==i.ye.get(n)||i.Le(e,n)||i.Se(e,n,new ou(n,r))),t.fe&&(o.set(e,t.we()),t.Ee()))});var s=Ki();this.Ve.forEach(function(t,e){var n=!0;e.Ft(function(t){t=i.ke(t);return!t||2===t.et||(n=!1)}),n&&(s=s.add(t))});var t=new Xi(r,o,this.pe,this.ye,s);return this.ye=qi,this.Ve=ho(),this.pe=new Ui(Vr),t},ro.prototype.ve=function(t,e){var n;this.xe(t)&&(n=this.Le(t,e.key)?2:0,this.Ne(t).Te(e.key,n),this.ye=this.ye.ot(e.key,e),this.Ve=this.Ve.ot(e.key,this.Be(e.key).add(t)))},ro.prototype.Se=function(t,e,n){var r;this.xe(t)&&(r=this.Ne(t),this.Le(t,e)?r.Te(e,1):r.Ie(e),this.Ve=this.Ve.ot(e,this.Be(e).delete(t)),n&&(this.ye=this.ye.ot(e,n)))},ro.prototype.removeTarget=function(t){this.ge.delete(t)},ro.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},ro.prototype.me=function(t){this.Ne(t).me()},ro.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new eo,this.ge.set(t,e)),e},ro.prototype.Be=function(t){var e=this.Ve.get(t);return e||(e=new Ui(Vr),this.Ve=this.Ve.ot(t,e)),e},ro.prototype.xe=function(t){var e=null!==this.ke(t);return e||Sr("WatchChangeAggregator","Detected inactive target",t),e},ro.prototype.ke=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},ro.prototype.Fe=function(e){var n=this;this.ge.set(e,new eo),this.Pe.qe(e).forEach(function(t){n.Se(e,t,null)})},ro.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},ro);function ro(t){this.Pe=t,this.ge=new Map,this.ye=qi,this.Ve=ho(),this.pe=new Ui(Vr)}function io(){this.ae=0,this.ce=fo(),this.ue=qr.h,this.he=!1,this.le=!0}function oo(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}function so(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Yt=r,this.Jt=i}function uo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function ao(){this.qt=new xi(ai.D)}function co(n){this.D=n?function(t,e){return n(t,e)||ai.D(t.key,e.key)}:function(t,e){return ai.D(t.key,e.key)},this.$t=Bi,this.Lt=new xi(this.D)}function ho(){return new xi(ai.D)}function fo(){return new xi(ai.D)}function lo(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function po(t){t=Eo(t.mapValue.fields.__local_write_time__.timestampValue);return new ri(t.seconds,t.nanos)}var yo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?lo(t)?4:10:Pr()}function go(r,i){var t,e=vo(r);if(e!==vo(i))return!1;switch(e){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return po(r).isEqual(po(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Eo(r.timestampValue),t=Eo(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,_o(r.bytesValue).isEqual(_o(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,To((t=r).geoPointValue.latitude)===To(e.geoPointValue.latitude)&&To(t.geoPointValue.longitude)===To(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return To(t.integerValue)===To(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=To(t.doubleValue),e=To(e.doubleValue);return t===e?gi(t)===gi(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Ur(r.arrayValue.values||[],i.arrayValue.values||[],go);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Jr(e)!==Jr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!go(e[t],n[t])))return!1;return!0}();default:return Pr()}}function mo(t,e){return void 0!==(t.values||[]).find(function(t){return go(t,e)})}function wo(t,e){var n,r,i=vo(t),o=vo(e);if(i!==o)return Vr(i,o);switch(i){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return n=e,r=To(t.integerValue||t.doubleValue),n=To(n.integerValue||n.doubleValue),r<n?-1:n<r?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1;case 3:return bo(t.timestampValue,e.timestampValue);case 4:return bo(po(t),po(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return function(t,e){t=_o(t),e=_o(e);return t.u(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return i=t.geoPointValue,r=e.geoPointValue,0!==(n=Vr(To(i.latitude),To(r.latitude)))?n:Vr(To(i.longitude),To(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=wo(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Vr(r[s],o[s]);if(0!==u)return u;u=wo(n[r[s]],i[o[s]]);if(0!==u)return u}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Pr()}}function bo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=Eo(t),t=Eo(e),e=Vr(n.seconds,t.seconds);return 0!==e?e:Vr(n.nanos,t.nanos)}function Io(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=Eo(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?_o(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,ai.Y(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Pr();var e}(t)}function Eo(t){if(Lr(!!t),"string"!=typeof t)return{seconds:To(t.seconds),nanos:To(t.nanos)};var e=0,n=yo.exec(t);Lr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function To(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _o(t){return"string"==typeof t?qr.fromBase64String(t):qr.fromUint8Array(t)}function Ao(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.B()}}function No(t){return t&&"integerValue"in t}function Do(t){return!!t&&"arrayValue"in t}function So(t){return t&&"nullValue"in t}function Oo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function xo(t){return t&&"mapValue"in t}var ko={asc:"ASCENDING",desc:"DESCENDING"},Po={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Lo=function(t,e){this._=t,this.Ke=e};function Ro(t){return{integerValue:""+t}}function Co(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gi(e)?"-0":e}}function Vo(t,e){return mi(e)?Ro(e):Co(t,e)}function Uo(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function qo(t){return Lr(!!t),ii.V((t=Eo(t),new ri(t.seconds,t.nanos)))}function Fo(t,e){return new oi(["projects",t.projectId,"databases",t.database]).child("documents").child(e).B()}function jo(t){t=oi.q(t);return Lr(os(t)),t}function Bo(t,e){return Fo(t._,e.path)}function Go(t,e){e=jo(e);return Lr(e.get(1)===t._.projectId),Lr(!e.get(3)&&!t._.database||e.get(3)===t._.database),new ai(Wo(e))}function zo(t,e){return Fo(t._,e)}function Ko(t){t=jo(t);return 4===t.length?oi.U():Wo(t)}function Ho(t){return new oi(["projects",t._.projectId,"databases",t._.database]).B()}function Wo(t){return Lr(4<t.length&&"documents"===t.get(4)),t.N(5)}function Qo(t,e,n){return{name:Bo(t,e),fields:n.proto.mapValue.fields}}function Yo(t,e){var n,r,i;if(e instanceof Vs)n={update:Qo(t,e.key,e.value)};else if(e instanceof Ws)n={delete:Bo(t,e.key)};else if(e instanceof Us)n={update:Qo(t,e.key,e.data),updateMask:(i=e.Qe,r=[],i.fields.forEach(function(t){return r.push(t.B())}),{fieldPaths:r})};else if(e instanceof Bs)n={transform:{document:Bo(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof cs)return{fieldPath:t.field.B(),setToServerValue:"REQUEST_TIME"};if(e instanceof hs)return{fieldPath:t.field.B(),appendMissingElements:{values:e.elements}};if(e instanceof ys)return{fieldPath:t.field.B(),removeAllFromArray:{values:e.elements}};if(e instanceof ws)return{fieldPath:t.field.B(),increment:e.We};throw Pr()})}};else{if(!(e instanceof Qs))return Pr();n={verify:Bo(t,e.key)}}return e.Ge.je||(n.currentDocument=void 0!==(i=e.Ge).updateTime?{updateTime:(e=t,t=i.updateTime,Uo(e,t.v()))}:void 0!==i.exists?{exists:i.exists}:Pr()),n}function Xo(e,t){var n=t.currentDocument?void 0!==(o=t.currentDocument).updateTime?Ds.updateTime(qo(o.updateTime)):void 0!==o.exists?Ds.exists(o.exists):Ds.ze():Ds.ze();if(t.update){t.update.name;var r=Go(e,t.update.name),i=new Ys({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=(o=t.updateMask.fieldPaths||[],new Ts(o.map(function(t){return ui.G(t)})));return new Us(r,i,o,n)}return new Vs(r,i,n)}if(t.delete){var s=Go(e,t.delete);return new Ws(s,n)}if(t.transform){i=Go(e,t.transform.document),s=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(Lr("REQUEST_TIME"===e.setToServerValue),r=new cs):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new hs(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new ys(n)):"increment"in e?r=new ws(t,e.increment):Pr();e=ui.G(e.fieldPath);return new _s(e,r)}(e,t)});return Lr(!0===n.exists),new Bs(i,s)}if(t.verify){t=Go(e,t.verify);return new Qs(t,n)}return Pr()}function Jo(t,e){return{documents:[zo(t,e.path)]}}function $o(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=zo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=zo(t,r.F()),n.structuredQuery.from=[{collectionId:r.k()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Oo(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NAN"}};if(So(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Oo(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NOT_NAN"}};if(So(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ns(t.field),op:(e=t.op,Po[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:ns((t=t).field),direction:(t=t.dir,ko[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.Ke||vi(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=ts(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ts(e.endAt)),n}function Zo(t){var e=Ko(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Lr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[is(t)]:void 0!==t.fieldFilter?[(n=t,Ou.create(rs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Pr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Pr():[];var n}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new ra(rs((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=vi(u="object"==typeof(u=n.limit)?u.value:u)?null:u);var s=null;n.startAt&&(s=es(n.startAt));var u=null;return n.endAt&&(u=es(n.endAt)),wu(fu(e,i,t,o,r,"F",s,u))}function ts(t){return{before:t.before,values:t.position}}function es(t){var e=!!t.before,t=t.values||[];return new Yu(t,e)}function ns(t){return{fieldPath:t.B()}}function rs(t){return ui.G(t.fieldPath)}function is(t){switch(t.unaryFilter.op){case"IS_NAN":var e=rs(t.unaryFilter.field);return Ou.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=rs(t.unaryFilter.field);return Ou.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=rs(t.unaryFilter.field);return Ou.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":t=rs(t.unaryFilter.field);return Ou.create(t,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Pr()}}function os(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}h=function(){this.He=void 0};function ss(t,e){return t instanceof ws?No(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var us,as,cs=(n(ls,as=h),ls),hs=(n(fs,us=h),fs);function fs(t){var e=this;return(e=us.call(this)||this).elements=t,e}function ls(){return null!==as&&as.apply(this,arguments)||this}function ps(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return go(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var ds,ys=(n(vs,ds=h),vs);function vs(t){var e=this;return(e=ds.call(this)||this).elements=t,e}function gs(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!go(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ms,ws=(n(bs,ms=h),bs);function bs(t,e){var n=this;return(n=ms.call(this)||this).serializer=t,n.We=e,n}function Is(t){return To(t.integerValue||t.doubleValue)}function Es(t){return Do(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ts=(As.prototype.Ye=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},As.prototype.isEqual=function(t){return Ur(this.fields,t.fields,function(t,e){return t.isEqual(e)})},As),_s=function(t,e){this.field=t,this.transform=e};function As(t){(this.fields=t).sort(ui.D)}function Ns(t,e){this.version=t,this.transformResults=e}var Ds=(Ss.ze=function(){return new Ss},Ss.exists=function(t){return new Ss(void 0,t)},Ss.updateTime=function(t){return new Ss(t)},Object.defineProperty(Ss.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ss.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ss);function Ss(t,e){this.updateTime=t,this.exists=e}function Os(t,e){return void 0!==t.updateTime?e instanceof iu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof iu}Ee=function(){};function xs(t,e,n){return t instanceof Vs?new iu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof Us?function(t,e,n){if(!Os(t.Ge,e))return new su(t.key,n.version);e=Fs(t,e);return new iu(t.key,n.version,e,{hasCommittedMutations:!0})}(t,e,n):t instanceof Bs?function(t,e,n){if(Lr(null!=n.transformResults),!Os(t.Ge,e))return new su(t.key,n.version);var r=e,e=function(t,e,n){var r=[];Lr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof iu&&(u=e.field(o.field)),r.push((o=s,s=u,u=n[i],o instanceof hs?ps(o,s):o instanceof ys?gs(o,s):u))}return r}(t.fieldTransforms,e,n.transformResults),n=n.version,e=zs(t,r.data(),e);return new iu(t.key,n,e,{hasCommittedMutations:!0})}(t,e,n):new ou(t.key,n.version,{hasCommittedMutations:!0})}function ks(t,e,n,r){return t instanceof Vs?function(t,e){if(!Os(t.Ge,e))return e;e=Ls(e);return new iu(t.key,e,t.value,{Je:!0})}(t,e):t instanceof Us?function(t,e){if(!Os(t.Ge,e))return e;var n=Ls(e),e=Fs(t,e);return new iu(t.key,n,e,{Je:!0})}(t,e):t instanceof Bs?function(t,e,n,r){if(!Os(t.Ge,e))return e;var i=e,r=function(t,e,n,r){for(var i,o=[],s=0,u=t;s<u.length;s++){var a=u[s],c=a.transform,h=null;n instanceof iu&&(h=n.field(a.field)),null===h&&r instanceof iu&&(h=r.field(a.field)),o.push((i=h,a=e,h=void 0,(c=c)instanceof cs?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},i&&(h.fields.__previous_value__=i),{mapValue:h}):c instanceof hs?ps(c,i):c instanceof ys?gs(c,i):(c=ss(h=c,i),i=Is(c)+Is(h.We),No(c)&&No(h.We)?Ro(i):Co(h.serializer,i))))}return o}(t.fieldTransforms,n,e,r),r=zs(t,i.data(),r);return new iu(t.key,i.version,r,{Je:!0})}(t,e,r,n):(e=e,Os((t=t).Ge,e)?new ou(t.key,ii.min()):e)}function Ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||Ur(t.fieldTransforms,t.fieldTransforms,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof hs&&e instanceof hs||t instanceof ys&&e instanceof ys?Ur(t.elements,e.elements,go):t instanceof ws&&e instanceof ws?go(t.We,e.We):t instanceof cs&&e instanceof cs)}))}function Ls(t){return t instanceof iu?t.version:ii.min()}var Rs,Cs,Vs=(n(qs,Cs=Ee),qs),Us=(n(Ms,Rs=Ee),Ms);function Ms(t,e,n,r){var i=this;return(i=Rs.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ge=r,i.type=1,i}function qs(t,e,n){var r=this;return(r=Cs.call(this)||this).key=t,r.value=e,r.Ge=n,r.type=0,r}function Fs(t,e){return n=t,e=e instanceof iu?e.data():Ys.empty(),r=new Xs(e),n.Qe.fields.forEach(function(t){var e;t.P()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.Xe();var n,r}var js,Bs=(n(Gs,js=Ee),Gs);function Gs(t,e){var n=this;return(n=js.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ge=Ds.exists(!0),n}function zs(t,e,n){for(var r=new Xs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var Ks,Hs,Ws=(n(tu,Hs=Ee),tu),Qs=(n(Zs,Ks=Ee),Zs),Ys=($s.empty=function(){return new $s({mapValue:{}})},$s.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!xo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null},$s.prototype.isEqual=function(t){return go(this.proto,t.proto)},$s),Xs=(Js.prototype.set=function(t,e){return this.en(t,e),this},Js.prototype.delete=function(t){return this.en(t,null),this},Js.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===vo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.k(),e)},Js.prototype.Xe=function(){var t=this.nn(ui.U(),this.tn);return null!=t?new Ys(t):this.Ze},Js.prototype.nn=function(r,t){var i=this,o=!1,e=this.Ze.field(r),s=xo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.nn(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Js);function Js(t){void 0===t&&(t=Ys.empty()),this.Ze=t,this.tn=new Map}function $s(t){this.proto=t}function Zs(t,e){var n=this;return(n=Ks.call(this)||this).key=t,n.Ge=e,n.type=4,n}function tu(t,e){var n=this;return(n=Hs.call(this)||this).key=t,n.Ge=e,n.type=3,n}var eu,nu,ru,Te=function(t,e){this.key=t,this.version=e},iu=(n(hu,ru=Te),hu.prototype.field=function(t){return this.sn.field(t)},hu.prototype.data=function(){return this.sn},hu.prototype.rn=function(){return this.sn.proto},hu.prototype.isEqual=function(t){return t instanceof hu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Je===t.Je&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},hu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Je+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(hu.prototype,"hasPendingWrites",{get:function(){return this.Je||this.hasCommittedMutations},enumerable:!1,configurable:!0}),hu),ou=(n(cu,nu=Te),cu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(cu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),cu.prototype.isEqual=function(t){return t instanceof cu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},cu),su=(n(au,eu=Te),au.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(au.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),au.prototype.isEqual=function(t){return t instanceof au&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},au),uu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=s,this.endAt=u,this.cn=null,this.un=null,this.startAt,this.endAt};function au(){return null!==eu&&eu.apply(this,arguments)||this}function cu(t,e,n){var r=this;return(r=nu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function hu(t,e,n,r){var i=this;return(i=ru.call(this,t,e)||this).sn=n,i.Je=!!r.Je,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function fu(t,e,n,r,i,o,s,u){return new uu(t,e,n,r,i,o,s,u)}function lu(t){return new uu(t)}function pu(t){return!vi(t.limit)&&"F"===t.an}function du(t){return!vi(t.limit)&&"L"===t.an}function yu(t){return 0<t.on.length?t.on[0].field:null}function vu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.hn())return r.field}return null}function gu(t){return null!==t.collectionGroup}function mu(t){var e=t;if(null===e.cn){e.cn=[];var n=vu(e),t=yu(e);if(null!==n&&null===t)n.W()||e.cn.push(new ra(n)),e.cn.push(new ra(ui.j(),"asc"));else{for(var r=!1,i=0,o=e.on;i<o.length;i++){var s=o[i];e.cn.push(s),s.field.W()&&(r=!0)}r||(n=0<e.on.length?e.on[e.on.length-1].dir:"asc",e.cn.push(new ra(ui.j(),n)))}}return e.cn}function wu(t){var e=t;if(!e.un)if("F"===e.an)e.un=bi(e.path,e.collectionGroup,mu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=mu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ra(o.field,s))}var u=e.endAt?new Yu(e.endAt.position,!e.endAt.before):null,t=e.startAt?new Yu(e.startAt.position,!e.startAt.before):null;e.un=bi(e.path,e.collectionGroup,n,e.filters,e.limit,u,t)}return e.un}function bu(t,e,n){return new uu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Iu(t,e){return new uu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function Eu(t,e){return new uu(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function Tu(t,e){return Ei(wu(t),wu(e))&&t.an===e.an}function _u(t){return Ii(wu(t))+"|lt:"+t.an}function Au(t){return"Query(target="+(e=wu(t),n=e.path.B(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.B()+" "+t.op+" "+Io(t.value)}).join(", ")+"]"),vi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.B()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+ta(e.startAt)),e.endAt&&(n+=", endAt: "+ta(e.endAt)),"Target("+n+")")+"; limitType="+t.an+")";var e,n}function Nu(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.J(e.collectionGroup)&&e.path.M(n):ai.X(e.path)?e.path.isEqual(n):e.path.$(n))&&function(t){for(var e=0,n=i.on;e<n.length;e++){var r=n[e];if(!r.field.W()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||ea(t.startAt,mu(t),n))&&(!t.endAt||!ea(t.endAt,mu(t),n)));var e,n}function Du(u){return function(t,e){for(var n=!1,r=0,i=mu(u);r<i.length;r++){var o=i[r],s=function(t,r,e){e=t.field.W()?ai.D(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?wo(n,t):Pr()}(t.field,e);switch(t.dir){case"asc":return e;case"desc":return-1*e;default:return Pr()}}(o,t,e);if(0!==s)return s;n=n||o.field.W()}return 0}}var Su,Ou=(n(xu,Su=function(){}),xu.create=function(t,e,n){return t.W()?"in"===e||"not-in"===e?this.ln(t,e,n):new Ru(t,e,n):"array-contains"===e?new Ku(t,n):"in"===e?new Hu(t,n):"not-in"===e?new Wu(t,n):"array-contains-any"===e?new Qu(t,n):new xu(t,e,n)},xu.ln=function(t,e,n){return new("in"===e?Cu:Vu)(t,n)},xu.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this._n(wo(t,this.value)):null!==t&&vo(this.value)===vo(t)&&this._n(wo(t,this.value))},xu.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Pr()}},xu.prototype.hn=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},xu);function xu(t,e,n){var r=this;return(r=Su.call(this)||this).field=t,r.op=e,r.value=n,r}var ku,Pu,Lu,Ru=(n(qu,Lu=Ou),qu.prototype.matches=function(t){t=ai.D(t.key,this.key);return this._n(t)},qu),Cu=(n(Mu,Pu=Ou),Mu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Mu),Vu=(n(Uu,ku=Ou),Uu.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Uu);function Uu(t,e){var n=this;return(n=ku.call(this,t,"not-in",e)||this).keys=Fu(0,e),n}function Mu(t,e){var n=this;return(n=Pu.call(this,t,"in",e)||this).keys=Fu(0,e),n}function qu(t,e,n){var r=this;return(r=Lu.call(this,t,e,n)||this).key=ai.Y(n.referenceValue),r}function Fu(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return ai.Y(t.referenceValue)})}var ju,Bu,Gu,zu,Ku=(n(Zu,zu=Ou),Zu.prototype.matches=function(t){t=t.field(this.field);return Do(t)&&mo(t.arrayValue,this.value)},Zu),Hu=(n($u,Gu=Ou),$u.prototype.matches=function(t){t=t.field(this.field);return null!==t&&mo(this.value.arrayValue,t)},$u),Wu=(n(Ju,Bu=Ou),Ju.prototype.matches=function(t){if(mo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!mo(this.value.arrayValue,t)},Ju),Qu=(n(Xu,ju=Ou),Xu.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!Do(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return mo(e.value.arrayValue,t)})},Xu),Yu=function(t,e){this.position=t,this.before=e};function Xu(t,e){return ju.call(this,t,"array-contains-any",e)||this}function Ju(t,e){return Bu.call(this,t,"not-in",e)||this}function $u(t,e){return Gu.call(this,t,"in",e)||this}function Zu(t,e){return zu.call(this,t,"array-contains",e)||this}function ta(t){return(t.before?"b":"a")+":"+t.position.map(Io).join(",")}function ea(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.W()?ai.D(ai.Y(s.referenceValue),n.key):wo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function na(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!go(t.position[n],e.position[n]))return!1;return!0}var ra=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};var ia,oa=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},sa=(ya.prototype.reset=function(){this.In=0},ya.prototype.Rn=function(){this.In=this.Tn},ya.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);0<i&&Sr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.In+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mn=this.fn.yn(this.dn,i,function(){return e.An=Date.now(),t()}),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},ya.prototype.Vn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},ya.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},ya.prototype.gn=function(){return(Math.random()-.5)*this.In},ya),ua=(da.prototype.catch=function(t){return this.next(void 0,t)},da.prototype.next=function(r,i){var o=this;return this.Dn&&Pr(),this.Dn=!0,this.Sn?this.error?this.Cn(i,this.error):this.Nn(r,this.result):new da(function(e,n){o.bn=function(t){o.Nn(r,t).next(e,n)},o.vn=function(t){o.Cn(i,t).next(e,n)}})},da.prototype.xn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},da.prototype.Fn=function(t){try{var e=t();return e instanceof da?e:da.resolve(e)}catch(t){return da.reject(t)}},da.prototype.Nn=function(t,e){return t?this.Fn(function(){return t(e)}):da.resolve(e)},da.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):da.reject(e)},da.resolve=function(n){return new da(function(t,e){t(n)})},da.reject=function(n){return new da(function(t,e){e(n)})},da.On=function(t){return new da(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},da.kn=function(t){for(var n=da.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?da.resolve(t):e()})}(r[e]);return n},da.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.On(i)},da),aa=(pa.delete=function(t){return Sr("SimpleDb","Removing database:",t),Ia(window.indexedDB.deleteDatabase(t)).xn()},pa.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(pa.Bn())return!0;var t=p(),e=pa.$n(t),n=0<e&&e<10,e=pa.qn(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},pa.Bn=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Un)},pa.Kn=function(t,e){return t.store(e)},pa.$n=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},pa.qn=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},pa.prototype.Qn=function(o){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Sr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new ha(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new _r(Tr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ha(o,t))},r.onupgradeneeded=function(t){Sr("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Mn.createOrUpgrade(e,r.transaction,t.oldVersion,i.version).next(function(){Sr("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return i.Wn(t)}),this.db)]}})})},pa.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},pa.prototype.runTransaction=function(u,n,a,c){return y(this,void 0,void 0,function(){var i,o,s,e;return v(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Qn(u)];case 2:return s.db=t.sent(),e=ga.open(s.db,u,i?"readonly":"readwrite",a),n=c(e).catch(function(t){return e.abort(t),ua.reject(t)}).xn(),r={},n.catch(function(){}),[4,e.Gn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Sr("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},pa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},pa),ca=(Object.defineProperty(la.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(la.prototype,"Jn",{get:function(){return this.Yn},enumerable:!1,configurable:!0}),Object.defineProperty(la.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),la.prototype.done=function(){this.Hn=!0},la.prototype.Xn=function(t){this.Yn=t},la.prototype.delete=function(){return Ia(this.zn.delete())},la),ha=(n(fa,ia=_r),fa);function fa(t,e){var n=this;return(n=ia.call(this,Tr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function la(t){this.zn=t,this.Hn=!1,this.Yn=null}function pa(t,e,n){this.name=t,this.version=e,this.Mn=n,12.2===pa.$n(p())&&Or("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function da(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t(function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)},function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)})}function ya(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}function va(t){return"IndexedDbTransactionError"===t.name}var ga=(ba.open=function(t,e,n,r){try{return new ba(e,t.transaction(r,n))}catch(t){throw new ha(e,t)}},Object.defineProperty(ba.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),ba.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(Sr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},ba.prototype.store=function(t){t=this.transaction.objectStore(t);return new ma(t)},ba),ma=(wa.prototype.put=function(t,e){t=void 0!==e?(Sr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Sr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Ia(t)},wa.prototype.add=function(t){return Sr("SimpleDb","ADD",this.store.name,t,t),Ia(this.store.add(t))},wa.prototype.get=function(e){var n=this;return Ia(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Sr("SimpleDb","GET",n.store.name,e,t),t})},wa.prototype.delete=function(t){return Sr("SimpleDb","DELETE",this.store.name,t),Ia(this.store.delete(t))},wa.prototype.count=function(){return Sr("SimpleDb","COUNT",this.store.name),Ia(this.store.count())},wa.prototype.ts=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.es(e,function(t,e){n.push(e)}).next(function(){return n})},wa.prototype.ns=function(t,e){Sr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.ss=!1;e=this.cursor(e);return this.es(e,function(t,e,n){return n.delete()})},wa.prototype.rs=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.es(n,e)},wa.prototype.os=function(r){var t=this.cursor({});return new ua(function(n,e){t.onerror=function(t){t=Ta(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},wa.prototype.es=function(t,i){var o=[];return new ua(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new ca(n),(t=i(n.primaryKey,n.value,e))instanceof ua&&(t=t.catch(function(t){return e.done(),ua.reject(t)}),o.push(t)),e.Sn?r():null===e.Jn?n.continue():n.continue(e.Jn)):r()}}).next(function(){return ua.On(o)})},wa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},wa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},wa);function wa(t){this.store=t}function ba(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.Zn=new oa,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){t.error?n.Zn.reject(new ha(e,t.error)):n.Zn.resolve()},this.transaction.onerror=function(t){t=Ta(t.target.error);n.Zn.reject(new ha(e,t))}}function Ia(t){return new ua(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Ta(t.target.error);n(t)}})}var Ea=!1;function Ta(t){var e=aa.$n(p());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new _r("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ea||(Ea=!0,setTimeout(function(){throw n},0)),n}}return t}function _a(){return"undefined"!=typeof window?window:null}function Aa(){return"undefined"!=typeof document?document:null}var Na=(Oa._s=function(t,e,n,r,i){i=new Oa(t,e,Date.now()+n,r,i);return i.start(n),i},Oa.prototype.start=function(t){var e=this;this.fs=setTimeout(function(){return e.ds()},t)},Oa.prototype.pn=function(){return this.ds()},Oa.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new _r(Tr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Oa.prototype.ds=function(){var e=this;this.cs.ws(function(){return null!==e.fs?(e.clearTimeout(),e.op().then(function(t){return e.ls.resolve(t)})):Promise.resolve()})},Oa.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},Oa),Da=(Object.defineProperty(Sa.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),Sa.prototype.ws=function(t){this.enqueue(t)},Sa.prototype.bs=function(t){this.vs(),this.Ss(t)},Sa.prototype.Ds=function(){var t;this.Is||(this.Is=!0,(t=Aa())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vs))},Sa.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise(function(t){}):this.Ss(t)},Sa.prototype.Cs=function(t){var e=this;this.ws(function(){return e.Ts.push(t),e.Ns()})},Sa.prototype.Ns=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.ys.reset(),[3,4];case 3:if(!va(e=t.sent()))throw e;return Sr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.ys.Pn(function(){return n.Ns()}),t.label=5;case 5:return[2]}})})},Sa.prototype.Ss=function(t){var r=this,e=this.Es.then(function(){return r.Ps=!0,t().catch(function(t){throw r.Rs=t,r.Ps=!1,Or("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Ps=!1,t})});return this.Es=e},Sa.prototype.yn=function(t,e,n){var r=this;this.vs(),-1<this.gs.indexOf(t)&&(e=0);n=Na._s(this,t,e,n,function(t){return r.xs(t)});return this.As.push(n),n},Sa.prototype.vs=function(){this.Rs&&Pr()},Sa.prototype.Fs=function(){},Sa.prototype.Os=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Es];case 1:t.sent(),t.label=2;case 2:if(e!==this.Es)return[3,0];t.label=3;case 3:return[2]}})})},Sa.prototype.ks=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},Sa.prototype.Ms=function(r){var i=this;return this.Os().then(function(){i.As.sort(function(t,e){return t.us-e.us});for(var t=0,e=i.As;t<e.length;t++){var n=e[t];if(n.pn(),"all"!==r&&n.dn===r)break}return i.Os()})},Sa.prototype.$s=function(t){this.gs.push(t)},Sa.prototype.xs=function(t){t=this.As.indexOf(t);this.As.splice(t,1)},Sa);function Sa(){var e=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.ys=new sa(this,"async_queue_retry"),this.Vs=function(){var t=Aa();t&&Sr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.ys.Vn()};var t=Aa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vs)}function Oa(t,e,n,r,i){this.cs=t,this.dn=e,this.us=n,this.op=r,this.hs=i,this.ls=new oa,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch(function(t){})}function xa(t,e){if(Or("AsyncQueue",e+": "+t),va(t))return new _r(Tr.UNAVAILABLE,e+": "+t);throw t}function ka(){this.Bs=new ni(_u,Tu),this.onlineState="Unknown",this.qs=new Set}var Pa=function(){this.Ls=void 0,this.listeners=[]};function La(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:if(e=s,n=u.query,r=!1,(i=e.Bs.get(n))||(r=!0,i=new Pa),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.Us(n)];case 2:return o.Ls=t.sent(),[3,4];case 3:return o=t.sent(),o=xa(o,"Initialization of query '"+Au(u.query)+"' failed"),[2,void u.onError(o)];case 4:return e.Bs.set(n,i),i.listeners.push(u),u.Ks(e.onlineState),i.Ls&&u.Qs(i.Ls)&&Ca(e),[2]}})})}function Ra(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){return e=s,n=u.query,r=!1,(i=e.Bs.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Bs.delete(n),e.Ws(n))]:[2]})})}function Ca(t){t.qs.forEach(function(t){t.next()})}var Va=(qa.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Yi(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Ys(t,this.onlineState)&&(this.Js(t),o=!0),this.zs=t,o},qa.prototype.onError=function(t){this.js.error(t)},qa.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Ys(this.zs,t)&&(this.Js(this.zs),e=!0),e},qa.prototype.Ys=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.P()&&"Offline"!==e)},qa.prototype.Hs=function(t){if(0<t.docChanges.length)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},qa.prototype.Js=function(t){t=Yi.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},qa),Ua=(Ma.prototype.Zs=function(){return null!=this.uid},Ma.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},Ma.prototype.isEqual=function(t){return t.uid===this.uid},Ma);function Ma(t){this.uid=t}function qa(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}Ua.UNAUTHENTICATED=new Ua(null),Ua.ei=new Ua("google-credentials-uid"),Ua.ni=new Ua("first-party-uid");function Fa(t,e){this.user=e,this.type="OAuth",this.si={},this.si.Authorization="Bearer "+t}var ja=(uc.prototype.getToken=function(){return Promise.resolve(null)},uc.prototype.ri=function(){},uc.prototype.oi=function(t){(this.ii=t)(Ua.UNAUTHENTICATED)},uc.prototype.ai=function(){this.ii=null},uc),Ba=(sc.prototype.getToken=function(){var e=this,n=this.hi,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.hi!==n?(Sr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Lr("string"==typeof t.accessToken),new Fa(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},sc.prototype.ri=function(){this.forceRefresh=!0},sc.prototype.oi=function(t){this.ii=t,this.ui&&t(this.currentUser)},sc.prototype.ai=function(){this.auth&&this.auth.removeAuthTokenListener(this.ci),this.ci=null,this.ii=null},sc.prototype.li=function(){var t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new Ua(t)},sc),Ga=(Object.defineProperty(oc.prototype,"si",{get:function(){var t={"X-Goog-AuthUser":this.fi},e=this._i.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),oc),za=(ic.prototype.getToken=function(){return Promise.resolve(new Ga(this._i,this.fi))},ic.prototype.oi=function(t){t(Ua.ni)},ic.prototype.ai=function(){},ic.prototype.ri=function(){},ic),Ka=(rc.prototype.wi=function(t,e,n){for(var r=n.Ei,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=xs(o,e,r[i]))}return e},rc.prototype.Ti=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=ks(i,e,e,this.di))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=ks(a,e,o,this.di))}return e},rc.prototype.Ii=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Ti(t.key,n.get(t.key));e&&(i=i.ot(t.key,e))}),i},rc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ki())},rc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ur(this.mutations,t.mutations,Ps)&&Ur(this.baseMutations,t.baseMutations,Ps)},rc),Ha=(nc.from=function(t,e,n){Lr(t.mutations.length===n.length);for(var r=Gi,i=t.mutations,o=0;o<i.length;o++)r=r.ot(i[o].key,n[o].version);return new nc(t,e,n,r)},nc),h=(Object.defineProperty(ec.prototype,"readTime",{get:function(){return this.gi},set:function(t){this.gi=t},enumerable:!1,configurable:!0}),ec.prototype.yi=function(t,e){this.Vi(),this.readTime=e,this.Ri.set(t.key,t)},ec.prototype.pi=function(t,e){this.Vi(),e&&(this.readTime=e),this.Ri.set(t,null)},ec.prototype.bi=function(t,e){this.Vi();var n=this.Ri.get(e);return void 0!==n?ua.resolve(n):this.vi(t,e)},ec.prototype.getEntries=function(t,e){return this.Si(t,e)},ec.prototype.apply=function(t){return this.Vi(),this.Pi=!0,this.Di(t)},ec.prototype.Vi=function(){},ec),Wa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ee=(tc.prototype.Ni=function(t){this.Ci.push(t)},tc.prototype.xi=function(){this.Ci.forEach(function(t){return t()})},tc),Qa=(Za.prototype.Mi=function(e,n){var r=this;return this.Oi.$i(e,n).next(function(t){return r.Li(e,n,t)})},Za.prototype.Li=function(t,r,i){return this.Fi.bi(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Ti(r,t);return t})},Za.prototype.Bi=function(t,e,i){var o=qi;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Ti(t,e);o=o.ot(t,e)}),o},Za.prototype.qi=function(e,t){var n=this;return this.Fi.getEntries(e,t).next(function(t){return n.Ui(e,t)})},Za.prototype.Ui=function(e,r){var i=this;return this.Oi.Ki(e,r).next(function(t){var t=i.Bi(e,r,t),n=qi;return t.forEach(function(t,e){e=e||new ou(t,ii.min()),n=n.ot(t,e)}),n})},Za.prototype.Qi=function(t,e,n){return r=e,ai.X(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Wi(t,e.path):gu(e)?this.ji(t,e,n):this.Gi(t,e,n);var r},Za.prototype.Wi=function(t,e){return this.Mi(t,new ai(e)).next(function(t){var e=Bi;return t instanceof iu&&(e=e.ot(t.key,t)),e})},Za.prototype.ji=function(n,r,i){var o=this,s=r.collectionGroup,u=Bi;return this.ki.zi(n,s).next(function(t){return ua.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new uu(t,null,e.on.slice(),e.filters.slice(),e.limit,e.an,e.startAt,e.endAt));return o.Gi(n,e,i).next(function(t){t.forEach(function(t,e){u=u.ot(t,e)})})}).next(function(){return u})})},Za.prototype.Gi=function(e,n,t){var c,h,r=this;return this.Fi.Qi(e,n,t).next(function(t){return c=t,r.Oi.Hi(e,n)}).next(function(t){return h=t,r.Yi(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),a=ks(s,a,a,r.di);c=a instanceof iu?c.ot(u,a):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){Nu(n,e)||(c=c.remove(t))}),c})},Za.prototype.Yi=function(t,e,n){for(var r=Ki(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Us&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Fi.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof iu&&(c=c.ot(t,e))}),c})},Za),Ya=($a.Zi=function(t,e){for(var n=Ki(),r=Ki(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new $a(t,e.fromCache,n,r)},$a),Xa=(Ja.prototype.er=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ja.prototype.next=function(){var t=++this.previousValue;return this.nr&&this.nr(t),t},Ja);function Ja(t,e){var n=this;this.previousValue=t,e&&(e.tr=function(t){return n.er(t)},this.nr=function(t){return e.sr(t)})}function $a(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ji=n,this.Xi=r}function Za(t,e,n){this.Fi=t,this.Oi=e,this.ki=n}function tc(){this.Ci=[]}function ec(){this.Ri=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Pi=!1}function nc(t,e,n,r){this.batch=t,this.mi=e,this.Ei=n,this.Ai=r}function rc(t,e,n,r){this.batchId=t,this.di=e,this.baseMutations=n,this.mutations=r}function ic(t,e){this._i=t,this.fi=e}function oc(t,e){this._i=t,this.fi=e,this.type="FirstParty",this.user=Ua.ni}function sc(t){var e=this;this.ci=null,this.currentUser=Ua.UNAUTHENTICATED,this.ui=!1,this.hi=0,this.ii=null,this.forceRefresh=!1,this.ci=function(){e.hi++,e.currentUser=e.li(),e.ui=!0,e.ii&&e.ii(e.currentUser)},this.hi=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.ci):(this.ci(null),t.get().then(function(t){e.auth=t,e.ci&&e.auth.addAuthTokenListener(e.ci)},function(){}))}function uc(){this.ii=null}function ac(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Vr(n,t);return 0===t?Vr(r,e):t}Xa.ir=-1;var cc=(pc.prototype.cr=function(){return++this.ar},pc.prototype.ur=function(t){var e=[t,this.cr()];this.buffer.size<this.rr?this.buffer=this.buffer.add(e):ac(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(pc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),pc),hc={hr:!1,lr:0,_r:0,dr:0},fc=(lc.Ir=function(t){return new lc(t,lc.mr,lc.Ar)},lc);function lc(t,e,n){this.wr=t,this.Er=e,this.Tr=n}function pc(t){this.rr=t,this.buffer=new Ui(ac),this.ar=0}fc.mr=10,fc.Ar=1e3,fc.Rr=new fc(41943040,fc.mr,fc.Ar),fc.Pr=new fc(-1,0,0);var dc=(gc.prototype.start=function(t){-1!==this.gr.params.wr&&this.pr(t)},gc.prototype.stop=function(){this.Vr&&(this.Vr.cancel(),this.Vr=null)},Object.defineProperty(gc.prototype,"br",{get:function(){return null!==this.Vr},enumerable:!1,configurable:!0}),gc.prototype.pr=function(n){var t=this,e=this.yr?3e5:6e4;Sr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Vr=this.cs.yn("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Vr=null,this.yr=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.vr(this.gr)];case 2:return t.sent(),[3,7];case 3:return va(e=t.sent())?(Sr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Xh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.pr(n)];case 8:return t.sent(),[2]}})})})},gc),yc=(vc.prototype.Dr=function(t,e){return this.Sr.Cr(t).next(function(t){return Math.floor(e/100*t)})},vc.prototype.Nr=function(t,e){var n=this;if(0===e)return ua.resolve(Xa.ir);var r=new cc(e);return this.Sr.Ce(t,function(t){return r.ur(t.sequenceNumber)}).next(function(){return n.Sr.Fr(t,function(t){return r.ur(t)})}).next(function(){return r.maxValue})},vc.prototype.Or=function(t,e,n){return this.Sr.Or(t,e,n)},vc.prototype.kr=function(t,e){return this.Sr.kr(t,e)},vc.prototype.Mr=function(e,n){var r=this;return-1===this.params.wr?(Sr("LruGarbageCollector","Garbage collection skipped; disabled"),ua.resolve(hc)):this.$r(e).next(function(t){return t<r.params.wr?(Sr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.wr),hc):r.Lr(e,n)})},vc.prototype.$r=function(t){return this.Sr.$r(t)},vc.prototype.Lr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Dr(e,this.params.Er).next(function(t){return i=t>h.params.Tr?(Sr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Tr+" from "+t),h.params.Tr):t,s=Date.now(),h.Nr(e,i)}).next(function(t){return r=t,u=Date.now(),h.Or(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.kr(e,r)}).next(function(t){return c=Date.now(),Dr()<=l.DEBUG&&Sr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),ua.resolve({hr:!0,lr:i,_r:o,dr:t})})},vc);function vc(t,e){this.Sr=t,this.params=e}function gc(t,e){this.gr=t,this.cs=e,this.yr=!1,this.Vr=null}function mc(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=wc(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return wc(e)}function wc(t){return t+"\x01\x01"}function bc(t){var e=t.length;if(Lr(2<=e),2===e)return Lr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),oi.U();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&Pr(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Pr()}o=s+2}return new oi(r)}var Ic=function(t){this.Br=t};function Ec(t,e){if(e.document)return n=t.Br,r=e.document,i=!!e.hasCommittedMutations,t=Go(n,r.name),n=qo(r.updateTime),r=new Ys({mapValue:{fields:r.fields}}),new iu(t,n,r,{hasCommittedMutations:!!i});var n,r;if(e.noDocument){var i=ai.Z(e.noDocument.path),o=Dc(e.noDocument.readTime);return new ou(i,o,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){o=ai.Z(e.unknownDocument.path),e=Dc(e.unknownDocument.version);return new su(o,e)}return Pr()}function Tc(t,e,n){var r=_c(n),n=e.key.path.F().L();if(e instanceof iu){var i={name:Bo(i=t.Br,(o=e).key),fields:o.rn().mapValue.fields,updateTime:Uo(i,o.version.v())},o=e.hasCommittedMutations;return new uh(null,null,i,o,r,n)}if(e instanceof ou){var i=e.key.path.L(),o=Nc(e.version),s=e.hasCommittedMutations;return new uh(null,new oh(i,o),null,s,r,n)}if(e instanceof su){s=e.key.path.L(),e=Nc(e.version);return new uh(new sh(s,e),null,null,!0,r,n)}return Pr()}function _c(t){t=t.v();return[t.seconds,t.nanoseconds]}function Ac(t){t=new ri(t[0],t[1]);return ii.V(t)}function Nc(t){t=t.v();return new Xc(t.seconds,t.nanoseconds)}function Dc(t){t=new ri(t.seconds,t.nanoseconds);return ii.V(t)}function Sc(e,t){var n=(t.baseMutations||[]).map(function(t){return Xo(e.Br,t)}),r=t.mutations.map(function(t){return Xo(e.Br,t)}),i=ri.fromMillis(t.localWriteTimeMs);return new Ka(t.batchId,i,n,r)}function Oc(t){var e=Dc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Dc(t.lastLimboFreeSnapshotVersion):ii.min(),r=void 0!==t.query.documents?(Lr(1===(r=t.query).documents.length),wu(lu(Ko(r.documents[0])))):Zo(t.query);return new Ni(r,t.targetId,0,t.lastListenSequenceNumber,e,n,qr.fromBase64String(t.resumeToken))}function xc(t,e){var n=Nc(e.nt),r=Nc(e.lastLimboFreeSnapshotVersion),i=(Ti(e.target)?Jo:$o)(t.Br,e.target),t=e.resumeToken.toBase64();return new ch(e.targetId,Ii(e.target),n,t,e.sequenceNumber,r,i)}var kc=(Pc.Kr=function(t,e,n,r){return Lr(""!==t.uid),new Pc(t.Zs()?t.uid:"",e,n,r)},Pc.prototype.Qr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Cc(t).rs({index:nh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Pc.prototype.Wr=function(d,y,v,g){var m=this,w=Vc(d),b=Cc(d);return b.add({}).next(function(t){Lr("number"==typeof t);for(var e,n,r,i,o,s=new Ka(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Yo(e.Br,t)}),o=r.mutations.map(function(t){return Yo(e.Br,t)}),new nh(n,r.batchId,r.di.toMillis(),i,o)),a=[],c=new Ui(function(t,e){return Vr(t.B(),e.B())}),h=0,f=g;h<f.length;h++){var l=f[h],p=rh.key(m.userId,l.key.path,t),c=c.add(l.key.path.F());a.push(b.put(u)),a.push(w.put(p,rh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.ki.jr(d,t))}),d.Ni(function(){m.Ur[t]=s.keys()}),ua.On(a).next(function(){return s})})},Pc.prototype.Gr=function(t,e){var n=this;return Cc(t).get(e).next(function(t){return t?(Lr(t.userId===n.userId),Sc(n.serializer,t)):null})},Pc.prototype.zr=function(t,e){var n=this;return this.Ur[e]?ua.resolve(this.Ur[e]):this.Gr(t,e).next(function(t){if(t){t=t.keys();return n.Ur[e]=t}return null})},Pc.prototype.Hr=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Cc(t).rs({index:nh.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Lr(e.batchId>=i),o=Sc(r.serializer,e)),n.done()}).next(function(){return o})},Pc.prototype.Yr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Cc(t).rs({index:nh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Pc.prototype.Jr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Cc(t).ts(nh.userMutationsIndex,n).next(function(t){return t.map(function(t){return Sc(e.serializer,t)})})},Pc.prototype.$i=function(o,s){var u=this,t=rh.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),a=[];return Vc(o).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=bc(i);if(r===u.userId&&s.path.isEqual(i))return Cc(o).get(t).next(function(t){if(!t)throw Pr();Lr(t.userId===u.userId),a.push(Sc(u.serializer,t))});n.done()}).next(function(){return a})},Pc.prototype.Ki=function(e,t){var s=this,u=new Ui(Vr),n=[];return t.forEach(function(o){var t=rh.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=Vc(e).rs({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=bc(i);r===s.userId&&o.path.isEqual(i)?u=u.add(t):n.done()});n.push(t)}),ua.On(n).next(function(){return s.Xr(e,u)})},Pc.prototype.Hi=function(t,e){var o=this,s=e.path,u=s.length+1,e=rh.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),a=new Ui(Vr);return Vc(t).rs({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=bc(i);r===o.userId&&s.M(i)?i.length===u&&(a=a.add(t)):n.done()}).next(function(){return o.Xr(t,a)})},Pc.prototype.Xr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Cc(e).get(t).next(function(t){if(null===t)throw Pr();Lr(t.userId===n.userId),r.push(Sc(n.serializer,t))}))}),ua.On(i).next(function(){return r})},Pc.prototype.Zr=function(e,n){var r=this;return Rc(e.eo,this.userId,n).next(function(t){return e.Ni(function(){r.no(n.batchId)}),ua.forEach(t,function(t){return r.qr.so(e,t)})})},Pc.prototype.no=function(t){delete this.Ur[t]},Pc.prototype.io=function(e){var i=this;return this.Qr(e).next(function(t){if(!t)return ua.resolve();var t=IDBKeyRange.lowerBound(rh.prefixForUser(i.userId)),r=[];return Vc(e).rs({range:t},function(t,e,n){t[0]===i.userId?(t=bc(t[1]),r.push(t)):n.done()}).next(function(){Lr(0===r.length)})})},Pc.prototype.ro=function(t,e){return Lc(t,this.userId,e)},Pc.prototype.oo=function(t){var e=this;return Uc(t).get(this.userId).next(function(t){return t||new eh(e.userId,-1,"")})},Pc);function Pc(t,e,n,r){this.userId=t,this.serializer=e,this.ki=n,this.qr=r,this.Ur={}}function Lc(t,o,e){var e=rh.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),u=!1;return Vc(t).rs({range:e,ss:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Rc(t,e,n){var r=t.store(nh.store),i=t.store(rh.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.rs({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Lr(1===s)}));for(var u=[],a=0,c=n.mutations;a<c.length;a++){var h=c[a],f=rh.key(e,h.key.path,n.batchId);o.push(i.delete(f)),u.push(h.key)}return ua.On(o).next(function(){return u})}function Cc(t){return Oh.Kn(t,nh.store)}function Vc(t){return Oh.Kn(t,rh.store)}function Uc(t){return Oh.Kn(t,eh.store)}var Mc,qc=(Bc.prototype.yi=function(t,e,n){return zc(t).put(Kc(e),n)},Bc.prototype.pi=function(t,e){t=zc(t),e=Kc(e);return t.delete(e)},Bc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ao(e,t)})},Bc.prototype.bi=function(t,e){var n=this;return zc(t).get(Kc(e)).next(function(t){return n.co(t)})},Bc.prototype.uo=function(t,e){var n=this;return zc(t).get(Kc(e)).next(function(t){var e=n.co(t);return e?{ho:e,size:Hc(t)}:null})},Bc.prototype.getEntries=function(t,e){var n=this,r=qi;return this.lo(t,e,function(t,e){e=n.co(e);r=r.ot(t,e)}).next(function(){return r})},Bc.prototype._o=function(t,e){var r=this,i=qi,o=new xi(ai.D);return this.lo(t,e,function(t,e){var n=r.co(e);o=n?(i=i.ot(t,n),o.ot(t,Hc(e))):(i=i.ot(t,null),o.ot(t,0))}).next(function(){return{fo:i,do:o}})},Bc.prototype.lo=function(t,e,i){if(e.P())return ua.resolve();var n=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),o=e._t(),s=o.It();return zc(t).rs({range:n},function(t,e,n){for(var r=ai.Z(t);s&&ai.D(s,r)<0;)i(s,null),s=o.It();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.It():null),s?n.Xn(s.path.L()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.It():null})},Bc.prototype.Qi=function(t,r,e){var n,i=this,o=Bi,s=r.path.length+1,u={};return e.isEqual(ii.min())?(n=r.path.L(),u.range=IDBKeyRange.lowerBound(n)):(n=r.path.L(),e=_c(e),u.range=IDBKeyRange.lowerBound([n,e],!0),u.index=uh.collectionReadTimeIndex),zc(t).rs(u,function(t,e,n){t.length===s&&(e=Ec(i.serializer,e),r.path.M(e.key.path)?e instanceof iu&&Nu(r,e)&&(o=o.ot(e.key,e)):n.done())}).next(function(){return o})},Bc.prototype.wo=function(t){return new Fc(this,!!t&&t.Eo)},Bc.prototype.To=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Bc.prototype.getMetadata=function(t){return Gc(t).get(ah.key).next(function(t){return Lr(!!t),t})},Bc.prototype.ao=function(t,e){return Gc(t).put(ah.key,e)},Bc.prototype.co=function(t){if(t){t=Ec(this.serializer,t);return t instanceof ou&&t.version.isEqual(ii.min())?null:t}return null},Bc),Fc=(n(jc,Mc=h),jc.prototype.Di=function(i){var o=this,s=[],u=0,a=new Ui(function(t,e){return Vr(t.B(),e.B())});return this.Ri.forEach(function(t,e){var n,r=o.mo.get(t);e?(n=Tc(o.Io.serializer,e,o.readTime),a=a.add(t.path.F()),e=Hc(n),u+=e-r,s.push(o.Io.yi(i,t,n))):(u-=r,o.Eo?(r=Tc(o.Io.serializer,new ou(t,ii.min()),o.readTime),s.push(o.Io.yi(i,t,r))):s.push(o.Io.pi(i,t)))}),a.forEach(function(t){s.push(o.Io.ki.jr(i,t))}),s.push(this.Io.updateMetadata(i,u)),ua.On(s)},jc.prototype.vi=function(t,e){var n=this;return this.Io.uo(t,e).next(function(t){return null===t?(n.mo.set(e,0),null):(n.mo.set(e,t.size),t.ho)})},jc.prototype.Si=function(t,e){var n=this;return this.Io._o(t,e).next(function(t){var e=t.fo;return t.do.forEach(function(t,e){n.mo.set(t,e)}),e})},jc);function jc(t,e){var n=this;return(n=Mc.call(this)||this).Io=t,n.Eo=e,n.mo=new ni(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function Bc(t,e){this.serializer=t,this.ki=e}function Gc(t){return Oh.Kn(t,ah.store)}function zc(t){return Oh.Kn(t,uh.store)}function Kc(t){return t.path.L()}function Hc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Pr();e=t.noDocument}return JSON.stringify(e).length}var Wc=(th.prototype.jr=function(t,e){return this.Ao.add(e),ua.resolve()},th.prototype.zi=function(t,e){return ua.resolve(this.Ao.getEntries(e))},th),Qc=(Zc.prototype.add=function(t){var e=t.k(),n=t.F(),r=this.index[e]||new Ui(oi.D),t=!r.has(n);return this.index[e]=r.add(n),t},Zc.prototype.has=function(t){var e=t.k(),t=t.F(),e=this.index[e];return e&&e.has(t)},Zc.prototype.getEntries=function(t){return(this.index[t]||new Ui(oi.D)).L()},Zc),Yc=($c.prototype.createOrUpgrade=function(e,n,t,r){var i=this;Lr(t<r&&0<=t&&r<=10);var o=new ga("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(Jc.store),(s=e).createObjectStore(eh.store,{keyPath:eh.keyPath}),s.createObjectStore(nh.store,{keyPath:nh.keyPath,autoIncrement:!0}).createIndex(nh.userMutationsIndex,nh.userMutationsKeyPath,{unique:!0}),s.createObjectStore(rh.store),ph(e),e.createObjectStore(uh.store));var s,u=ua.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(hh.store),s.deleteObjectStore(ch.store),s.deleteObjectStore(fh.store),ph(e)),u=u.next(function(){return t=o.store(fh.store),e=new fh(0,0,ii.min().v(),0),t.put(fh.key,e);var t,e})),t<4&&4<=r&&(0!==t&&(u=u.next(function(){return n=e,(r=o).store(nh.store).ts().next(function(t){n.deleteObjectStore(nh.store),n.createObjectStore(nh.store,{keyPath:nh.keyPath,autoIncrement:!0}).createIndex(nh.userMutationsIndex,nh.userMutationsKeyPath,{unique:!0});var e=r.store(nh.store),t=t.map(function(t){return e.put(t)});return ua.On(t)});var n,r})),u=u.next(function(){e.createObjectStore(dh.store,{keyPath:dh.keyPath})})),t<5&&5<=r&&(u=u.next(function(){return i.removeAcknowledgedMutations(o)})),t<6&&6<=r&&(u=u.next(function(){return e.createObjectStore(ah.store),i.addDocumentGlobal(o)})),t<7&&7<=r&&(u=u.next(function(){return i.ensureSequenceNumbers(o)})),t<8&&8<=r&&(u=u.next(function(){return i.createCollectionParentIndex(e,o)})),t<9&&9<=r&&(u=u.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(uh.store)).createIndex(uh.readTimeIndex,uh.readTimeIndexPath,{unique:!1}),t.createIndex(uh.collectionReadTimeIndex,uh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(u=u.next(function(){return i.rewriteCanonicalIds(o)})),u},$c.prototype.addDocumentGlobal=function(e){var n=0;return e.store(uh.store).rs(function(t,e){n+=Hc(e)}).next(function(){var t=new ah(n);return e.store(ah.store).put(ah.key,t)})},$c.prototype.removeAcknowledgedMutations=function(n){var r=this,t=n.store(eh.store),i=n.store(nh.store);return t.ts().next(function(t){return ua.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.ts(nh.userMutationsIndex,t).next(function(t){return ua.forEach(t,function(t){Lr(t.userId===e.userId);t=Sc(r.serializer,t);return Rc(n,e.userId,t).next(function(){})})})})})},$c.prototype.ensureSequenceNumbers=function(t){var o=t.store(hh.store),e=t.store(uh.store);return t.store(fh.store).get(fh.key).next(function(r){var i=[];return e.rs(function(t,e){var n=new oi(t),t=[0,mc(n)];i.push(o.get(t).next(function(t){return t?ua.resolve():o.put(new hh(0,mc(n),r.highestListenSequenceNumber))}))}).next(function(){return ua.On(i)})})},$c.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(lh.store,{keyPath:lh.keyPath});function r(t){if(i.add(t)){var e=t.k(),t=t.F();return n.put({collectionId:e,parent:mc(t)})}}var n=e.store(lh.store),i=new Qc;return e.store(uh.store).rs({ss:!0},function(t,e){t=new oi(t);return r(t.F())}).next(function(){return e.store(rh.store).rs({ss:!0},function(t,e){t[0];var n=t[1],n=(t[2],bc(n));return r(n.F())})})},$c.prototype.rewriteCanonicalIds=function(t){var n=this,r=t.store(ch.store);return r.rs(function(t,e){e=Oc(e),e=xc(n.serializer,e);return r.put(e)})},$c),Xc=function(t,e){this.seconds=t,this.nanoseconds=e},Jc=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function $c(t){this.serializer=t}function Zc(){this.index={}}function th(){this.Ao=new Qc}Jc.store="owner",Jc.key="owner";var eh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};eh.store="mutationQueues",eh.keyPath="userId";var nh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};nh.store="mutations",nh.keyPath="batchId",nh.userMutationsIndex="userMutationsIndex",nh.userMutationsKeyPath=["userId","batchId"];var rh=(ih.prefixForUser=function(t){return[t]},ih.prefixForPath=function(t,e){return[t,mc(e)]},ih.key=function(t,e,n){return[t,mc(e),n]},ih);function ih(){}rh.store="documentMutations",rh.PLACEHOLDER=new rh;var oh=function(t,e){this.path=t,this.readTime=e},sh=function(t,e){this.path=t,this.version=e},uh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};uh.store="remoteDocuments",uh.readTimeIndex="readTimeIndex",uh.readTimeIndexPath="readTime",uh.collectionReadTimeIndex="collectionReadTimeIndex",uh.collectionReadTimeIndexPath=["parentPath","readTime"];var ah=function(t){this.byteSize=t};ah.store="remoteDocumentGlobal",ah.key="remoteDocumentGlobalKey";var ch=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ch.store="targets",ch.keyPath="targetId",ch.queryTargetsIndexName="queryTargetsIndex",ch.queryTargetsKeyPath=["canonicalId","targetId"];var hh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};hh.store="targetDocuments",hh.keyPath=["targetId","path"],hh.documentTargetsIndex="documentTargetsIndex",hh.documentTargetsKeyPath=["path","targetId"];var fh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};fh.key="targetGlobalKey",fh.store="targetGlobal";var lh=function(t,e){this.collectionId=t,this.parent=e};function ph(t){t.createObjectStore(hh.store,{keyPath:hh.keyPath}).createIndex(hh.documentTargetsIndex,hh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ch.store,{keyPath:ch.keyPath}).createIndex(ch.queryTargetsIndexName,ch.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(fh.store)}lh.store="collectionParents",lh.keyPath=["collectionId","parent"];var dh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};dh.store="clientMetadata",dh.keyPath="clientId";var yh=i(i(i([eh.store,nh.store,rh.store,uh.store,ch.store,Jc.store,fh.store,hh.store],[dh.store]),[ah.store]),[lh.store]),vh=(gh.prototype.jr=function(t,e){var n=this;if(this.Ro.has(e))return ua.resolve();var r=e.k(),i=e.F();t.Ni(function(){n.Ro.add(e)});i={collectionId:r,parent:mc(i)};return mh(t).put(i)},gh.prototype.zi=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Mr(i),""],!1,!0);return mh(t).ts(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(bc(r.parent))}return o})},gh);function gh(){this.Ro=new Qc}function mh(t){return Oh.Kn(t,lh.store)}var wh=(Eh.prototype.next=function(){return this.Po+=2,this.Po},Eh.yo=function(){return new Eh(0)},Eh.Vo=function(){return new Eh(-1)},Eh),bh=(Ih.prototype.po=function(n){var r=this;return this.bo(n).next(function(t){var e=new wh(t.highestTargetId);return t.highestTargetId=e.next(),r.vo(n,t).next(function(){return t.highestTargetId})})},Ih.prototype.So=function(t){return this.bo(t).next(function(t){return ii.V(new ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ih.prototype.Do=function(t){return this.bo(t).next(function(t){return t.highestListenSequenceNumber})},Ih.prototype.Co=function(e,n,r){var i=this;return this.bo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.v()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.vo(e,t)})},Ih.prototype.No=function(e,n){var r=this;return this.xo(e,n).next(function(){return r.bo(e).next(function(t){return t.targetCount+=1,r.Fo(n,t),r.vo(e,t)})})},Ih.prototype.Oo=function(t,e){return this.xo(t,e)},Ih.prototype.ko=function(e,t){var n=this;return this.Mo(e,t.targetId).next(function(){return Th(e).delete(t.targetId)}).next(function(){return n.bo(e)}).next(function(t){return Lr(0<t.targetCount),--t.targetCount,n.vo(e,t)})},Ih.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return Th(n).rs(function(t,e){e=Oc(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,u.push(o.ko(n,e)))}).next(function(){return ua.On(u)}).next(function(){return s})},Ih.prototype.Ce=function(t,n){return Th(t).rs(function(t,e){e=Oc(e);n(e)})},Ih.prototype.bo=function(t){return _h(t).get(fh.key).next(function(t){return Lr(null!==t),t})},Ih.prototype.vo=function(t,e){return _h(t).put(fh.key,e)},Ih.prototype.xo=function(t,e){return Th(t).put(xc(this.serializer,e))},Ih.prototype.Fo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ih.prototype.$o=function(t){return this.bo(t).next(function(t){return t.targetCount})},Ih.prototype.Lo=function(t,r){var e=Ii(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return Th(t).rs({range:e,index:ch.queryTargetsIndexName},function(t,e,n){e=Oc(e);Ei(r,e.target)&&(i=e,n.done())}).next(function(){return i})},Ih.prototype.Bo=function(n,t,r){var i=this,o=[],s=Ah(n);return t.forEach(function(t){var e=mc(t.path);o.push(s.put(new hh(r,e))),o.push(i.qr.qo(n,r,t))}),ua.On(o)},Ih.prototype.Uo=function(n,t,r){var i=this,o=Ah(n);return ua.forEach(t,function(t){var e=mc(t.path);return ua.On([o.delete([r,e]),i.qr.Ko(n,r,t)])})},Ih.prototype.Mo=function(t,e){t=Ah(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},Ih.prototype.Qo=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Ah(t),r=Ki();return t.rs({range:e,ss:!0},function(t,e,n){t=bc(t[1]),t=new ai(t);r=r.add(t)}).next(function(){return r})},Ih.prototype.ro=function(t,e){var e=mc(e.path),e=IDBKeyRange.bound([e],[Mr(e)],!1,!0),i=0;return Ah(t).rs({index:hh.documentTargetsIndex,ss:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ih.prototype.Ue=function(t,e){return Th(t).get(e).next(function(t){return t?Oc(t):null})},Ih);function Ih(t,e){this.qr=t,this.serializer=e}function Eh(t){this.Po=t}function Th(t){return Oh.Kn(t,ch.store)}function _h(t){return Oh.Kn(t,fh.store)}function Ah(t){return Oh.Kn(t,hh.store)}var Nh,Dh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Sh=(n(kh,Nh=Ee),kh),Oh=(xh.Kn=function(t,e){if(t instanceof Sh)return aa.Kn(t.eo,e);throw Pr()},xh.prototype.start=function(){var e=this;return this.ra().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new _r(Tr.FAILED_PRECONDITION,Dh);return e.oa(),e.aa(),e.ca(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.sa.Do(t)})}).then(function(t){e.zo=new Xa(t,e.jo)}).then(function(){e.Ho=!0}).catch(function(t){return e.na&&e.na.close(),Promise.reject(t)})},xh.prototype.ua=function(n){var t=this;return this.ta=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.br?[2,n(e)]:[2]})})},n(this.isPrimary)},xh.prototype.ha=function(n){var t=this;this.na.jn(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},xh.prototype.la=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.br?[4,this.ra()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},xh.prototype.ra=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Lh(e).put(new dh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n._a(e).next(function(t){t||(n.isPrimary=!1,n.fn.Cs(function(){return n.ta(!1)}))})}).next(function(){return n.fa(e)}).next(function(t){return n.isPrimary&&!t?n.da(e).next(function(){return!1}):!!t&&n.wa(e).next(function(){return!0})})}).catch(function(t){if(va(t))return Sr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Sr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.fn.Cs(function(){return n.ta(t)}),n.isPrimary=t})},xh.prototype._a=function(t){var e=this;return Ph(t).get(Jc.key).next(function(t){return ua.resolve(e.Ea(t))})},xh.prototype.Ta=function(t){return Lh(t).delete(this.clientId)},xh.prototype.Ia=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ma(this.Zo,18e5)?[3,2]:(this.Zo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=xh.Kn(t,dh.store);return r.ts().next(function(t){var e=o.Aa(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ua.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.ia)for(n=0,r=e;n<r.length;n++)i=r[n],this.ia.removeItem(this.Ra(i.clientId));t.label=2;case 2:return[2]}})})},xh.prototype.ca=function(){var t=this;this.Xo=this.fn.yn("client_metadata_refresh",4e3,function(){return t.ra().then(function(){return t.Ia()}).then(function(){return t.ca()})})},xh.prototype.Ea=function(t){return!!t&&t.ownerId===this.clientId},xh.prototype.fa=function(e){var r=this;return this.Go?ua.resolve(!0):Ph(e).get(Jc.key).next(function(t){if(null!==t&&r.ma(t.leaseTimestampMs,5e3)&&!r.Pa(t.ownerId)){if(r.Ea(t)&&r.networkEnabled)return!0;if(!r.Ea(t)){if(!t.allowTabSynchronization)throw new _r(Tr.FAILED_PRECONDITION,Dh);return!1}}return!(!r.networkEnabled||!r.inForeground)||Lh(e).ts().next(function(t){return void 0===r.Aa(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Sr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},xh.prototype.ga=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return this.Ho=!1,this.ya(),this.Xo&&(this.Xo.cancel(),this.Xo=null),this.Va(),this.pa(),[4,this.na.runTransaction("shutdown","readwrite",[Jc.store,dh.store],function(t){var e=new Sh(t,Xa.ir);return n.da(e).next(function(){return n.Ta(e)})})];case 1:return t.sent(),this.na.close(),this.ba(),[2]}})})},xh.prototype.Aa=function(t,e){var n=this;return t.filter(function(t){return n.ma(t.updateTimeMs,e)&&!n.Pa(t.clientId)})},xh.prototype.va=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Lh(t).ts().next(function(t){return e.Aa(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(xh.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),xh.prototype.Sa=function(t){return kc.Kr(t,this.serializer,this.ki,this.qr)},xh.prototype.Da=function(){return this.sa},xh.prototype.Ca=function(){return this.Fi},xh.prototype.Na=function(){return this.ki},xh.prototype.runTransaction=function(e,n,r){var i=this;Sr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.na.runTransaction(e,t,yh,function(t){return o=new Sh(t,i.zo?i.zo.next():Xa.ir),"readwrite-primary"===n?i._a(o).next(function(t){return!!t||i.fa(o)}).next(function(t){if(!t)throw Or("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.fn.Cs(function(){return i.ta(!1)}),new _r(Tr.FAILED_PRECONDITION,Wa);return r(o)}).next(function(t){return i.wa(o).next(function(){return t})}):i.xa(o).next(function(){return r(o)})}).then(function(t){return o.xi(),t})},xh.prototype.xa=function(t){var e=this;return Ph(t).get(Jc.key).next(function(t){if(null!==t&&e.ma(t.leaseTimestampMs,5e3)&&!e.Pa(t.ownerId)&&!e.Ea(t)&&!(e.Go||e.allowTabSynchronization&&t.allowTabSynchronization))throw new _r(Tr.FAILED_PRECONDITION,Dh)})},xh.prototype.wa=function(t){var e=new Jc(this.clientId,this.allowTabSynchronization,Date.now());return Ph(t).put(Jc.key,e)},xh.Ln=function(){return aa.Ln()},xh.prototype.da=function(t){var e=this,n=Ph(t);return n.get(Jc.key).next(function(t){return e.Ea(t)?(Sr("IndexedDbPersistence","Releasing primary lease."),n.delete(Jc.key)):ua.resolve()})},xh.prototype.ma=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Or("Detected an update time that is in the future: "+t+" > "+n),1))},xh.prototype.oa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Jo=function(){t.fn.ws(function(){return t.inForeground="visible"===t.document.visibilityState,t.ra()})},this.document.addEventListener("visibilitychange",this.Jo),this.inForeground="visible"===this.document.visibilityState)},xh.prototype.Va=function(){this.Jo&&(this.document.removeEventListener("visibilitychange",this.Jo),this.Jo=null)},xh.prototype.aa=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Yo=function(){e.ya(),e.fn.ws(function(){return e.ga()})},this.window.addEventListener("unload",this.Yo))},xh.prototype.pa=function(){this.Yo&&(this.window.removeEventListener("unload",this.Yo),this.Yo=null)},xh.prototype.Pa=function(t){try{var e=null!==(null===(e=this.ia)||void 0===e?void 0:e.getItem(this.Ra(t)));return Sr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Or("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},xh.prototype.ya=function(){if(this.ia)try{this.ia.setItem(this.Ra(this.clientId),String(Date.now()))}catch(t){Or("Failed to set zombie client id.",t)}},xh.prototype.ba=function(){if(this.ia)try{this.ia.removeItem(this.Ra(this.clientId))}catch(t){}},xh.prototype.Ra=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},xh);function xh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.fn=i,this.window=o,this.document=s,this.jo=a,this.Go=c,this.zo=null,this.Ho=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Yo=null,this.inForeground=!1,this.Jo=null,this.Xo=null,this.Zo=Number.NEGATIVE_INFINITY,this.ta=function(t){return Promise.resolve()},!xh.Ln())throw new _r(Tr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.qr=new Rh(this,r),this.ea=e+"main",this.serializer=new Ic(u),this.na=new aa(this.ea,10,new Yc(this.serializer)),this.sa=new bh(this.qr,this.serializer),this.ki=new vh,this.Fi=(e=this.serializer,u=this.ki,new qc(e,u)),this.window&&this.window.localStorage?this.ia=this.window.localStorage:(this.ia=null,!1===c&&Or("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function kh(t,e){var n=this;return(n=Nh.call(this)||this).eo=t,n.Wo=e,n}function Ph(t){return Oh.Kn(t,Jc.store)}function Lh(t){return Oh.Kn(t,dh.store)}var Rh=(Ch.prototype.Cr=function(t){var n=this.Fa(t);return this.db.Da().$o(t).next(function(e){return n.next(function(t){return e+t})})},Ch.prototype.Fa=function(t){var e=0;return this.Fr(t,function(t){e++}).next(function(){return e})},Ch.prototype.Ce=function(t,e){return this.db.Da().Ce(t,e)},Ch.prototype.Fr=function(t,n){return this.Oa(t,function(t,e){return n(e)})},Ch.prototype.qo=function(t,e,n){return Vh(t,n)},Ch.prototype.Ko=function(t,e,n){return Vh(t,n)},Ch.prototype.Or=function(t,e,n){return this.db.Da().Or(t,e,n)},Ch.prototype.so=Vh,Ch.prototype.ka=function(t,e){return r=e,i=!1,Uc(n=t).os(function(t){return Lc(n,t,r).next(function(t){return t&&(i=!0),ua.resolve(!t)})}).next(function(){return i});var n,r,i},Ch.prototype.kr=function(n,r){var i=this,o=this.db.Ca().wo(),s=[],u=0;return this.Oa(n,function(e,t){t<=r&&(t=i.ka(n,e).next(function(t){if(!t)return u++,o.bi(n,e).next(function(){return o.pi(e),Ah(n).delete([0,mc(e.path)])})}),s.push(t))}).next(function(){return ua.On(s)}).next(function(){return o.apply(n)}).next(function(){return u})},Ch.prototype.removeTarget=function(t,e){e=e.st(t.Wo);return this.db.Da().Oo(t,e)},Ch.prototype.Ma=Vh,Ch.prototype.Oa=function(t,r){var i,t=Ah(t),o=Xa.ir;return t.rs({index:hh.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Xa.ir&&r(new ai(bc(i)),o),o=e,i=t):o=Xa.ir}).next(function(){o!==Xa.ir&&r(new ai(bc(i)),o)})},Ch.prototype.$r=function(t){return this.db.Ca().To(t)},Ch);function Ch(t,e){this.db=t,this.gr=new yc(this,e)}function Vh(t,e){return Ah(t).put((t=t.Wo,new hh(0,mc(e.path),t)))}function Uh(t,e){var n=t.projectId;return t.I||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Mh=(qh.prototype.vr=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Mr(t,n.La)})},qh);function qh(t,e,n){this.persistence=t,this.$a=e,this.La=new xi(Vr),this.Ba=new ni(Ii,Ei),this.qa=ii.min(),this.Oi=t.Sa(n),this.Ua=t.Ca(),this.sa=t.Da(),this.Ka=new Qa(this.Ua,this.Oi,this.persistence.Na()),this.$a.Qa(this.Ka)}function Fh(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Oi,m=e.Ka,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Oi.Jr(v).next(function(t){return g=t,n=e.persistence.Sa(o),m=new Qa(e.Ua,n,e.persistence.Na()),n.Jr(v)}).next(function(t){for(var e=[],n=[],r=Ki(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.qi(v,r).next(function(t){return{Wa:t,ja:e,Ga:n}})})})];case 1:return r=t.sent(),[2,(e.Oi=n,e.Ka=m,e.$a.Qa(e.Ka),r)]}})})}function jh(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,u,a=h.batch.keys(),c=f.Ua.wo({Eo:!0});return e=f,r=t,o=c,s=(i=h).batch,n=s.keys(),u=ua.resolve(),n.forEach(function(n){u=u.next(function(){return o.bi(r,n)}).next(function(t){var e=t,t=i.Ai.get(n);Lr(null!==t),(!e||e.version.u(t)<0)&&(e=s.wi(n,e,i))&&o.yi(e,i.mi)})}),u.next(function(){return e.Oi.Zr(r,s)}).next(function(){return c.apply(t)}).next(function(){return f.Oi.io(t)}).next(function(){return f.Ka.qi(t,a)})})}function Bh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.sa.So(t)})}function Gh(t,a){var c=t,h=a.nt,f=c.La;return c.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var i=c.Ua.wo({Eo:!0});f=c.La;var u=[];a.zt.forEach(function(t,e){var n,r,i,o=f.get(e);o&&(u.push(c.sa.Uo(s,t.se,e).next(function(){return c.sa.Bo(s,t.ee,e)})),0<(i=t.resumeToken).o()&&(n=o.it(i,h).st(s.Wo),f=f.ot(e,n),r=o,i=t,Lr(0<(o=n).resumeToken.o()),(0===r.resumeToken.o()||3e8<=o.nt.p()-r.nt.p()||0<i.ee.size+i.ne.size+i.se.size)&&u.push(c.sa.Oo(s,n))))});var t,o=qi,n=Ki();return a.Yt.forEach(function(t,e){n=n.add(t)}),u.push(i.getEntries(s,n).next(function(r){a.Yt.forEach(function(t,e){var n=r.get(t);e instanceof ou&&e.version.isEqual(ii.min())?(i.pi(t,h),o=o.ot(t,e)):null==n||0<e.version.u(n.version)||0===e.version.u(n.version)&&n.hasPendingWrites?(i.yi(e,h),o=o.ot(t,e)):Sr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Jt.has(t)&&u.push(c.persistence.qr.Ma(s,t))})})),h.isEqual(ii.min())||(t=c.sa.So(s).next(function(t){return c.sa.Co(s,s.Wo,h)}),u.push(t)),ua.On(u).next(function(){return i.apply(s)}).next(function(){return c.Ka.Ui(s,o)})}).then(function(t){return c.La=f,t})}function zh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.sa.Lo(e,r).next(function(t){return t?(n=t,ua.resolve(n)):i.sa.po(e).next(function(t){return n=new Ni(r,t,0,e.Wo),i.sa.No(e,n).next(function(){return n})})})}).then(function(t){var e=i.La.get(t.targetId);return(null===e||0<t.nt.u(e.nt))&&(i.La=i.La.ot(t.targetId,t),i.Ba.set(r,t.targetId)),t})}function Kh(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:n=(e=i).La.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.qr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!va(r=t.sent()))throw r;return Sr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.La=e.La.remove(o),e.Ba.delete(n.target),[2]}})})}function Hh(t,o,s){var u=t,a=ii.min(),c=Ki();return u.persistence.runTransaction("Execute query","readonly",function(e){return t=u,n=e,r=wu(o),(void 0!==(t=(i=t).Ba.get(r))?ua.resolve(i.La.get(t)):i.sa.Lo(n,r)).next(function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,u.sa.Qo(e,t.targetId).next(function(t){c=t})}).next(function(){return u.$a.Qi(e,o,s?a:ii.min(),s?c:Ki())}).next(function(t){return{documents:t,za:c}});var t,n,r,i})}function Wh(t,e){var n=t,r=n.sa,t=n.La.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Ue(t,e).next(function(t){return t?t.target:null})})}function Qh(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Ua,n=t,t=s.qa,r=e,i=qi,o=_c(t),t=zc(n),n=IDBKeyRange.lowerBound(o,!0),t.rs({index:uh.readTimeIndex,range:n},function(t,e){var n=Ec(r.serializer,e);i=i.ot(n.key,n),o=e.readTime}).next(function(){return{Ha:i,readTime:Ac(o)}});var e,n,r,i,o}).then(function(t){var e=t.Ha,t=t.readTime;return s.qa=t,e})}function Yh(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=zc(t),r=ii.min(),t.rs({index:uh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Ac(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.qa=t})]})})}function Xh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Tr.FAILED_PRECONDITION||e.message!==Wa)throw e;return Sr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Jh(t,e,n,r,i){var o=this;this.Bc=t,this.qc=e,this.cs=n,this.Uc={},this.Kc=[],this.Qc=new Map,this.Wc=new Set,this.jc=[],this.Gc=i,this.Gc.zc(function(t){n.ws(function(){return y(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return wf(this)?(Sr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(4),[4,lf(e)];case 1:return t.sent(),e.Hc.set("Unknown"),e.Wc.delete(4),[4,ff(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Hc=new of(n,r)}var $h,Zh,tf,Te=(hf.prototype.ec=function(){return 1===this.state||2===this.state||4===this.state},hf.prototype.nc=function(){return 2===this.state},hf.prototype.start=function(){3!==this.state?this.auth():this.sc()},hf.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ec()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},hf.prototype.ic=function(){this.state=0,this.ys.reset()},hf.prototype.rc=function(){var t=this;this.nc()&&null===this.tc&&(this.tc=this.fn.yn(this.Ya,6e4,function(){return t.oc()}))},hf.prototype.ac=function(t){this.cc(),this.stream.send(t)},hf.prototype.oc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.nc()?[2,this.close(0)]:[2]})})},hf.prototype.cc=function(){this.tc&&(this.tc.cancel(),this.tc=null)},hf.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cc(),this.ys.cancel(),this.Za++,3!==e?this.ys.reset():n&&n.code===Tr.RESOURCE_EXHAUSTED?(Or(n.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.ys.Rn()):n&&n.code===Tr.UNAUTHENTICATED&&this.Xa.ri(),null!==this.stream&&(this.uc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.hc(n)];case 1:return t.sent(),[2]}})})},hf.prototype.uc=function(){},hf.prototype.auth=function(){var n=this;this.state=1;var t=this.lc(this.Za),e=this.Za;this.Xa.getToken().then(function(t){n.Za===e&&n._c(t)},function(e){t(function(){var t=new _r(Tr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fc(t)})})},hf.prototype._c=function(t){var e=this,n=this.lc(this.Za);this.stream=this.dc(t),this.stream.wc(function(){n(function(){return e.state=2,e.listener.wc()})}),this.stream.hc(function(t){n(function(){return e.fc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},hf.prototype.sc=function(){var t=this;this.state=4,this.ys.Pn(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},hf.prototype.fc=function(t){return Sr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},hf.prototype.lc=function(e){var n=this;return function(t){n.fn.ws(function(){return n.Za===e?t():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},hf),ef=(n(cf,tf=Te),cf.prototype.dc=function(t){return this.Ja.Ec("Listen",t)},cf.prototype.onMessage=function(t){this.ys.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(i=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:Pr(),r=e.targetChange.targetIds||[],i=(o=e.targetChange.resumeToken,t.Ke?(Lr(void 0===o||"string"==typeof o),qr.fromBase64String(o||"")):(Lr(void 0===o||o instanceof Uint8Array),qr.fromUint8Array(o||new Uint8Array))),o=e.targetChange.cause,s=o&&(o=void 0===(s=o).code?Tr.UNKNOWN:Oi(s.code),new _r(o,s.message||"")),r=new to(n,r,i,s||null)}else if("documentChange"in e){e.documentChange;var u=e.documentChange;u.document,u.document.name,u.document.updateTime;var i=Go(t,u.document.name),a=qo(u.document.updateTime),s=new Ys({mapValue:{fields:u.document.fields}}),a=new iu(i,a,s,{}),s=u.targetIds||[],u=u.removedTargetIds||[];r=new $i(s,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;u=e.documentDelete;u.document;var a=Go(t,u.document),c=u.readTime?qo(u.readTime):ii.min(),c=new ou(a,c),u=u.removedTargetIds||[];r=new $i([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;c=e.documentRemove;c.document;var h=Go(t,c.document),c=c.removedTargetIds||[];r=new $i([],c,h,null)}else{if(!("filter"in e))return Pr();e.filter;h=e.filter;h.targetId;e=h.count||0,e=new _i(e),h=h.targetId;r=new Zi(h,e)}return r}(this.serializer,t),t=function(t){if(!("targetChange"in t))return ii.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?qo(t.readTime):ii.min()}(t);return this.listener.Tc(e,t)},cf.prototype.Ic=function(t){var e,n,r,i={};i.database=Ho(this.serializer),i.addTarget=(e=this.serializer,(r=Ti(r=(n=t).target)?{documents:Jo(e,r)}:{query:$o(e,r)}).targetId=n.targetId,0<n.resumeToken.o()&&(r.resumeToken=Mo(e,n.resumeToken)),r);var o,t=(this.serializer,o=t,null==(t=function(){switch(o.et){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Pr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.ac(i)},cf.prototype.mc=function(t){var e={};e.database=Ho(this.serializer),e.removeTarget=t,this.ac(e)},cf),nf=(n(af,Zh=Te),Object.defineProperty(af.prototype,"Rc",{get:function(){return this.Ac},enumerable:!1,configurable:!0}),af.prototype.start=function(){this.Ac=!1,this.lastStreamToken=void 0,Zh.prototype.start.call(this)},af.prototype.uc=function(){this.Ac&&this.Pc([])},af.prototype.dc=function(t){return this.Ja.Ec("Write",t)},af.prototype.onMessage=function(t){if(Lr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Ac){this.ys.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Lr(void 0!==r),n.map(function(t){return function(t,e){var n=t.updateTime?qo(t.updateTime):qo(e);n.isEqual(ii.min())&&(n=qo(e));e=null;return t.transformResults&&0<t.transformResults.length&&(e=t.transformResults),new Ns(n,e)}(t,r)})):[]),n=qo(t.commitTime);return this.listener.gc(n,e)}var n,r;return Lr(!t.writeResults||0===t.writeResults.length),this.Ac=!0,this.listener.yc()},af.prototype.Vc=function(){var t={};t.database=Ho(this.serializer),this.ac(t)},af.prototype.Pc=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Yo(e.serializer,t)})};this.ac(t)},af),rf=(n(uf,$h=function(){}),uf.prototype.vc=function(){if(this.bc)throw new _r(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},uf.prototype.Sc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ja.Sc(e,n,r,t)}).catch(function(t){throw t.code===Tr.UNAUTHENTICATED&&i.credentials.ri(),t})},uf.prototype.Dc=function(e,n,r){var i=this;return this.vc(),this.credentials.getToken().then(function(t){return i.Ja.Dc(e,n,r,t)}).catch(function(t){throw t.code===Tr.UNAUTHENTICATED&&i.credentials.ri(),t})},uf.prototype.terminate=function(){this.bc=!1},uf),of=(sf.prototype.Oc=function(){var t=this;0===this.Nc&&(this.kc("Unknown"),this.xc=this.cs.yn("online_state_timeout",1e4,function(){return t.xc=null,t.Mc("Backend didn't respond within 10 seconds."),t.kc("Offline"),Promise.resolve()}))},sf.prototype.$c=function(t){"Online"===this.state?this.kc("Unknown"):(this.Nc++,1<=this.Nc&&(this.Lc(),this.Mc("Connection failed 1 times. Most recent error: "+t.toString()),this.kc("Offline")))},sf.prototype.set=function(t){this.Lc(),this.Nc=0,"Online"===t&&(this.Fc=!1),this.kc(t)},sf.prototype.kc=function(t){t!==this.state&&(this.state=t,this.Cc(t))},sf.prototype.Mc=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fc?(Or(t),this.Fc=!1):Sr("OnlineStateTracker",t)},sf.prototype.Lc=function(){null!==this.xc&&(this.xc.cancel(),this.xc=null)},sf);function sf(t,e){this.cs=t,this.Cc=e,this.state="Unknown",this.Nc=0,this.xc=null,this.Fc=!0}function uf(t,e,n){var r=this;return(r=$h.call(this)||this).credentials=t,r.Ja=e,r.serializer=n,r.bc=!1,r}function af(t,e,n,r,i){var o=this;return(o=Zh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Ac=!1,o}function cf(t,e,n,r,i){var o=this;return(o=tf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function hf(t,e,n,r,i,o){this.fn=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tc=null,this.stream=null,this.ys=new sa(t,e)}function ff(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(!wf(r))return[3,4];e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function lf(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:e=0,n=r.jc,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function pf(t,e){t.Qc.has(e.targetId)||(t.Qc.set(e.targetId,e),mf(t)?gf(t):Sf(t).nc()&&yf(t,e))}function df(t,e){var n=t,t=Sf(n);n.Qc.delete(e),t.nc()&&vf(n,e),0===n.Qc.size&&(t.nc()?t.rc():wf(n)&&n.Hc.set("Unknown"))}function yf(t,e){t.Yc.me(e.targetId),Sf(t).Ic(e)}function vf(t,e){t.Yc.me(e),Sf(t).mc(e)}function gf(e){e.Yc=new no({qe:function(t){return e.Uc.qe(t)},Ue:function(t){return e.Qc.get(t)||null}}),Sf(e).start(),e.Hc.Oc()}function mf(t){return wf(t)&&!Sf(t).ec()&&0<t.Qc.size}function wf(t){return 0===t.Wc.size}function bf(t){t.Yc=void 0}function If(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:if(s.Hc.set("Online"),!(u instanceof to&&2===u.state&&u.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Qc.has(i)?[4,o.Uc.Jc(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Qc.delete(i),o.Yc.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,u)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Sr("RemoteStore","Failed to remove targets %s: %s ",u.targetIds.join(","),n),[4,Ef(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(u instanceof $i?s.Yc.be(u):u instanceof Zi?s.Yc.Oe(u):s.Yc.De(u),a.isEqual(ii.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Bh(s.Bc)];case 8:return o=t.sent(),0<=a.u(o)?[4,(i=a,(e=(r=s).Yc.$e(i)).zt.forEach(function(t,e){var n;0<t.resumeToken.o()&&((n=r.Qc.get(e))&&r.Qc.set(e,n.it(t.resumeToken,i)))}),e.Ht.forEach(function(t){var e=r.Qc.get(t);e&&(r.Qc.set(t,e.it(qr.h,e.nt)),vf(r,t),e=new Ni(e.target,t,1,e.sequenceNumber),yf(r,e))}),r.Uc.Xc(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Sr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Ef(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Ef(n,r,i){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!va(r))throw r;return n.Wc.add(1),[4,lf(n)];case 1:return t.sent(),n.Hc.set("Offline"),i=i||function(){return Bh(n.Bc)},n.cs.Cs(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Sr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Wc.delete(1),[4,ff(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Tf(e,n){return n().catch(function(t){return Ef(e,t,n)})}function _f(a){return y(this,void 0,void 0,function(){var i,o,s,u;return v(this,function(t){switch(t.label){case 0:o=Of(i=a),s=0<i.Kc.length?i.Kc[i.Kc.length-1].batchId:-1,t.label=1;case 1:if(!(wf(i)&&i.Kc.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.Bc,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Oi.Hr(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Kc.length&&o.rc(),[3,7]):(s=u.batchId,function(t,e){t.Kc.push(e);t=Of(t);t.nc()&&t.Rc&&t.Pc(e.mutations)}(i,u),[3,6]);case 4:return u=t.sent(),[4,Ef(i,u)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Af(i)&&Nf(i),[2]}var e,n,r})})}function Af(t){return wf(t)&&!Of(t).ec()&&0<t.Kc.length}function Nf(t){Of(t).start()}function Df(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,r?(e.Wc.delete(2),[4,ff(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Wc.add(2),[4,lf(e)]);case 3:t.sent(),e.Hc.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Sf(n){var t,e,r,i=this;return n.eu||(n.eu=(t=n.qc,e=n.cs,r={wc:function(n){return y(this,void 0,void 0,function(){return v(this,function(t){return n.Qc.forEach(function(t,e){yf(n,t)}),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){return bf(e),mf(e)?(e.Hc.$c(n),gf(e)):e.Hc.set("Unknown"),[2]})})}.bind(null,n),Tc:If.bind(null,n)},t.vc(),new ef(e,t.Ja,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.eu.ic(),mf(n)?gf(n):n.Hc.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.eu.stop()];case 2:t.sent(),bf(n),t.label=3;case 3:return[2]}})})})),n.eu}function Of(n){var t,e,r,i=this;return n.nu||(n.nu=(t=n.qc,e=n.cs,r={wc:function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Of(e).Vc(),[2]})})}.bind(null,n),hc:function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return n&&Of(e).Rc?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return Si(n=i.code)&&n!==Tr.ABORTED?(e=r.Kc.shift(),Of(r).ic(),[4,Tf(r,function(){return r.Uc.tu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,_f(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Af(e)&&Nf(e),[2]}})})}.bind(null,n),yc:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){for(e=Of(o),n=0,r=o.Kc;n<r.length;n++)i=r[n],e.Pc(i.mutations);return[2]})})}.bind(null,n),gc:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=r.Kc.shift(),n=Ha.from(e,i,o),[4,Tf(r,function(){return r.Uc.Zc(n)})];case 1:return t.sent(),[4,_f(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.vc(),new nf(e,t.Ja,t.credentials,t.serializer,r)),n.jc.push(function(e){return y(i,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(n.nu.ic(),[4,_f(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.nu.stop()];case 3:t.sent(),0<n.Kc.length&&(Sr("RemoteStore","Stopping write stream with "+n.Kc.length+" pending writes"),n.Kc=[]),t.label=4;case 4:return[2]}})})})),n.nu}var xf=(Lf.prototype.P=function(){return this.su.P()},Lf.prototype.qo=function(t,e){e=new kf(t,e);this.su=this.su.add(e),this.ru=this.ru.add(e)},Lf.prototype.au=function(t,e){var n=this;t.forEach(function(t){return n.qo(t,e)})},Lf.prototype.Ko=function(t,e){this.cu(new kf(t,e))},Lf.prototype.uu=function(t,e){var n=this;t.forEach(function(t){return n.Ko(t,e)})},Lf.prototype.hu=function(t){var e=this,n=new ai(new oi([])),r=new kf(n,t),t=new kf(n,t+1),i=[];return this.ru.xt([r,t],function(t){e.cu(t),i.push(t.key)}),i},Lf.prototype.lu=function(){var e=this;this.su.forEach(function(t){return e.cu(t)})},Lf.prototype.cu=function(t){this.su=this.su.delete(t),this.ru=this.ru.delete(t)},Lf.prototype._u=function(t){var e=new ai(new oi([])),n=new kf(e,t),t=new kf(e,t+1),r=Ki();return this.ru.xt([n,t],function(t){r=r.add(t.key)}),r},Lf.prototype.ro=function(t){var e=new kf(t,0),e=this.su.Ot(e);return null!==e&&t.isEqual(e.key)},Lf),kf=(Pf.iu=function(t,e){return ai.D(t.key,e.key)||Vr(t.fu,e.fu)},Pf.ou=function(t,e){return Vr(t.fu,e.fu)||ai.D(t.key,e.key)},Pf);function Pf(t,e){this.key=t,this.fu=e}function Lf(){this.su=new Ui(kf.iu),this.ru=new Ui(kf.ou)}function Rf(t,e){return"firestore_clients_"+t+"_"+e}function Cf(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.Zs()&&(n+="_"+e.uid),n}function Vf(t,e){return"firestore_targets_"+t+"_"+e}var Uf=(il.du=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new _r(r.error.code,r.error.message)),i?new il(t,e,r.state,o):(Or("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},il.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},il),Mf=(rl.du=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new _r(n.error.code,n.error.message)),r?new rl(t,n.state,i):(Or("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},rl.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},rl),qf=(nl.du=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Hi,o=0;r&&o<n.activeTargetIds.length;++o)r=mi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new nl(t,i):(Or("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},nl),Ff=(el.du=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new el(e.clientId,e.onlineState):(Or("SharedClientState","Failed to parse online state: "+t),null)},el),jf=(tl.prototype.Eu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},tl.prototype.Tu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},tl.prototype.wu=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},tl),Bf=(Zf.Ln=function(t){return!(!t||!t.localStorage)},Zf.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f=this;return v(this,function(t){switch(t.label){case 0:return[4,this.mu.va()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Iu&&(i=this.getItem(Rf(this.persistenceKey,r)))&&(o=qf.du(r,i))&&(this.Pu=this.Pu.ot(o.clientId,o));for(this.Du(),(s=this.storage.getItem(this.Su))&&(u=this.Cu(s))&&this.Nu(u),a=0,c=this.gu;a<c.length;a++)h=c[a],this.Ru(h);return this.gu=[],this.window.addEventListener("unload",function(){return f.ga()}),this.br=!0,[2]}})})},Zf.prototype.sr=function(t){this.setItem(this.Vu,JSON.stringify(t))},Zf.prototype.xu=function(){return this.Fu(this.Pu)},Zf.prototype.Ou=function(n){var r=!1;return this.Pu.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Zf.prototype.ku=function(t){this.Mu(t,"pending")},Zf.prototype.$u=function(t,e,n){this.Mu(t,e,n),this.Lu(t)},Zf.prototype.Bu=function(t){var e,n="not-current";return this.Ou(t)&&(!(e=this.storage.getItem(Vf(this.persistenceKey,t)))||(e=Mf.du(t,e))&&(n=e.state)),this.qu.Eu(t),this.Du(),n},Zf.prototype.Uu=function(t){this.qu.Tu(t),this.Du()},Zf.prototype.Ku=function(t){return this.qu.activeTargetIds.has(t)},Zf.prototype.Qu=function(t){this.removeItem(Vf(this.persistenceKey,t))},Zf.prototype.Wu=function(t,e,n){this.ju(t,e,n)},Zf.prototype.Gu=function(t,e,n){var r=this;e.forEach(function(t){r.Lu(t)}),this.currentUser=t,n.forEach(function(t){r.ku(t)})},Zf.prototype.zu=function(t){this.Hu(t)},Zf.prototype.ga=function(){this.br&&(this.window.removeEventListener("storage",this.Au),this.removeItem(this.yu),this.br=!1)},Zf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Sr("SharedClientState","READ",t,e),e},Zf.prototype.setItem=function(t,e){Sr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Zf.prototype.removeItem=function(t){Sr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Zf.prototype.Ru=function(t){var e=this,s=t;if(s.storageArea===this.storage){if(Sr("SharedClientState","EVENT",s.key,s.newValue),s.key===this.yu)return void Or("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){if(this.br){if(null!==s.key)if(this.pu.test(s.key)){if(null==s.newValue)return e=this.Yu(s.key),[2,this.Ju(e,null)];if(e=this.Xu(s.key,s.newValue))return[2,this.Ju(e.clientId,e)]}else if(this.bu.test(s.key)){if(null!==s.newValue&&(n=this.Zu(s.key,s.newValue)))return[2,this.th(n)]}else if(this.vu.test(s.key)){if(null!==s.newValue&&(r=this.eh(s.key,s.newValue)))return[2,this.nh(r)]}else if(s.key===this.Su){if(null!==s.newValue&&(i=this.Cu(s.newValue)))return[2,this.Nu(i)]}else s.key===this.Vu&&(o=function(t){var e=Xa.ir;if(null!=t)try{var n=JSON.parse(t);Lr("number"==typeof n),e=n}catch(t){Or("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Xa.ir&&this.tr(o)}else this.gu.push(s);return[2]})})})}},Object.defineProperty(Zf.prototype,"qu",{get:function(){return this.Pu.get(this.Iu)},enumerable:!1,configurable:!0}),Zf.prototype.Du=function(){this.setItem(this.yu,this.qu.wu())},Zf.prototype.Mu=function(t,e,n){n=new Uf(this.currentUser,t,e,n),t=Cf(this.persistenceKey,this.currentUser,t);this.setItem(t,n.wu())},Zf.prototype.Lu=function(t){t=Cf(this.persistenceKey,this.currentUser,t);this.removeItem(t)},Zf.prototype.Hu=function(t){t={clientId:this.Iu,onlineState:t};this.storage.setItem(this.Su,JSON.stringify(t))},Zf.prototype.ju=function(t,e,n){var r=Vf(this.persistenceKey,t),n=new Mf(t,e,n);this.setItem(r,n.wu())},Zf.prototype.Yu=function(t){t=this.pu.exec(t);return t?t[1]:null},Zf.prototype.Xu=function(t,e){t=this.Yu(t);return qf.du(t,e)},Zf.prototype.Zu=function(t,e){var n=this.bu.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Uf.du(new Ua(n),t,e)},Zf.prototype.eh=function(t,e){t=this.vu.exec(t),t=Number(t[1]);return Mf.du(t,e)},Zf.prototype.Cu=function(t){return Ff.du(t)},Zf.prototype.th=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.mu.sh(e.batchId,e.state,e.error)]:(Sr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Zf.prototype.nh=function(t){return this.mu.ih(t.targetId,t.state,t.error)},Zf.prototype.Ju=function(t,e){var n=this,r=e?this.Pu.ot(t,e):this.Pu.remove(t),i=this.Fu(this.Pu),o=this.Fu(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.mu.rh(s,u).then(function(){n.Pu=r})},Zf.prototype.Nu=function(t){this.Pu.get(t.clientId)&&this.Cc(t.onlineState)},Zf.prototype.Fu=function(t){var n=Hi;return t.forEach(function(t,e){n=n.kt(e.activeTargetIds)}),n},Zf),Gf=($f.prototype.ku=function(t){},$f.prototype.$u=function(t,e,n){},$f.prototype.Bu=function(t){return this.oh.Eu(t),this.ah[t]||"not-current"},$f.prototype.Wu=function(t,e,n){this.ah[t]=e},$f.prototype.Uu=function(t){this.oh.Tu(t)},$f.prototype.Ku=function(t){return this.oh.activeTargetIds.has(t)},$f.prototype.Qu=function(t){delete this.ah[t]},$f.prototype.xu=function(){return this.oh.activeTargetIds},$f.prototype.Ou=function(t){return this.oh.activeTargetIds.has(t)},$f.prototype.start=function(){return this.oh=new jf,Promise.resolve()},$f.prototype.Gu=function(t,e,n){},$f.prototype.zu=function(t){},$f.prototype.ga=function(){},$f.prototype.sr=function(t){},$f),zf=function(t){this.key=t},Kf=function(t){this.key=t},Hf=(Object.defineProperty(Jf.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),Jf.prototype.wh=function(t,e){var s=this,u=e?e.Eh:new Qi,a=(e||this).fh,c=(e||this).Qt,h=a,f=!1,l=pu(this.query)&&a.size===this.query.limit?a.last():null,p=du(this.query)&&a.size===this.query.limit?a.first():null;if(t.ht(function(t,e){var n=a.get(t),r=(r=e instanceof iu?e:null)&&(Nu(s.query,r)?r:null),i=!!n&&s.Qt.has(n.key),o=!!r&&(r.Je||s.Qt.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:3,doc:r}),e=!0):s.Th(n,r)||(u.track({type:2,doc:r}),e=!0,(l&&0<s._h(r,l)||p&&s._h(r,p)<0)&&(f=!0)):!n&&r?(u.track({type:0,doc:r}),e=!0):n&&!r&&(u.track({type:1,doc:n}),e=!0,(l||p)&&(f=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),pu(this.query)||du(this.query))for(;h.size>this.query.limit;){var n=pu(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);u.track({type:1,doc:n})}return{fh:h,Eh:u,Ih:f,Qt:c}},Jf.prototype.Th=function(t,e){return t.Je&&e.hasCommittedMutations&&!e.Je},Jf.prototype.Di=function(t,e,n){var o=this,r=this.fh;this.fh=t.fh,this.Qt=t.Qt;var i=t.Eh.Ut();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o._h(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pr()}}var r,i}),this.mh(n);var s=e?this.Ah():[],n=0===this.lh.size&&this.te?1:0,e=n!==this.hh;return this.hh=n,0!==i.length||e?{snapshot:new Yi(this.query,t.fh,r,i,t.Qt,0==n,e,!1),Rh:s}:{Rh:s}},Jf.prototype.Ks=function(t){return this.te&&"Offline"===t?(this.te=!1,this.Di({fh:this.fh,Eh:new Qi,Qt:this.Qt,Ih:!1},!1)):{Rh:[]}},Jf.prototype.Ph=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Je},Jf.prototype.mh=function(t){var e=this;t&&(t.ee.forEach(function(t){return e.uh=e.uh.add(t)}),t.ne.forEach(function(t){}),t.se.forEach(function(t){return e.uh=e.uh.delete(t)}),this.te=t.te)},Jf.prototype.Ah=function(){var e=this;if(!this.te)return[];var n=this.lh;this.lh=Ki(),this.fh.forEach(function(t){e.Ph(t.key)&&(e.lh=e.lh.add(t.key))});var r=[];return n.forEach(function(t){e.lh.has(t)||r.push(new Kf(t))}),this.lh.forEach(function(t){n.has(t)||r.push(new zf(t))}),r},Jf.prototype.gh=function(t){this.uh=t.za,this.lh=Ki();t=this.wh(t.documents);return this.Di(t,!0)},Jf.prototype.yh=function(){return Yi.Gt(this.query,this.fh,this.Qt,0===this.hh)},Jf),Wf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Qf=function(t){this.key=t,this.Vh=!1},Yf=(Object.defineProperty(Xf.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),Xf);function Xf(t,e,n,r,i,o){this.Bc=t,this.ph=e,this.bh=n,this.Sh=r,this.currentUser=i,this.Dh=o,this.Ch={},this.Nh=new ni(_u,Tu),this.xh=new Map,this.Fh=[],this.Oh=new xi(ai.D),this.kh=new Map,this.Mh=new xf,this.$h={},this.Lh=new Map,this.Bh=wh.Vo(),this.onlineState="Unknown",this.qh=void 0}function Jf(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=Ki(),this.Qt=Ki(),this._h=Du(t),this.fh=new Wi(this._h)}function $f(){this.oh=new jf,this.ah={},this.Cc=null,this.tr=null}function Zf(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this.Iu=r,this.mu=null,this.Cc=null,this.tr=null,this.Au=this.Ru.bind(this),this.Pu=new xi(Vr),this.br=!1,this.gu=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.yu=Rf(this.persistenceKey,this.Iu),this.Vu="firestore_sequence_number_"+this.persistenceKey,this.Pu=this.Pu.ot(this.Iu,new jf),this.pu=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.bu=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.vu=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.Su="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.Au)}function tl(){this.activeTargetIds=Hi}function el(t,e){this.clientId=t,this.onlineState=e}function nl(t,e){this.clientId=t,this.activeTargetIds=e}function rl(t,e,n){this.targetId=t,this.state=e,this.error=n}function il(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function ol(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return i.Kh=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=i.view.wh(o)).Ih?[4,Hh(r.Bc,i.query,!1).then(function(t){t=t.documents;return i.view.wh(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.zt.get(i.targetId),n=i.view.Di(e,r.Uh,n),[2,(yl(r,i.targetId,n.Rh),n.snapshot)]}})})}(i,t,e,n)},[4,Hh(i.Bc,o,!0)];case 1:return n=t.sent(),r=new Hf(o,n.za),e=r.wh(n.documents),n=Ji.Zt(s,u&&"Offline"!==i.onlineState),n=r.Di(e,i.Uh,n),yl(i,s,n.Rh),r=new Wf(o,s,r),[2,(i.Nh.set(o,r),i.xh.has(s)?i.xh.get(s).push(o):i.xh.set(s,[o]),n.snapshot)]}})})}function sl(l,p,d){return y(this,void 0,void 0,function(){var s,u;return v(this,function(t){switch(t.label){case 0:u=_l(l),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=u.Bc,a=p,h=i,f=ri.now(),o=a.reduce(function(t,e){return t.add(e.key)},Ki()),h.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.Ka.qi(u,o).next(function(t){c=t;for(var s,e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=(s=i,o=c.get(i.key),s instanceof Bs?function(t){for(var e=null,n=0,r=s.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof iu?t.field(i.field):void 0,o=ss(i.transform,o||null);null!=o&&(e=(null==e?new Xs:e).set(i.field,o))}return e?e.Xe():null}(o):null);null!=o&&e.push(new Us(i.key,o,function s(t){var u=[];return $r(t.fields||{},function(t,e){var n=new ui([t]);if(xo(e))if(0===(e=s(e.mapValue).fields).length)u.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];u.push(n.child(o))}else u.push(n)}),new Ts(u)}(o.proto.mapValue),Ds.exists(!0)))}return h.Oi.Wr(u,f,e,a)})}).then(function(t){var e=t.Ii(c);return{batchId:t.batchId,Ri:e}}))];case 2:return s=t.sent(),u.Sh.ku(s.batchId),e=u,n=s.batchId,r=d,i=(i=(i=e.$h[e.currentUser.ti()])||new xi(Vr)).ot(n,r),e.$h[e.currentUser.ti()]=i,[4,gl(u,s.Ri)];case 3:return t.sent(),[4,_f(u.ph)];case 4:return t.sent(),[3,6];case 5:return u=t.sent(),u=xa(u,"Failed to persist write"),d.reject(u),[3,6];case 6:return[2]}var e,n,r,i,a,c,h,f,o})})}function ul(r,i){return y(this,void 0,void 0,function(){var n,e;return v(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Gh(n.Bc,i)];case 2:return e=t.sent(),i.zt.forEach(function(t,e){e=n.kh.get(e);e&&(Lr(t.ee.size+t.ne.size+t.se.size<=1),0<t.ee.size?e.Vh=!0:0<t.ne.size?Lr(e.Vh):0<t.se.size&&(Lr(e.Vh),e.Vh=!1))}),[4,gl(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Xh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function al(t,n,e){var r,t=t;(t.Uh&&0===e||!t.Uh&&1===e)&&(r=[],t.Nh.forEach(function(t,e){e=e.view.Ks(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.Bs.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Ks(i)&&(o=!0)}),o&&Ca(t)}(t.bh,n),r.length&&t.Ch.Tc(r),t.onlineState=n,t.Uh&&t.Sh.zu(n))}function cl(s,u,a){return y(this,void 0,void 0,function(){var n,o;return v(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Bc,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Oi.Gr(e,r).next(function(t){return Lr(null!==t),n=t.keys(),i.Oi.Zr(e,t)}).next(function(){return i.Oi.io(e)}).next(function(){return i.Ka.qi(e,n)})}))];case 2:return o=t.sent(),ll(n,u,a),fl(n,u),n.Sh.$u(u,"rejected",a),[4,gl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Xh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function hl(o,s){return y(this,void 0,void 0,function(){var n,r,i;return v(this,function(t){switch(t.label){case 0:wf((n=o).ph)||Sr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Bc).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Oi.Yr(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Lh.get(r)||[]).push(s),n.Lh.set(r,i),[3,4]);case 3:return i=t.sent(),i=xa(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function fl(t,e){(t.Lh.get(e)||[]).forEach(function(t){t.resolve()}),t.Lh.delete(e)}function ll(t,e,n){var r=t,i=r.$h[r.currentUser.ti()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.$h[r.currentUser.ti()]=i)}function pl(e,t,n){void 0===n&&(n=null),e.Sh.Uu(t);for(var r=0,i=e.xh.get(t);r<i.length;r++){var o=i[r];e.Nh.delete(o),n&&e.Ch.Qh(o,n)}e.xh.delete(t),e.Uh&&e.Mh.hu(t).forEach(function(t){e.Mh.ro(t)||dl(e,t)})}function dl(t,e){var n=t.Oh.get(e);null!==n&&(df(t.ph,n),t.Oh=t.Oh.remove(e),t.kh.delete(n),vl(t))}function yl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof zf?(t.Mh.qo(o.key,e),function(t,e){e=e.key;t.Oh.get(e)||(Sr("SyncEngine","New document in limbo: "+e),t.Fh.push(e),vl(t))}(t,o)):o instanceof Kf?(Sr("SyncEngine","Document no longer in limbo: "+o.key),t.Mh.Ko(o.key,e),t.Mh.ro(o.key)||dl(t,o.key)):Pr()}}function vl(t){for(;0<t.Fh.length&&t.Oh.size<t.Dh;){var e=t.Fh.shift(),n=t.Bh.next();t.kh.set(n,new Qf(e)),t.Oh=t.Oh.ot(e,n),pf(t.ph,new Ni(wu(lu(e.path)),n,2,Xa.ir))}}function gl(e,s,u){return y(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Nh.P()?[3,3]:(n.Nh.forEach(function(t,e){o.push(n.Kh(e,s,u).then(function(t){t&&(n.Uh&&n.Sh.Wu(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=Ya.Zi(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.Ch.Tc(r),[4,function(a,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,u;return v(this,function(t){switch(t.label){case 0:r=a,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ua.forEach(c,function(e){return ua.forEach(e.Ji,function(t){return r.persistence.qr.qo(n,e.targetId,t)}).next(function(){return ua.forEach(e.Xi,function(t){return r.persistence.qr.Ko(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!va(e=t.sent()))throw e;return Sr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)u=i[n],o=u.targetId,u.fromCache||(s=r.La.get(o),u=s.nt,u=s.rt(u),r.La=r.La.ot(o,u));return[2]}})})}(n.Bc,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function ml(i,o){return y(this,void 0,void 0,function(){var n,r;return v(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Sr("SyncEngine","User change. New user:",o.ti()),[4,Fh(n.Bc,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Lh.forEach(function(t){t.forEach(function(t){t.reject(new _r(Tr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Lh.clear(),n.Sh.Gu(o,r.ja,r.Ga),[4,gl(n,r.Wa)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function wl(u,a,c,h){return y(this,void 0,void 0,function(){var o,s;return v(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Bc,n=a,i=(r=e).Oi,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.zr(e,n).next(function(t){return t?r.Ka.qi(e,t):ua.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,_f(o.ph)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(ll(o,a,h||null),fl(o,a),o.Bc.Oi.no(a)):Pr(),t.label=4;case 4:return[4,gl(o,s)];case 5:return t.sent(),[3,7];case 6:Sr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function bl(h,f){return y(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return v(this,function(t){switch(t.label){case 0:return Tl(r=h),_l(r),!0!==f||!0===r.qh?[3,3]:(e=r.Sh.xu(),[4,Il(r,e.L())]);case 1:return i=t.sent(),r.qh=!0,[4,Df(r.ph,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],pf(r.ph,u);return[3,7];case 3:return!1!==f||!1===r.qh?[3,7]:(a=[],c=Promise.resolve(),r.xh.forEach(function(t,e){r.Sh.Ku(e)?a.push(e):c=c.then(function(){return pl(r,e),Kh(r.Bc,e,!0)}),df(r.ph,e)}),[4,c]);case 4:return t.sent(),[4,Il(r,a)];case 5:return t.sent(),(n=r).kh.forEach(function(t,e){df(n.ph,e)}),n.Mh.lu(),n.kh=new Map,n.Oh=new xi(ai.D),r.qh=!1,[4,Df(r.ph,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Il(p,d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l;return v(this,function(t){switch(t.label){case 0:e=p,n=[],r=[],i=0,o=d,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.xh.get(s))&&0!==a.length?[4,zh(e.Bc,wu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],f=e.Nh.get(f),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Hh((e=r).Bc,i.query,!0)];case 1:return n=t.sent(),n=i.view.gh(n),[2,(e.Uh&&yl(e,i.targetId,n.Rh),n)]}})})}(e,f)]):[3,6];case 4:(f=t.sent()).snapshot&&r.push(f.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Wh(e.Bc,s)];case 8:return l=t.sent(),[4,zh(e.Bc,l)];case 9:return u=t.sent(),[4,ol(e,El(l),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Ch.Tc(r),n)]}})})}function El(t){return fu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Tl(t){return t.ph.Uc.Xc=ul.bind(null,t),t.ph.Uc.qe=function(t,e){var n=t;if((t=n.kh.get(e))&&t.Vh)return Ki().add(t.key);var r=Ki();if(!(e=n.xh.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.Nh.get(s),r=r.kt(s.view.dh);return r}.bind(null,t),t.ph.Uc.Jc=function(o,s,u){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:return(e=o).Sh.Wu(s,"rejected",u),i=e.kh.get(s),(n=i&&i.key)?(r=(r=new xi(ai.D)).ot(n,new ou(n,ii.min())),i=Ki().add(n),i=new Xi(ii.min(),new Map,new Ui(Vr),r,i),[4,ul(e,i)]):[3,2];case 1:return t.sent(),e.Oh=e.Oh.remove(n),e.kh.delete(s),vl(e),[3,4];case 2:return[4,Kh(e.Bc,s,!1).then(function(){return pl(e,s,u)}).catch(Xh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.Ch.Tc=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,u=n.Bs.get(u);if(u){for(var a=0,c=u.listeners;a<c.length;a++)c[a].Qs(s)&&(r=!0);u.Ls=s}}r&&Ca(n)}.bind(null,t.bh),t.Ch.Qh=function(t,e,n){var r=t;if(t=r.Bs.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.Bs.delete(e)}.bind(null,t.bh),t}function _l(t){return t.ph.Uc.Zc=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,jh(e.Bc,o)];case 2:return r=t.sent(),ll(e,n,null),fl(e,n),e.Sh.$u(n,"acknowledged"),[4,gl(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Xh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.ph.Uc.tu=cl.bind(null,t),t}var Al,Nl,Dl,Sl=(Zl.prototype.Qa=function(t){this.Wh=t},Zl.prototype.Qi=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.on.length||1===r.on.length&&r.on[0].field.W())||i.isEqual(ii.min())?this.jh(e,r):this.Wh.qi(e,o).next(function(t){var n=s.Gh(r,t);return(pu(r)||du(r))&&s.Ih(r.an,n,o,i)?s.jh(e,r):(Dr()<=l.DEBUG&&Sr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Au(r)),s.Wh.Qi(e,r,i).next(function(e){return n.forEach(function(t){e=e.ot(t.key,t)}),e}))})},Zl.prototype.Gh=function(n,t){var r=new Ui(Du(n));return t.forEach(function(t,e){e instanceof iu&&Nu(n,e)&&(r=r.add(e))}),r},Zl.prototype.Ih=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.u(r))},Zl.prototype.jh=function(t,e){return Dr()<=l.DEBUG&&Sr("IndexFreeQueryEngine","Using full collection scan to execute query:",Au(e)),this.Wh.Qi(t,e,ii.min())},Zl),Ol=($l.prototype.Qr=function(t){return ua.resolve(0===this.Oi.length)},$l.prototype.Wr=function(t,e,n,r){var i=this.zh;this.zh++,0<this.Oi.length&&this.Oi[this.Oi.length-1];n=new Ka(i,e,n,r);this.Oi.push(n);for(var o=0,s=r;o<s.length;o++){var u=s[o];this.Hh=this.Hh.add(new kf(u.key,i)),this.ki.jr(t,u.key.path.F())}return ua.resolve(n)},$l.prototype.Gr=function(t,e){return ua.resolve(this.Yh(e))},$l.prototype.Hr=function(t,e){e+=1,e=this.Jh(e),e=e<0?0:e;return ua.resolve(this.Oi.length>e?this.Oi[e]:null)},$l.prototype.Yr=function(){return ua.resolve(0===this.Oi.length?-1:this.zh-1)},$l.prototype.Jr=function(t){return ua.resolve(this.Oi.slice())},$l.prototype.$i=function(t,e){var n=this,r=new kf(e,0),e=new kf(e,Number.POSITIVE_INFINITY),i=[];return this.Hh.xt([r,e],function(t){t=n.Yh(t.fu);i.push(t)}),ua.resolve(i)},$l.prototype.Ki=function(t,e){var n=this,r=new Ui(Vr);return e.forEach(function(t){var e=new kf(t,0),t=new kf(t,Number.POSITIVE_INFINITY);n.Hh.xt([e,t],function(t){r=r.add(t.fu)})}),ua.resolve(this.Xh(r))},$l.prototype.Hi=function(t,e){var n=e.path,r=n.length+1,e=n;ai.X(e)||(e=e.child(""));var e=new kf(new ai(e),0),i=new Ui(Vr);return this.Hh.Ft(function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(i=i.add(t.fu)),!0)},e),ua.resolve(this.Xh(i))},$l.prototype.Xh=function(t){var e=this,n=[];return t.forEach(function(t){t=e.Yh(t);null!==t&&n.push(t)}),n},$l.prototype.Zr=function(n,r){var i=this;Lr(0===this.Zh(r.batchId,"removed")),this.Oi.shift();var o=this.Hh;return ua.forEach(r.mutations,function(t){var e=new kf(t.key,r.batchId);return o=o.delete(e),i.qr.so(n,t.key)}).next(function(){i.Hh=o})},$l.prototype.no=function(t){},$l.prototype.ro=function(t,e){var n=new kf(e,0),n=this.Hh.Ot(n);return ua.resolve(e.isEqual(n&&n.key))},$l.prototype.io=function(t){return this.Oi.length,ua.resolve()},$l.prototype.Zh=function(t,e){return this.Jh(t)},$l.prototype.Jh=function(t){return 0===this.Oi.length?0:t-this.Oi[0].batchId},$l.prototype.Yh=function(t){t=this.Jh(t);return t<0||t>=this.Oi.length?null:this.Oi[t]},$l),xl=(Jl.prototype.yi=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.tl(e);return this.docs=this.docs.ot(r,{ho:e,size:i,readTime:n}),this.size+=i-o,this.ki.jr(t,r.path.F())},Jl.prototype.pi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Jl.prototype.bi=function(t,e){e=this.docs.get(e);return ua.resolve(e?e.ho:null)},Jl.prototype.getEntries=function(t,e){var n=this,r=qi;return e.forEach(function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ho:null)}),ua.resolve(r)},Jl.prototype.Qi=function(t,e,n){for(var r=Bi,i=new ai(e.path.child("")),o=this.docs.ft(i);o.At();){var s=o.It(),u=s.key,a=s.value,s=a.ho,a=a.readTime;if(!e.path.M(u.path))break;a.u(n)<=0||s instanceof iu&&Nu(e,s)&&(r=r.ot(s.key,s))}return ua.resolve(r)},Jl.prototype.el=function(t,e){return ua.forEach(this.docs,function(t){return e(t)})},Jl.prototype.wo=function(t){return new kl(this)},Jl.prototype.To=function(t){return ua.resolve(this.size)},Jl),kl=(n(Xl,Dl=h),Xl.prototype.Di=function(n){var r=this,i=[];return this.Ri.forEach(function(t,e){e?i.push(r.Io.yi(n,e,r.readTime)):r.Io.pi(t)}),ua.On(i)},Xl.prototype.vi=function(t,e){return this.Io.bi(t,e)},Xl.prototype.Si=function(t,e){return this.Io.getEntries(t,e)},Xl),Pl=(Yl.prototype.Ce=function(t,n){return this.nl.forEach(function(t,e){return n(e)}),ua.resolve()},Yl.prototype.So=function(t){return ua.resolve(this.lastRemoteSnapshotVersion)},Yl.prototype.Do=function(t){return ua.resolve(this.sl)},Yl.prototype.po=function(t){return this.highestTargetId=this.rl.next(),ua.resolve(this.highestTargetId)},Yl.prototype.Co=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.sl&&(this.sl=e),ua.resolve()},Yl.prototype.xo=function(t){this.nl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.rl=new wh(e),this.highestTargetId=e),t.sequenceNumber>this.sl&&(this.sl=t.sequenceNumber)},Yl.prototype.No=function(t,e){return this.xo(e),this.targetCount+=1,ua.resolve()},Yl.prototype.Oo=function(t,e){return this.xo(e),ua.resolve()},Yl.prototype.ko=function(t,e){return this.nl.delete(e.target),this.il.hu(e.targetId),--this.targetCount,ua.resolve()},Yl.prototype.Or=function(n,r,i){var o=this,s=0,u=[];return this.nl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.nl.delete(t),u.push(o.Mo(n,e.targetId)),s++)}),ua.On(u).next(function(){return s})},Yl.prototype.$o=function(t){return ua.resolve(this.targetCount)},Yl.prototype.Lo=function(t,e){e=this.nl.get(e)||null;return ua.resolve(e)},Yl.prototype.Bo=function(t,e,n){return this.il.au(e,n),ua.resolve()},Yl.prototype.Uo=function(e,t,n){this.il.uu(t,n);var r=this.persistence.qr,i=[];return r&&t.forEach(function(t){i.push(r.so(e,t))}),ua.On(i)},Yl.prototype.Mo=function(t,e){return this.il.hu(e),ua.resolve()},Yl.prototype.Qo=function(t,e){e=this.il._u(e);return ua.resolve(e)},Yl.prototype.ro=function(t,e){return ua.resolve(this.il.ro(e))},Yl),Ll=(Ql.prototype.start=function(){return Promise.resolve()},Ql.prototype.ga=function(){return this.Ho=!1,Promise.resolve()},Object.defineProperty(Ql.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),Ql.prototype.ha=function(){},Ql.prototype.la=function(){},Ql.prototype.Na=function(){return this.ki},Ql.prototype.Sa=function(t){var e=this.ol[t.ti()];return e||(e=new Ol(this.ki,this.qr),this.ol[t.ti()]=e),e},Ql.prototype.Da=function(){return this.sa},Ql.prototype.Ca=function(){return this.Fi},Ql.prototype.runTransaction=function(t,e,n){var r=this;Sr("MemoryPersistence","Starting transaction:",t);var i=new Rl(this.zo.next());return this.qr.cl(),n(i).next(function(t){return r.qr.ul(i).next(function(){return t})}).xn().then(function(t){return i.xi(),t})},Ql.prototype.hl=function(e,n){return ua.kn(Object.values(this.ol).map(function(t){return function(){return t.ro(e,n)}}))},Ql),Rl=(n(Wl,Nl=Ee),Wl),Cl=(Hl.fl=function(t){return new Hl(t)},Object.defineProperty(Hl.prototype,"dl",{get:function(){if(this._l)return this._l;throw Pr()},enumerable:!1,configurable:!0}),Hl.prototype.qo=function(t,e,n){return this.ll.qo(n,e),this.dl.delete(n.toString()),ua.resolve()},Hl.prototype.Ko=function(t,e,n){return this.ll.Ko(n,e),this.dl.add(n.toString()),ua.resolve()},Hl.prototype.so=function(t,e){return this.dl.add(e.toString()),ua.resolve()},Hl.prototype.removeTarget=function(t,e){var n=this;this.ll.hu(e.targetId).forEach(function(t){return n.dl.add(t.toString())});var r=this.persistence.Da();return r.Qo(t,e.targetId).next(function(t){t.forEach(function(t){return n.dl.add(t.toString())})}).next(function(){return r.ko(t,e)})},Hl.prototype.cl=function(){this._l=new Set},Hl.prototype.ul=function(n){var r=this,i=this.persistence.Ca().wo();return ua.forEach(this.dl,function(t){var e=ai.H(t);return r.wl(n,e).next(function(t){t||i.pi(e)})}).next(function(){return r._l=null,i.apply(n)})},Hl.prototype.Ma=function(t,e){var n=this;return this.wl(t,e).next(function(t){t?n.dl.delete(e.toString()):n.dl.add(e.toString())})},Hl.prototype.al=function(t){return 0},Hl.prototype.wl=function(t,e){var n=this;return ua.kn([function(){return ua.resolve(n.ll.ro(e))},function(){return n.persistence.Da().ro(t,e)},function(){return n.persistence.hl(t,e)}])},Hl),Vl=(Kl.prototype.wc=function(t){this.Il=t},Kl.prototype.hc=function(t){this.ml=t},Kl.prototype.onMessage=function(t){this.Al=t},Kl.prototype.close=function(){this.Tl()},Kl.prototype.send=function(t){this.El(t)},Kl.prototype.Rl=function(){this.Il()},Kl.prototype.Pl=function(t){this.ml(t)},Kl.prototype.gl=function(t){this.Al(t)},Kl),Ul={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ml=(zl.prototype.Sc=function(e,t,n,r){var i=this.bl(e,t);Sr("RestConnection","Sending: ",i,n);t={};return this.vl(t,r),this.Sl(e,i,t,n).then(function(t){return Sr("RestConnection","Received: ",t),t},function(t){throw xr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},zl.prototype.Dc=function(t,e,n,r){return this.Sc(t,e,n,r)},zl.prototype.vl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.0.1",t["Content-Type"]="text/plain",e)for(var n in e.si)e.si.hasOwnProperty(n)&&(t[n]=e.si[n])},zl.prototype.bl=function(t,e){t=Ul[t];return this.Vl+"/v1/"+e+":"+t},n(Gl,Al=zl),Gl.prototype.Sl=function(o,e,s,u){return new Promise(function(n,r){var i=new wr;i.listenOnce(gr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case vr.NO_ERROR:var t=i.getResponseJson();Sr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case vr.TIMEOUT:Sr("Connection",'RPC "'+o+'" timed out'),r(new _r(Tr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var e=i.getStatus();Sr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace("_","-"),e=0<=Object.values(Tr).indexOf(e)?e:Tr.UNKNOWN,r(new _r(e,t.message))):r(new _r(Tr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new _r(Tr.UNAVAILABLE,"Connection failed."));break;default:Pr()}}finally{Sr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(u);i.send(e,"POST",t,s,15)})},Gl.prototype.Ec=function(t,e){var n,r=[this.Vl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new fr,t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this._.projectId+"/databases/"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.vl(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||(0<=(n=p()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Sr("Connection","Creating WebChannel: "+r,t);var o=i.createWebChannel(r,t),s=!1,u=!1,a=new Vl({El:function(t){u?Sr("Connection","Not sending because WebChannel is closed:",t):(s||(Sr("Connection","Opening WebChannel transport."),o.open(),s=!0),Sr("Connection","WebChannel sending:",t),o.send(t))},Tl:function(){return o.close()}}),t=function(t,e){o.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(mr.EventType.OPEN,function(){u||Sr("Connection","WebChannel transport opened.")}),t(mr.EventType.CLOSE,function(){u||(u=!0,Sr("Connection","WebChannel transport closed"),a.Pl())}),t(mr.EventType.ERROR,function(t){u||(u=!0,xr("Connection","WebChannel transport errored:",t),a.Pl(new _r(Tr.UNAVAILABLE,"The operation could not be completed")))}),t(mr.EventType.MESSAGE,function(t){var e,n,r,i;u||(Lr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Sr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ai[r];if(void 0!==t)return Oi(t)}(),i=n.message,void 0===t&&(t=Tr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,a.Pl(new _r(t,i)),o.close()):(Sr("Connection","WebChannel received:",e),a.gl(e)))}),setTimeout(function(){a.Rl()},0),a},Gl),ql=(Bl.prototype.zc=function(t){this.Fl.push(t)},Bl.prototype.ga=function(){window.removeEventListener("online",this.Dl),window.removeEventListener("offline",this.Nl)},Bl.prototype.Ol=function(){window.addEventListener("online",this.Dl),window.addEventListener("offline",this.Nl)},Bl.prototype.Cl=function(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(0)},Bl.prototype.xl=function(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(1)},Bl.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Bl),Fl=(jl.prototype.zc=function(t){},jl.prototype.ga=function(){},jl);function jl(){}function Bl(){var t=this;this.Dl=function(){return t.Cl()},this.Nl=function(){return t.xl()},this.Fl=[],this.Ol()}function Gl(t){var e=this;return(e=Al.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.T=t.T,e}function zl(t){this.yl=t,this._=t._;var e=t.ssl?"https":"http";this.Vl=e+"://"+t.host,this.pl="projects/"+this._.projectId+"/databases/"+this._.database+"/documents"}function Kl(t){this.El=t.El,this.Tl=t.Tl}function Hl(t){this.persistence=t,this.ll=new xf,this._l=null}function Wl(t){var e=this;return(e=Nl.call(this)||this).Wo=t,e}function Ql(t){var e=this;this.ol={},this.zo=new Xa(0),this.Ho=!1,this.Ho=!0,this.qr=t(this),this.sa=new Pl(this),this.ki=new Wc,this.Fi=(t=this.ki,new xl(t,function(t){return e.qr.al(t)}))}function Yl(t){this.persistence=t,this.nl=new ni(Ii,Ei),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.sl=0,this.il=new xf,this.targetCount=0,this.rl=wh.yo()}function Xl(t){var e=this;return(e=Dl.call(this)||this).Io=t,e}function Jl(t,e){this.ki=t,this.tl=e,this.docs=new xi(ai.D),this.size=0}function $l(t,e){this.ki=t,this.qr=e,this.Oi=[],this.zh=1,this.Hh=new Ui(kf.iu)}function Zl(){}function tp(t){return new Lo(t,!0)}var ep,np,rp=(lp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Sh=this.kl(e),this.persistence=this.Ml(e),[4,this.persistence.start()];case 1:return t.sent(),this.$l=this.Ll(e),this.Bc=this.Bl(e),[2]}})})},lp.prototype.Ll=function(t){return null},lp.prototype.Bl=function(t){return e=this.persistence,n=new Sl,t=t.ql,new Mh(e,n,t);var e,n},lp.prototype.Ml=function(t){return new Ll(Cl.fl)},lp.prototype.kl=function(t){return new Gf},lp.prototype.terminate=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.$l&&this.$l.stop(),[4,this.Sh.ga()];case 1:return t.sent(),[4,this.persistence.ga()];case 2:return t.sent(),[2]}})})},lp),ip=(n(fp,np=rp),fp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,np.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,Yh(this.Bc)];case 2:return t.sent(),[4,this.Ul.initialize(this,e)];case 3:return t.sent(),[4,_l(this.Ul.mu)];case 4:return t.sent(),[4,_f(this.Ul.ph)];case 5:return t.sent(),[2]}})})},fp.prototype.Ll=function(t){var e=this.persistence.qr.gr;return new dc(e,t.cs)},fp.prototype.Ml=function(t){var e=Uh(t.yl._,t.yl.persistenceKey),n=void 0!==this.cacheSizeBytes?fc.Ir(this.cacheSizeBytes):fc.Rr,r=tp(t.yl._);return new Oh(this.synchronizeTabs,e,t.clientId,n,t.cs,_a(),Aa(),r,this.Sh,!!this.forceOwnership)},fp.prototype.kl=function(t){return new Gf},fp),op=(n(hp,ep=ip),hp.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,ep.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Ul.mu,this.Sh instanceof Bf?(this.Sh.mu={sh:wl.bind(null,e),ih:function(i,o,s,u){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return(e=i).qh?(Sr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.xh.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Qh(e.Bc)];case 3:return n=t.sent(),r=Xi.Xt(o,"current"===s),[4,gl(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,Kh(e.Bc,o,!0)];case 6:return t.sent(),pl(e,o,u),[3,8];case 7:Pr(),t.label=8;case 8:return[2]}})})}.bind(null,e),rh:function(c,h,f){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a;return v(this,function(t){switch(t.label){case 0:if(!(n=Tl(c)).qh)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.xh.has(r)?(Sr("SyncEngine","Adding an already active target "+r),[3,5]):[4,Wh(n.Bc,r)]):[3,6];case 2:return i=t.sent(),[4,zh(n.Bc,i)];case 3:return o=t.sent(),[4,ol(n,El(i),o.targetId,!1)];case 4:t.sent(),pf(n.ph,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return n.xh.has(e)?[4,Kh(n.Bc,e,!1).then(function(){df(n.ph,e),pl(n,e)}).catch(Xh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=0,a=f,t.label=7;case 7:return u<a.length?(a=a[u],[5,s(a)]):[3,10];case 8:t.sent(),t.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}.bind(null,e),va:function(t){return t.Bc.persistence.va()}.bind(null,e)},[4,this.Sh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ua(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,bl(this.Ul.mu,e)];case 1:return t.sent(),this.$l&&(e&&!this.$l.br?this.$l.start(this.Bc):e||this.$l.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},hp.prototype.kl=function(t){var e=_a();if(!Bf.Ln(e))throw new _r(Tr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Uh(t.yl._,t.yl.persistenceKey);return new Bf(e,t.cs,n,t.clientId,t.ql)},hp),sp=(cp.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Bc?[3,2]:(this.Bc=n.Bc,this.Sh=n.Sh,this.qc=this.Kl(r),this.ph=this.Ql(r),this.bh=this.Wl(r),this.mu=this.jl(r,!n.synchronizeTabs),this.Sh.Cc=function(t){return al(e.mu,t,1)},this.ph.Uc.Gl=ml.bind(null,this.mu),[4,Df(this.ph,this.mu.Uh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},cp.prototype.Wl=function(t){return new ka},cp.prototype.Kl=function(t){var e=tp(t.yl._),n=(n=t.yl,new Ml(n));return t=t.credentials,new rf(t,n,e)},cp.prototype.Ql=function(t){var e=this,n=this.Bc,r=this.qc,i=t.cs,o=function(t){return al(e.mu,t,0)},t=new(ql.Ln()?ql:Fl);return new Jh(n,r,i,o,t)},cp.prototype.jl=function(t,e){return function(t,e,n,r,i,o,s){o=new Yf(t,e,n,r,i,o);return s&&(o.qh=!0),o}(this.Bc,this.ph,this.bh,this.Sh,t.ql,t.Dh,e)},cp.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=n,Sr("RemoteStore","RemoteStore shutting down."),e.Wc.add(5),[4,lf(e)];case 1:return t.sent(),e.Gc.ga(),e.Hc.set("Unknown"),[2]}})})}(this.ph)},cp),up=(ap.prototype.next=function(t){this.observer.next&&this.zl(this.observer.next,t)},ap.prototype.error=function(t){this.observer.error?this.zl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},ap.prototype.Hl=function(){this.muted=!0},ap.prototype.zl=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},ap);function ap(t){this.observer=t,this.muted=!1}function cp(){}function hp(t,e){var n=this;return(n=ep.call(this,t,e,!1)||this).Ul=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function fp(t,e,n){var r=this;return(r=np.call(this)||this).Ul=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function lp(){this.synchronizeTabs=!1}function pp(t,e,n){if(!n)throw new _r(Tr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function dp(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new _r(Tr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function yp(t,e,n,r){if(!0===e&&!0===r)throw new _r(Tr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function vp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Pr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function gp(t,e){if(e<=0)throw new _r(Tr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var mp,wp,bp=function(t){for(var e=0;e<t.length;++e)if(0===t[e].length)throw new _r(Tr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Yl=new ui(t)},Ip=(n(Np,wp=bp),Np.documentId=function(){return new Np(ui.j().B())},Np.prototype.isEqual=function(t){return t instanceof Np&&this.Yl.isEqual(t.Yl)},Np),Ep=new RegExp("[~\\*/\\[\\]]"),Tp=function(t){this.Jl=t},_p=(n(Ap,mp=Tp),Ap.prototype.Xl=function(t){if(2!==t.Zl)throw 1===t.Zl?t.t_(this.Jl+"() can only appear at the top level of your update data"):t.t_(this.Jl+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},Ap.prototype.isEqual=function(t){return t instanceof Ap},Ap);function Ap(){return null!==mp&&mp.apply(this,arguments)||this}function Np(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wp.call(this,t)||this}function Dp(t,e,n){return new Xp({Zl:3,e_:e.settings.e_,methodName:t.Jl,n_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var Sp,Op,xp,kp,Pp=(n(Qp,kp=Tp),Qp.prototype.Xl=function(t){return new _s(t.path,new cs)},Qp.prototype.isEqual=function(t){return t instanceof Qp},Qp),Lp=(n(Wp,xp=Tp),Wp.prototype.Xl=function(t){var e=Dp(this,t,!0),n=this.s_.map(function(t){return id(t,e)}),n=new hs(n);return new _s(t.path,n)},Wp.prototype.isEqual=function(t){return this===t},Wp),Rp=(n(Hp,Op=Tp),Hp.prototype.Xl=function(t){var e=Dp(this,t,!0),n=this.s_.map(function(t){return id(t,e)}),n=new ys(n);return new _s(t.path,n)},Hp.prototype.isEqual=function(t){return this===t},Hp),Cp=(n(Kp,Sp=Tp),Kp.prototype.Xl=function(t){var e=new ws(t.serializer,Vo(t.serializer,this.i_));return new _s(t.path,e)},Kp.prototype.isEqual=function(t){return this===t},Kp),Vp=(Object.defineProperty(zp.prototype,"latitude",{get:function(){return this.r_},enumerable:!1,configurable:!0}),Object.defineProperty(zp.prototype,"longitude",{get:function(){return this.o_},enumerable:!1,configurable:!0}),zp.prototype.isEqual=function(t){return this.r_===t.r_&&this.o_===t.o_},zp.prototype.toJSON=function(){return{latitude:this.r_,longitude:this.o_}},zp.prototype.g=function(t){return Vr(this.r_,t.r_)||Vr(this.o_,t.o_)},zp),Up=function(t){this.a_=t},Mp=/^__.*__$/,qp=function(t,e,n){this.c_=t,this.u_=e,this.h_=n},Fp=(Gp.prototype.l_=function(t,e){var n=[];return null!==this.Qe?n.push(new Us(t,this.data,this.Qe,e)):n.push(new Vs(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bs(t,this.fieldTransforms)),n},Gp),jp=(Bp.prototype.l_=function(t,e){e=[new Us(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&e.push(new Bs(t,this.fieldTransforms)),e},Bp);function Bp(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function Gp(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function zp(t,e){if(!isFinite(t)||t<-90||90<t)throw new _r(Tr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new _r(Tr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.r_=t,this.o_=e}function Kp(t,e){var n=this;return(n=Sp.call(this,t)||this).i_=e,n}function Hp(t,e){var n=this;return(n=Op.call(this,t)||this).s_=e,n}function Wp(t,e){var n=this;return(n=xp.call(this,t)||this).s_=e,n}function Qp(){return null!==kp&&kp.apply(this,arguments)||this}function Yp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Pr()}}var Xp=(Object.defineProperty(Zp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Zp.prototype,"Zl",{get:function(){return this.settings.Zl},enumerable:!1,configurable:!0}),Zp.prototype.f_=function(t){return new Zp(Object.assign(Object.assign({},this.settings),t),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},Zp.prototype.d_=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.f_({path:e,n_:!1});return e.w_(t),e},Zp.prototype.E_=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.f_({path:t,n_:!1});return t.__(),t},Zp.prototype.T_=function(t){return this.f_({path:void 0,n_:!0})},Zp.prototype.t_=function(t){return hd(t,this.settings.methodName,this.settings.I_||!1,this.path,this.settings.e_)},Zp.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.M(t)})||void 0!==this.fieldTransforms.find(function(t){return e.M(t.field)})},Zp.prototype.__=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.w_(this.path.get(t))},Zp.prototype.w_=function(t){if(0===t.length)throw this.t_("Document fields must not be empty");if(Yp(this.Zl)&&Mp.test(t))throw this.t_('Document fields cannot begin and end with "__"')},Zp),Jp=($p.prototype.m_=function(t,e,n,r){return void 0===r&&(r=!1),new Xp({Zl:t,methodName:e,e_:n,path:ui.U(),n_:!1,I_:r},this._,this.serializer,this.ignoreUndefinedProperties)},$p);function $p(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||tp(t)}function Zp(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.__(),this.fieldTransforms=i||[],this.Qe=o||[]}function td(t,e,n,r,i,o){void 0===o&&(o={});var s=t.m_(o.merge||o.mergeFields?2:0,e,n,i);ud("Data must be an object, but it was:",s,r);var u,a,r=od(r,s);if(o.merge)u=new Ts(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,f=o.mergeFields;h<f.length;h++){var l=f[h],p=void 0;if(l instanceof bp)p=l.Yl;else{if("string"!=typeof l)throw Pr();p=cd(e,l,n)}if(!s.contains(p))throw new _r(Tr.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");fd(c,p)||c.push(p)}u=new Ts(c),a=s.fieldTransforms.filter(function(t){return u.Ye(t.field)})}else u=null,a=s.fieldTransforms;return new Fp(new Ys(r),u,a)}function ed(t,r,i,e){var o=t.m_(1,r,i);ud("Data must be an object, but it was:",o,e);var s=[],u=new Xs;$r(e,function(t,e){var n=cd(r,t,i),t=o.E_(n);e instanceof _p||e instanceof Up&&e.a_ instanceof _p?s.push(n):null!=(t=id(e,t))&&(s.push(n),u.set(n,t))});e=new Ts(s);return new jp(u.Xe(),e,o.fieldTransforms)}function nd(t,e,n,r,i,o){var s=t.m_(1,e,n),u=[ad(e,r,n)],a=[i];if(o.length%2!=0)throw new _r(Tr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(ad(e,o[c])),a.push(o[c+1]);for(var h,f,l,p=[],d=new Xs,y=u.length-1;0<=y;--y){fd(p,u[y])||(h=u[y],f=a[y],l=s.E_(h),f instanceof _p||f instanceof Up&&f.a_ instanceof _p?p.push(h):null!=(l=id(f,l))&&(p.push(h),d.set(h,l)))}i=new Ts(p);return new jp(d.Xe(),i,s.fieldTransforms)}function rd(t,e,n,r){return void 0===r&&(r=!1),id(n,t.m_(r?4:3,e))}function id(s,t){if(s instanceof Up&&(s=s.a_),sd(s))return ud("Unsupported field value:",t,s),od(s,t);if(s instanceof Tp)return function(t,e){if(!Yp(e.Zl))throw e.t_(t.Jl+"() can only be used with update() and set()");if(!e.path)throw e.t_(t.Jl+"() is not currently supported inside arrays");t=t.Xl(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.n_&&4!==t.Zl)throw t.t_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=id(i[r],t.T_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Vo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ri.fromDate(t);return{timestampValue:Uo(e.serializer,n)}}if(t instanceof ri){var r=new ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Uo(e.serializer,r)}}if(t instanceof Vp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof jr)return{bytesValue:Mo(e.serializer,t.l)};if(t instanceof qp){n=e._,r=t.c_;if(!r.isEqual(n))throw e.t_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Fo(t.c_||e._,t.u_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.t_("Unsupported field value: "+vp(t))}(s,t)}function od(t,n){var r={};return Zr(t)?n.path&&0<n.path.length&&n.Qe.push(n.path):$r(t,function(t,e){e=id(e,n.d_(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function sd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ri||t instanceof Vp||t instanceof jr||t instanceof qp||t instanceof Tp)}function ud(t,e,n){if(!sd(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=vp(n);throw"an object"===n?e.t_(t+" a custom object"):e.t_(t+" "+n)}var r}function ad(t,e,n){if(e instanceof bp)return e.Yl;if("string"==typeof e)return cd(t,e);throw hd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function cd(t,e,n){try{return function(e){if(0<=e.search(Ep))throw new _r(Tr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Ip.bind.apply(Ip,i([void 0],e.split("."))))}catch(t){throw new _r(Tr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Yl}catch(e){throw hd(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function hd(t,e,n,r,i){var o=r&&!r.P(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new _r(Tr.INVALID_ARGUMENT,(e+=". ")+t+n)}function fd(t,e){return t.some(function(t){return t.isEqual(e)})}var ld=(gd.prototype.y_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),0<this.mutations.length)throw new _r(Tr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=Ho((n=s).serializer)+"/documents",r={documents:u.map(function(t){return Bo(n.serializer,t)})},[4,n.Dc("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.serializer,"found"in(t=t)?function(t,e){Lr(!!e.found),e.found.name,e.found.updateTime;var n=Go(t,e.found.name),t=qo(e.found.updateTime),e=new Ys({mapValue:{fields:e.found.fields}});return new iu(n,t,e,{})}(e,t):"missing"in t?function(t,e){Lr(!!e.missing),Lr(!!e.readTime);t=Go(t,e.missing),e=qo(e.readTime);return new ou(t,e)}(e,t):Pr());i.set(t.key.toString(),t)}),o=[],[2,(u.forEach(function(t){t=i.get(t.toString());Lr(!!t),o.push(t)}),o)]}})})}(this.qc,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof ou||t instanceof iu?n.p_(t):Pr()}),e)]}})})},gd.prototype.set=function(t,e){this.write(e.l_(t,this.Ge(t))),this.g_.add(t.toString())},gd.prototype.update=function(t,e){try{this.write(e.l_(t,this.b_(t)))}catch(t){this.P_=t}this.g_.add(t.toString())},gd.prototype.delete=function(t){this.write([new Ws(t,this.Ge(t))]),this.g_.add(t.toString())},gd.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),this.P_)throw this.P_;return e=this.A_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=ai.H(e);n.mutations.push(new Qs(e,n.Ge(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=Ho((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Yo(e.serializer,t)})},[4,e.Sc("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.qc,this.mutations)];case 1:return t.sent(),this.R_=!0,[2]}})})},gd.prototype.p_=function(t){var e;if(t instanceof iu)e=t.version;else{if(!(t instanceof ou))throw Pr();e=ii.min()}var n=this.A_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new _r(Tr.ABORTED,"Document version changed between two reads.")}else this.A_.set(t.key.toString(),e)},gd.prototype.Ge=function(t){var e=this.A_.get(t.toString());return!this.g_.has(t.toString())&&e?Ds.updateTime(e):Ds.ze()},gd.prototype.b_=function(t){var e=this.A_.get(t.toString());if(this.g_.has(t.toString())||!e)return Ds.exists(!0);if(e.isEqual(ii.min()))throw new _r(Tr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ds.updateTime(e)},gd.prototype.write=function(t){this.V_(),this.mutations=this.mutations.concat(t)},gd.prototype.V_=function(){},gd),pd=(vd.prototype.run=function(){this.S_()},vd.prototype.S_=function(){var t=this;this.ys.Pn(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new ld(this.qc),(n=this.D_(e))&&n.then(function(t){r.cs.ws(function(){return e.commit().then(function(){r.ls.resolve(t)}).catch(function(t){r.C_(t)})})}).catch(function(t){r.C_(t)}),[2]})})})},vd.prototype.D_=function(t){try{var e=this.updateFunction(t);return!vi(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},vd.prototype.C_=function(t){var e=this;0<this.v_&&this.N_(t)?(--this.v_,this.cs.ws(function(){return e.S_(),Promise.resolve()})):this.ls.reject(t)},vd.prototype.N_=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Si(t)},vd),dd=(yd.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ui.promise];case 1:return[2,(t.sent(),{cs:this.cs,yl:this.yl,clientId:this.clientId,credentials:this.credentials,ql:this.user,Dh:100})]}})})},yd.prototype.F_=function(t){var e=this;this.x_=t,this.ui.promise.then(function(){return e.x_(e.user)})},yd.prototype.O_=function(){if(this.cs.ps)throw new _r(Tr.FAILED_PRECONDITION,"The client has already been terminated.")},yd.prototype.terminate=function(){var t=this;this.cs.Ds();var n=new oa;return this.cs.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.k_?[4,this.k_.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.M_?[4,this.M_.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.ai(),n.resolve(),[3,6];case 5:return e=t.sent(),e=xa(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},yd);function yd(t,e,n){var r=this;this.credentials=t,this.cs=e,this.yl=n,this.user=Ua.UNAUTHENTICATED,this.clientId=Rr.t(),this.x_=function(){},this.ui=new oa,this.credentials.oi(function(t){Sr("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.x_(t)),r.ui.resolve()})}function vd(t,e,n,r){this.cs=t,this.qc=e,this.updateFunction=n,this.ls=r,this.v_=5,this.ys=new sa(this.cs,"transaction_retry")}function gd(t){this.qc=t,this.A_=new Map,this.mutations=[],this.R_=!1,this.P_=null,this.g_=new Set}function md(r,i){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),Sr("FirestoreClient","Initializing OfflineComponentProvider"),[4,r.getConfiguration()];case 1:return e=t.sent(),[4,i.initialize(e)];case 2:return t.sent(),r.F_(function(e){return r.cs.Cs(function(){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Fh(i.Bc,e)];case 1:return t.sent(),[2]}})})})}),i.persistence.ha(function(){return r.terminate()}),r.M_=i,[2]}})})}function wd(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return r.cs.Fs(),[4,bd(r)];case 1:return e=t.sent(),Sr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.F_(function(t){return r.cs.Cs(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return(e=r).cs.Fs(),Sr("RemoteStore","RemoteStore received new credentials"),n=wf(e),e.Wc.add(3),[4,lf(e)];case 1:return t.sent(),n&&e.Hc.set("Unknown"),[4,e.Uc.Gl(i)];case 2:return t.sent(),e.Wc.delete(3),[4,ff(e)];case 3:return t.sent(),[2]}})})}(i.ph,t)})}),r.k_=i,[2]}})})}function bd(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.M_?[3,2]:(Sr("FirestoreClient","Using default OfflineComponentProvider"),[4,md(e,new rp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.M_]}})})}function Id(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.k_?[3,2]:(Sr("FirestoreClient","Using default OnlineComponentProvider"),[4,wd(e,new sp)]);case 1:t.sent(),t.label=2;case 2:return[2,e.k_]}})})}function Ed(t){return bd(t).then(function(t){return t.persistence})}function Td(t){return bd(t).then(function(t){return t.Bc})}function _d(t){return Id(t).then(function(t){return t.ph})}function Ad(t){return Id(t).then(function(t){return t.mu})}function Nd(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Id(r)];case 1:return e=t.sent(),[2,((n=e.bh).Us=function(s,u){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return e=Tl(s),(o=e.Nh.get(u))?(n=o.targetId,e.Sh.Bu(n),r=o.view.yh(),[3,4]):[3,1];case 1:return[4,zh(e.Bc,wu(u))];case 2:return i=t.sent(),o=e.Sh.Bu(i.targetId),n=i.targetId,[4,ol(e,u,n,"current"===o)];case 3:r=t.sent(),e.Uh&&pf(e.ph,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.mu),n.Ws=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n=(e=i).Nh.get(o),1<(r=e.xh.get(n.targetId)).length?[2,(e.xh.set(n.targetId,r.filter(function(t){return!Tu(t,o)})),void e.Nh.delete(o))]:e.Uh?(e.Sh.Uu(n.targetId),e.Sh.Ou(n.targetId)?[3,2]:[4,Kh(e.Bc,n.targetId,!1).then(function(){e.Sh.Qu(n.targetId),df(e.ph,n.targetId),pl(e,n.targetId)}).catch(Xh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return pl(e,n.targetId),[4,Kh(e.Bc,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.mu),n)]}})})}function Dd(n,t,e,r){var i=this,o=new up(r),s=new Va(t,o,e);return n.cs.ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=La,[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),s])]}})})}),function(){o.Hl(),n.cs.ws(function(){return y(i,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=Ra,[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),s])]}})})})}}function Sd(n,r){var t=this,i=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=sl,[4,Ad(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}function Od(n,t){var e=this,r=new up(t);return n.cs.ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.add(e),e.next()},[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Hl(),n.cs.ws(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(t,e){t.qs.delete(e)},[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}function xd(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var kd=(Rd.prototype.U_=function(t){switch(vo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return To(t.integerValue||t.doubleValue);case 3:return this.K_(t.timestampValue);case 4:return this.Q_(t);case 5:return t.stringValue;case 6:return this.q_(_o(t.bytesValue));case 7:return this.W_(t.referenceValue);case 8:return this.j_(t.geoPointValue);case 9:return this.G_(t.arrayValue);case 10:return this.z_(t.mapValue);default:throw Pr()}},Rd.prototype.z_=function(t){var n=this,r={};return $r(t.fields||{},function(t,e){r[t]=n.U_(e)}),r},Rd.prototype.j_=function(t){return new Vp(To(t.latitude),To(t.longitude))},Rd.prototype.G_=function(t){var e=this;return(t.values||[]).map(function(t){return e.U_(t)})},Rd.prototype.Q_=function(t){switch(this.L_){case"previous":var e=function t(e){e=e.mapValue.fields.__previous_value__;return lo(e)?t(e):e}(t);return null==e?null:this.U_(e);case"estimate":return this.K_(po(t));default:return null}},Rd.prototype.K_=function(t){t=Eo(t);return new ri(t.seconds,t.nanos)},Rd.prototype.W_=function(t){var e=oi.q(t);Lr(os(e));t=new Qr(e.get(1),e.get(3)),e=new ai(e.N(5));return t.isEqual(this._)||Or("Document "+e+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+this._.projectId+"/"+this._.database+") instead."),this.B_(e)},Rd),Pd=(Ld.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Ld);function Ld(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new _r(Tr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new _r(Tr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,yp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Rd(t,e,n,r){this._=t,this.L_=e,this.B_=n,this.q_=r}function Cd(n,r,i){var t=this,o=new oa;return n.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,md(n,i)];case 1:return t.sent(),[4,wd(n,r)];case 2:return t.sent(),o.resolve(),[3,4];case 3:if(!("FirebaseError"===(t=e=t.sent()).name?t.code===Tr.FAILED_PRECONDITION||t.code===Tr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),o.reject(e),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Vd(t){if(t.Y_||t.J_)throw new _r(Tr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ud="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Md=(Gd.prototype.enableIndexedDbPersistence=function(t,e){throw new _r(Tr.FAILED_PRECONDITION,Ud)},Gd.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new _r(Tr.FAILED_PRECONDITION,Ud)},Gd.prototype.clearIndexedDbPersistence=function(t){throw new _r(Tr.FAILED_PRECONDITION,Ud)},Gd),qd=(Bd.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Vd(t);var n=zd(t),r=t.H_(),t=new sp;return Cd(n,t,new ip(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t,{forceOwnership:e})},Bd),Fd=(Object.defineProperty(jd.prototype,"Y_",{get:function(){return!!this.nf},enumerable:!1,configurable:!0}),Object.defineProperty(jd.prototype,"J_",{get:function(){return this.X_.ps},enumerable:!1,configurable:!0}),Object.defineProperty(jd.prototype,"af",{get:function(){return this.cf||(this.cf=new Jp(this.c_,this.rf.ignoreUndefinedProperties)),this.cf},enumerable:!1,configurable:!0}),jd.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.rf),t)).merge;t=new Pd(t);if(this.nf&&!this.rf.isEqual(t))throw new _r(Tr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");void 0!==(this.rf=t).credentials&&(this.if=function(t){if(!t)return new ja;switch(t.type){case"gapi":var e=t.client;return Lr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new za(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new _r(Tr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},jd.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.rf.host&&xr("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},jd.prototype.enableNetwork=function(){return zd(this),function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Ed(r)];case 1:return e=t.sent(),[4,_d(r)];case 2:return n=t.sent(),[2,(e.la(!0),(t=n).Wc.delete(0),ff(t))]}})})})}(this.nf)},jd.prototype.disableNetwork=function(){return zd(this),function(r){var t=this;return r.cs.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,Ed(r)];case 1:return e=t.sent(),[4,_d(r)];case 2:return n=t.sent(),[2,(e.la(!1),function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return(e=n).Wc.add(0),[4,lf(e)];case 1:return t.sent(),e.Hc.set("Offline"),[2]}})})}(n))]}})})})}(this.nf)},jd.prototype.enablePersistence=function(t){if(this.nf)throw new _r(Tr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1,n=!1;return t&&yp("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.tf.enableMultiTabIndexedDbPersistence(this):this.tf.enableIndexedDbPersistence(this,n)},jd.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return[2,this.tf.clearIndexedDbPersistence(this)]})})},jd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},jd.prototype.waitForPendingWrites=function(){return zd(this),function(n){var t=this,r=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=hl,[4,Ad(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(this.nf)},jd.prototype.onSnapshotsInSync=function(t){if(zd(this),xd(t))return Od(this.nf,t);t={next:t};return Od(this.nf,t)},jd.sf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new _r(Tr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,t=t.options.projectId;if(!t||"string"!=typeof t)throw new _r(Tr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Qr(t)},Object.defineProperty(jd.prototype,"app",{get:function(){if(!this.ef)throw new _r(Tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ef},enumerable:!1,configurable:!0}),jd.prototype.collection=function(t){return pp("Firestore.collection","path",t),zd(this),new py(oi.q(t),this,null)},jd.prototype.doc=function(t){return pp("Firestore.doc","path",t),zd(this),Xd.uf(oi.q(t),this,null)},jd.prototype.collectionGroup=function(t){if(pp("Firestore.collectionGroup","collectionId",t),0<=t.indexOf("/"))throw new _r(Tr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return zd(this),new fy((t=t,new uu(oi.U(),t)),this,null)},jd.prototype.runTransaction=function(e){var n=this;return function(n,r){var t=this,i=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,Id(n).then(function(t){return t.qc})];case 1:return e=t.sent(),new pd(n.cs,e,r,i).run(),[2]}})})}),i.promise}(zd(this),function(t){return e(new Qd(n,t))})},jd.prototype.batch=function(){return zd(this),new Yd(this)},jd.prototype.H_=function(){return this.rf},jd);function jd(t,e,n){var r=this;if(void 0===n&&(n=new Md),this.tf=n,this.ef=null,this.X_=new Da,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.nf||Kd(this),[4,this.nf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){n=t;this.ef=n,this.c_=jd.sf(n),this.Z_=n.name,this.if=new Ba(e)}else{t=t;if(!t.projectId)throw new _r(Tr.INVALID_ARGUMENT,"Must provide projectId");this.c_=new Qr(t.projectId,t.database),this.Z_="[DEFAULT]",this.if=new ja}this.rf=new Pd({})}function Bd(){this.enableMultiTabIndexedDbPersistence=function(t){Vd(t);var e=zd(t),n=t.H_(),t=new sp;return Cd(e,t,new op(t,n.cacheSizeBytes))}.bind(null),this.clearIndexedDbPersistence=function(n){var t=this;if(n.Y_&&!n.J_)throw new _r(Tr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new oa;return n.X_.bs(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return aa.Ln()?(e=n+"main",[4,aa.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Uh(n.c_,n.Z_))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}.bind(null)}function Gd(){}function zd(t){return t.nf||Kd(t),t.nf.O_(),t.nf}function Kd(t){var e,n,r=t.H_(),r=(e=t.c_,n=t.Z_,new Wr(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t.nf=new dd(t.if,t.X_,r)}var Hd,Wd,Qd=(oy.prototype.get=function(t){var e=this,n=gy(0,t,this.hf);return this.lf.y_([n.u_]).then(function(t){if(!t||1!==t.length)return Pr();t=t[0];if(t instanceof ou)return new $d(e.hf,n.u_,null,!1,!1,n.h_);if(t instanceof iu)return new $d(e.hf,n.u_,t,!1,!1,n.h_);throw Pr()})},oy.prototype.set=function(t,e,n){t=gy(0,t,this.hf);n=dp("Transaction.set",n);e=my(t.h_,e,n),n=td(this.hf.af,"Transaction.set",t.u_,e,null!==t.h_,n);return this.lf.set(t.u_,n),this},oy.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return e="string"==typeof e||e instanceof Ip?(r=gy(0,t,this.hf),nd(this.hf.af,"Transaction.update",r.u_,e,n,i)):(r=gy(0,t,this.hf),ed(this.hf.af,"Transaction.update",r.u_,e)),this.lf.update(r.u_,e),this},oy.prototype.delete=function(t){t=gy(0,t,this.hf);return this.lf.delete(t.u_),this},oy),Yd=(iy.prototype.set=function(t,e,n){this.df();t=gy(0,t,this.hf);n=dp("WriteBatch.set",n);e=my(t.h_,e,n),n=td(this.hf.af,"WriteBatch.set",t.u_,e,null!==t.h_,n);return this._f=this._f.concat(n.l_(t.u_,Ds.ze())),this},iy.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return this.df(),e="string"==typeof e||e instanceof Ip?(r=gy(0,t,this.hf),nd(this.hf.af,"WriteBatch.update",r.u_,e,n,i)):(r=gy(0,t,this.hf),ed(this.hf.af,"WriteBatch.update",r.u_,e)),this._f=this._f.concat(e.l_(r.u_,Ds.exists(!0))),this},iy.prototype.delete=function(t){this.df();t=gy(0,t,this.hf);return this._f=this._f.concat(new Ws(t.u_,Ds.ze())),this},iy.prototype.commit=function(){return this.df(),this.ff=!0,0<this._f.length?Sd(zd(this.hf),this._f):Promise.resolve()},iy.prototype.df=function(){if(this.ff)throw new _r(Tr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},iy),Xd=(n(ry,Wd=qp),ry.uf=function(t,e,n){if(t.length%2!=0)throw new _r(Tr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.B()+" has "+t.length);return new ry(new ai(t),e,n)},Object.defineProperty(ry.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(ry.prototype,"parent",{get:function(){return new py(this.u_.path.F(),this.firestore,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(ry.prototype,"path",{get:function(){return this.u_.path.B()},enumerable:!1,configurable:!0}),ry.prototype.collection=function(t){if(pp("DocumentReference.collection","path",t),!t)throw new _r(Tr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");t=oi.q(t);return new py(this.u_.path.child(t),this.firestore,null)},ry.prototype.isEqual=function(t){return t instanceof ry&&this.firestore===t.firestore&&this.u_.isEqual(t.u_)&&this.h_===t.h_},ry.prototype.set=function(t,e){e=dp("DocumentReference.set",e);t=my(this.h_,t,e),e=td(this.firestore.af,"DocumentReference.set",this.u_,t,null!==this.h_,e);return Sd(this.nf,e.l_(this.u_,Ds.ze()))},ry.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return t="string"==typeof t||t instanceof Ip?nd(this.firestore.af,"DocumentReference.update",this.u_,t,e,n):ed(this.firestore.af,"DocumentReference.update",this.u_,t),Sd(this.nf,t.l_(this.u_,Ds.exists(!0)))},ry.prototype.delete=function(){return Sd(this.nf,[new Ws(this.u_,Ds.ze())])},ry.prototype.onSnapshot=function(){for(var e=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||xd(n[i])||(r=n[i],i++);var o={includeMetadataChanges:r.includeMetadataChanges};xd(n[i])&&(s=n[i],n[i]=null===(r=s.next)||void 0===r?void 0:r.bind(s),n[i+1]=null===(r=s.error)||void 0===r?void 0:r.bind(s),n[i+2]=null===(r=s.complete)||void 0===r?void 0:r.bind(s));var s={next:function(t){n[i]&&n[i](e.wf(t))},error:n[i+1],complete:n[i+2]};return Dd(this.nf,lu(this.u_.path),o,s)},ry.prototype.get=function(t){var e=this;return t&&"cache"===t.source?function(n,r){var t=this,i=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=o,(n=i).persistence.runTransaction("read document","readonly",function(t){return n.Ka.Mi(t,e)}))];case 1:return(r=t.sent())instanceof iu?s.resolve(r):r instanceof ou?s.resolve(null):s.reject(new _r(Tr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),r=xa(r,"Failed to get document '"+o+" from cache"),s.reject(r),[3,3];case 3:return[2]}var e,n})})},[4,Td(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(this.nf,this.u_).then(function(t){return new $d(e.firestore,e.u_,t,!0,t instanceof iu&&t.Je,e.h_)}):function(n,r,i){var t=this;void 0===i&&(i={});var o=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new up({next:function(t){r.ws(function(){return Ra(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new _r(Tr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new _r(Tr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new Va(lu(i.path),t,{includeMetadataChanges:!0,Xs:!0});return La(n,u)},[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.cs,r,i,o])]}})})}),o.promise}(this.nf,this.u_,t).then(function(t){return e.wf(t)})},ry.prototype.withConverter=function(t){return new ry(this.u_,this.firestore,t)},ry.prototype.wf=function(t){var e=t.docs.get(this.u_);return new $d(this.firestore,this.u_,e,t.fromCache,t.hasPendingWrites,this.h_)},ry),Jd=(ny.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ny),$d=(ey.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.Ef){if(this.h_){var n=new Zd(this.hf,this.u_,this.Ef,this.Tf,this.If,null);return this.h_.fromFirestore(n,t)}return new kd(this.hf.c_,t.serverTimestamps||"none",function(t){return new Xd(t,e.hf,null)},function(t){return new Hr(t)}).U_(this.Ef.rn())}},ey.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.Ef){t=this.Ef.data().field(ad("DocumentSnapshot.get",t,this.u_));if(null!==t)return new kd(this.hf.c_,e.serverTimestamps||"none",function(t){return new Xd(t,n.hf,n.h_)},function(t){return new Hr(t)}).U_(t)}},Object.defineProperty(ey.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(ey.prototype,"ref",{get:function(){return new Xd(this.u_,this.hf,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(ey.prototype,"exists",{get:function(){return null!==this.Ef},enumerable:!1,configurable:!0}),Object.defineProperty(ey.prototype,"metadata",{get:function(){return new Jd(this.If,this.Tf)},enumerable:!1,configurable:!0}),ey.prototype.isEqual=function(t){return t instanceof ey&&this.hf===t.hf&&this.Tf===t.Tf&&this.u_.isEqual(t.u_)&&(null===this.Ef?null===t.Ef:this.Ef.isEqual(t.Ef))&&this.h_===t.h_},ey),Zd=(n(ty,Hd=$d),ty.prototype.data=function(t){return Hd.prototype.data.call(this,t)},ty);function ty(){return null!==Hd&&Hd.apply(this,arguments)||this}function ey(t,e,n,r,i,o){this.hf=t,this.u_=e,this.Ef=n,this.Tf=r,this.If=i,this.h_=o}function ny(t,e){this.hasPendingWrites=t,this.fromCache=e}function ry(t,e,n){var r=this;return(r=Wd.call(this,e.c_,t,n)||this).u_=t,r.firestore=e,r.h_=n,r.nf=zd(e),r}function iy(t){this.hf=t,this._f=[],this.ff=!1}function oy(t,e){this.hf=t,this.lf=e}function sy(t,e,n){if("string"==typeof n){if(""===n)throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!gu(e)&&-1!==n.indexOf("/"))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(oi.q(n));if(!ai.X(e))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Ao(t,new ai(e))}if(n instanceof qp)return Ao(t,n.u_);throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vp(n)+".")}function uy(t,e){if(!Array.isArray(t)||0===t.length)throw new _r(Tr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new _r(Tr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ay(t,e,n){if(!n.isEqual(e))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function cy(t){if(du(t)&&0===t.on.length)throw new _r(Tr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var hy,fy=(vy.prototype.where=function(t,e,n){t=ad("Query.where",t),e=function(t,e,n,r,i,o){if(r.W()){if("array-contains"===i||"array-contains-any"===i)throw new _r(Tr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){uy(o,i);for(var s=[],u=0,a=o;u<a.length;u++){var c=a[u];s.push(sy(n,t,c))}h={arrayValue:{values:s}}}else h=sy(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||uy(o,i),h=rd(e,"Query.where",o,"in"===i||"not-in"===i);var h=Ou.create(r,i,h);return function(t,e){if(e.hn()){var n=vu(t);if(null!==n&&!n.isEqual(e.field))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=yu(t);null!==n&&ay(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new _r(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new _r(Tr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(this.mf,this.firestore.af,this.firestore.c_,t,e,n);return new vy((n=this.mf,e=n.filters.concat([e]),new uu(n.path,n.collectionGroup,n.on.slice(),e,n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.h_)},vy.prototype.orderBy=function(t,e){if(void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new _r(Tr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var n,t=ad("Query.orderBy",t),t=function(t,e,n){if(null!==t.startAt)throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");e=new ra(e,n);return n=e,null!==yu(t)||null!==(t=vu(t))&&ay(0,t,n.field),e}(this.mf,t,n);return new vy((n=this.mf,t=n.on.concat([t]),new uu(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.an,n.startAt,n.endAt)),this.firestore,this.h_)},vy.prototype.limit=function(t){return gp("Query.limit",t),new vy(bu(this.mf,t,"F"),this.firestore,this.h_)},vy.prototype.limitToLast=function(t){return gp("Query.limitToLast",t),new vy(bu(this.mf,t,"L"),this.firestore,this.h_)},vy.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Af("Query.startAt",t,e,!0);return new vy(Iu(this.mf,t),this.firestore,this.h_)},vy.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Af("Query.startAfter",t,e,!1);return new vy(Iu(this.mf,t),this.firestore,this.h_)},vy.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Af("Query.endBefore",t,e,!0);return new vy(Eu(this.mf,t),this.firestore,this.h_)},vy.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t=this.Af("Query.endAt",t,e,!1);return new vy(Eu(this.mf,t),this.firestore,this.h_)},vy.prototype.isEqual=function(t){return t instanceof vy&&this.firestore===t.firestore&&Tu(this.mf,t.mf)&&this.h_===t.h_},vy.prototype.withConverter=function(t){return new vy(this.mf,this.firestore,t)},vy.prototype.Af=function(c,t,e,n){if(t instanceof $d)return function(t,e,n,r){if(!n)throw new _r(Tr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=mu(t);o<s.length;o++){var u=s[o];if(u.field.W())i.push(Ao(e,n.key));else{var a=n.field(u.field);if(lo(a))throw new _r(Tr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){u=u.field.B();throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}i.push(a)}}return new Yu(i,r)}(this.mf,this.firestore.c_,t.Ef,n);e=[t].concat(e);return function(t,e,n,r,i,o){var s=t.on;if(i.length>s.length)throw new _r(Tr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.W()){if("string"!=typeof c)throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!gu(t)&&-1!==c.indexOf("/"))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(oi.q(c));if(!ai.X(h))throw new _r(Tr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new ai(h);u.push(Ao(e,h))}else{c=rd(n,r,c);u.push(c)}}return new Yu(u,o)}(this.mf,this.firestore.c_,this.firestore.af,c,e,n)},vy.prototype.onSnapshot=function(){for(var t,e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i={},o=0;"object"!=typeof n[o]||xd(n[o])||(i=n[o],o++),xd(n[o])&&(s=n[o],n[o]=null===(t=s.next)||void 0===t?void 0:t.bind(s),n[o+1]=null===(t=s.error)||void 0===t?void 0:t.bind(s),n[o+2]=null===(t=s.complete)||void 0===t?void 0:t.bind(s));var s={next:function(t){n[o]&&n[o](new ly(e.firestore,e.mf,t,e.h_))},error:n[o+1],complete:n[o+2]};return cy(this.mf),Dd(zd(this.firestore),this.mf,i,s)},vy.prototype.get=function(t){var e=this;cy(this.mf);var n=zd(this.firestore);return(t&&"cache"===t.source?function(n,r){var t=this,i=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Hh(r,i,!0)];case 1:return n=t.sent(),e=new Hf(i,n.za),n=e.wh(n.documents),n=e.Di(n,!1),o.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),n=xa(n,"Failed to execute query '"+i+" against cache"),o.reject(n),[3,3];case 3:return[2]}})})},[4,Td(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(n,this.mf):function(n,r,i){var t=this;void 0===i&&(i={});var o=new oa;return n.cs.ws(function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new up({next:function(t){n.ws(function(){return Ra(e,s)}),t.fromCache&&"server"===r.source?i.reject(new _r(Tr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new Va(t,o,{includeMetadataChanges:!0,Xs:!0});return La(e,s)},[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.cs,r,i,o])]}})})}),o.promise}(n,this.mf,t)).then(function(t){return new ly(e.firestore,e.mf,t,e.h_)})},vy),ly=(Object.defineProperty(yy.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"empty",{get:function(){return this.Pf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty(yy.prototype,"size",{get:function(){return this.Pf.docs.size},enumerable:!1,configurable:!0}),yy.prototype.forEach=function(e,n){var r=this;this.Pf.docs.forEach(function(t){e.call(n,r.Vf(t,r.metadata.fromCache,r.Pf.Qt.has(t.key)))})},Object.defineProperty(yy.prototype,"query",{get:function(){return new fy(this.Rf,this.hf,this.h_)},enumerable:!1,configurable:!0}),yy.prototype.docChanges=function(t){t=!(!t||!t.includeMetadataChanges);if(t&&this.Pf.jt)throw new _r(Tr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.gf&&this.yf===t||(this.gf=function(i,e,o){if(i.Kt.P()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Kt;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Pf,t,this.Vf.bind(this)),this.yf=t),this.gf},yy.prototype.isEqual=function(t){return t instanceof yy&&this.hf===t.hf&&Tu(this.Rf,t.Rf)&&this.Pf.isEqual(t.Pf)&&this.h_===t.h_},yy.prototype.Vf=function(t,e,n){return new Zd(this.hf,t.key,t,e,n,this.h_)},yy),py=(n(dy,hy=fy),Object.defineProperty(dy.prototype,"id",{get:function(){return this.mf.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(dy.prototype,"parent",{get:function(){var t=this.mf.path.F();return t.P()?null:new Xd(new ai(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(dy.prototype,"path",{get:function(){return this.mf.path.B()},enumerable:!1,configurable:!0}),dy.prototype.doc=function(t){0===arguments.length&&(t=Rr.t()),pp("CollectionReference.doc","path",t);t=oi.q(t);return Xd.uf(this.mf.path.child(t),this.firestore,this.h_)},dy.prototype.add=function(t){var t=this.h_?this.h_.toFirestore(t):t,e=this.doc();return new Xd(e.u_,this.firestore,null).set(t).then(function(){return e})},dy.prototype.withConverter=function(t){return new dy(this.pf,this.firestore,t)},dy);function dy(t,e,n){var r=this;if(((r=hy.call(this,lu(t),e,n)||this).pf=t).length%2!=1)throw new _r(Tr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.B()+" has "+t.length);return r}function yy(t,e,n,r){this.hf=t,this.Rf=e,this.Pf=n,this.h_=r,this.gf=null,this.yf=null,this.metadata=new Jd(n.hasPendingWrites,n.fromCache)}function vy(t,e,n){this.mf=t,this.firestore=e,this.h_=n}function gy(t,e,n){e=function(t,e){if(t instanceof e)return t;if(e.name===t.constructor.name)throw new _r(Tr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=vp(t);throw new _r(Tr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}(e,Xd);if(e.firestore!==n)throw new _r(Tr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function my(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var wy,by,Ee=(n(Ey,wy=Up),Ey.serverTimestamp=function(){var t=new Pp("serverTimestamp");return t.Jl="FieldValue.serverTimestamp",new Ey(t)},Ey.delete=function(){var t=new _p("deleteField");return t.Jl="FieldValue.delete",new Ey(t)},Ey.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Lp("arrayUnion",t)}.apply(void 0,t);return n.Jl="FieldValue.arrayUnion",new Ey(n)},Ey.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Rp("arrayRemove",t)}.apply(void 0,t);return n.Jl="FieldValue.arrayRemove",new Ey(n)},Ey.increment=function(t){t=new Cp("increment",t);return t.Jl="FieldValue.increment",new Ey(t)},Ey.prototype.isEqual=function(t){return this.a_.isEqual(t.a_)},Ey),Iy={Firestore:Fd,GeoPoint:Vp,Timestamp:ri,Blob:Hr,Transaction:Qd,WriteBatch:Yd,DocumentReference:Xd,DocumentSnapshot:$d,Query:fy,QueryDocumentSnapshot:Zd,QuerySnapshot:ly,CollectionReference:py,FieldPath:Ip,FieldValue:Ee,setLogLevel:function(t){Ar.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function Ey(){return null!==wy&&wy.apply(this,arguments)||this}(by=e.default).INTERNAL.registerComponent(new br("firestore",function(t){return e=t.getProvider("app").getImmediate(),t=t.getProvider("auth-internal"),new Fd(e,t,new qd);var e},"PUBLIC").setServiceProps(Object.assign({},Iy))),by.registerVersion("@firebase/firestore","2.0.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
